<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=ja class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.121.2"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Protocol Buffers Documentation</title>
<meta name=description content="背景 {/examples} フィールドの存在 とは、protobuf フィールドに値があるかどうかの概念です。 protobuf には、存在しない プレゼンスと、生成されたメッセージ API がフィールド値のみを保存する 明示的なプレゼンス の 2 つの異なる表現があります。 proto2 は主に 明示的なプレゼンス を採用してきましたが、proto3 は基本型の単数の proto3 フィールドについてのみ 存在しない プレゼンスのセマンティクスを公開しています。 基本型（数値、文字列、バイト、および列挙型）の単数の proto3 フィールドは、optional ラベルで定義されており、proto2 と同様に 明示的なプレゼンス を持っています（この機能はリリース 3.15 でデフォルトで有効になっています）。
プレゼンスディシプリン {/examples} プレゼンスディシプリン は、API 表現 と シリアライズされた表現 の間の変換のセマンティクスを定義します。 存在しない ディシプリンは、(デ)シリアライズ時にフィールド値自体を使用して決定を行います。 一方、明示的なプレゼンス ディシプリンは、明示的なトラッキング状態に依存します。
タグ値ストリーム（ワイヤーフォーマット）シリアライゼーションにおけるプレゼンス {/examples} ワイヤーフォーマットは、タグ付きの 自己区切り 値のストリームです。 ワイヤーフォーマットは、定義上 存在する 値のシーケンスを表します。 つまり、シリアライゼーション内のすべての値は 存在する フィールドを表し、さらに、シリアライゼーションには 存在しない 値に関する情報が含まれていません。
proto メッセージの生成された API には、API 型と定義上 存在する（タグ、値）のペアのストリームとの間の変換を行う（デ）シリアライズ定義が含まれています。 この変換は、メッセージ定義の変更に対して前方および後方互換性がありますが、この互換性は、ワイヤーフォーマットのメッセージをデシリアライズする際にいくつかの（おそらく驚くべき）考慮事項を導入します。
シリアライズ時、存在しない フィールドは、デフォルト値を持つ場合にはシリアライズされません。 数値型の場合、デフォルト値は0です。 列挙型の場合、デフォルト値はゼロ値の列挙子です。 文字列、バイト、繰り返しフィールドの場合、デフォルト値は長さゼロの値です。 メッセージの場合、デフォルト値は言語固有のnull値です。 &amp;ldquo;空&amp;quot;の長さ区切り値（空の文字列など）は、シリアライズされた値で有効に表現できます：フィールドはワイヤーフォーマットに現れるという意味で「存在します」。ただし、生成されたAPIが存在を追跡していない場合、これらの値は再度シリアライズされないかもしれません。つまり、空のフィールドはシリアライズラウンドトリップ後に「存在しない」かもしれません。 デシリアライズ時、重複するフィールド値は、フィールドの定義に応じて異なる方法で処理される場合があります。 重複する repeated フィールドは通常、フィールドのAPI表現に追加されます。（packed 繰り返しフィールドをシリアライズすると、タグストリームには1つの長さ区切り値のみが生成されることに注意してください。） 重複する optional フィールド値は、「最後のものが勝つ」というルールに従います。 oneof フィールドは、APIレベルの不変条件を公開し、1つのフィールドのみが設定されていることを示します。ただし、ワイヤーフォーマットには複数の（タグ、値）ペアが含まれる場合があり、これらは概念的に oneof に属しています。optional フィールドと同様に、生成されたAPIは「最後のものが勝つ」ルールに従います。 proto2の生成APIでは、列挙型フィールドの範囲外の値は返されません。ただし、範囲外の値はAPI内で未知のフィールドとして保存される場合がありますが、ワイヤーフォーマットのタグが認識された場合でもです。 Named-field Mapping フォーマットにおける存在 Protobufは人間が読みやすいテキスト形式で表現することができます。2つの注目すべきフォーマットはTextFormat（生成されたメッセージのDebugStringメソッドによって生成される出力形式）とJSONです。"><meta property="og:title" content><meta property="og:description" content="背景 {/examples} フィールドの存在 とは、protobuf フィールドに値があるかどうかの概念です。 protobuf には、存在しない プレゼンスと、生成されたメッセージ API がフィールド値のみを保存する 明示的なプレゼンス の 2 つの異なる表現があります。 proto2 は主に 明示的なプレゼンス を採用してきましたが、proto3 は基本型の単数の proto3 フィールドについてのみ 存在しない プレゼンスのセマンティクスを公開しています。 基本型（数値、文字列、バイト、および列挙型）の単数の proto3 フィールドは、optional ラベルで定義されており、proto2 と同様に 明示的なプレゼンス を持っています（この機能はリリース 3.15 でデフォルトで有効になっています）。
プレゼンスディシプリン {/examples} プレゼンスディシプリン は、API 表現 と シリアライズされた表現 の間の変換のセマンティクスを定義します。 存在しない ディシプリンは、(デ)シリアライズ時にフィールド値自体を使用して決定を行います。 一方、明示的なプレゼンス ディシプリンは、明示的なトラッキング状態に依存します。
タグ値ストリーム（ワイヤーフォーマット）シリアライゼーションにおけるプレゼンス {/examples} ワイヤーフォーマットは、タグ付きの 自己区切り 値のストリームです。 ワイヤーフォーマットは、定義上 存在する 値のシーケンスを表します。 つまり、シリアライゼーション内のすべての値は 存在する フィールドを表し、さらに、シリアライゼーションには 存在しない 値に関する情報が含まれていません。
proto メッセージの生成された API には、API 型と定義上 存在する（タグ、値）のペアのストリームとの間の変換を行う（デ）シリアライズ定義が含まれています。 この変換は、メッセージ定義の変更に対して前方および後方互換性がありますが、この互換性は、ワイヤーフォーマットのメッセージをデシリアライズする際にいくつかの（おそらく驚くべき）考慮事項を導入します。
シリアライズ時、存在しない フィールドは、デフォルト値を持つ場合にはシリアライズされません。 数値型の場合、デフォルト値は0です。 列挙型の場合、デフォルト値はゼロ値の列挙子です。 文字列、バイト、繰り返しフィールドの場合、デフォルト値は長さゼロの値です。 メッセージの場合、デフォルト値は言語固有のnull値です。 &ldquo;空&#34;の長さ区切り値（空の文字列など）は、シリアライズされた値で有効に表現できます：フィールドはワイヤーフォーマットに現れるという意味で「存在します」。ただし、生成されたAPIが存在を追跡していない場合、これらの値は再度シリアライズされないかもしれません。つまり、空のフィールドはシリアライズラウンドトリップ後に「存在しない」かもしれません。 デシリアライズ時、重複するフィールド値は、フィールドの定義に応じて異なる方法で処理される場合があります。 重複する repeated フィールドは通常、フィールドのAPI表現に追加されます。（packed 繰り返しフィールドをシリアライズすると、タグストリームには1つの長さ区切り値のみが生成されることに注意してください。） 重複する optional フィールド値は、「最後のものが勝つ」というルールに従います。 oneof フィールドは、APIレベルの不変条件を公開し、1つのフィールドのみが設定されていることを示します。ただし、ワイヤーフォーマットには複数の（タグ、値）ペアが含まれる場合があり、これらは概念的に oneof に属しています。optional フィールドと同様に、生成されたAPIは「最後のものが勝つ」ルールに従います。 proto2の生成APIでは、列挙型フィールドの範囲外の値は返されません。ただし、範囲外の値はAPI内で未知のフィールドとして保存される場合がありますが、ワイヤーフォーマットのタグが認識された場合でもです。 Named-field Mapping フォーマットにおける存在 Protobufは人間が読みやすいテキスト形式で表現することができます。2つの注目すべきフォーマットはTextFormat（生成されたメッセージのDebugStringメソッドによって生成される出力形式）とJSONです。"><meta property="og:type" content="article"><meta property="og:url" content="https://protobuf.dev/ja/programming-guides/field_presence/"><meta property="article:section" content="programming-guides"><meta itemprop=name content><meta itemprop=description content="背景 {/examples} フィールドの存在 とは、protobuf フィールドに値があるかどうかの概念です。 protobuf には、存在しない プレゼンスと、生成されたメッセージ API がフィールド値のみを保存する 明示的なプレゼンス の 2 つの異なる表現があります。 proto2 は主に 明示的なプレゼンス を採用してきましたが、proto3 は基本型の単数の proto3 フィールドについてのみ 存在しない プレゼンスのセマンティクスを公開しています。 基本型（数値、文字列、バイト、および列挙型）の単数の proto3 フィールドは、optional ラベルで定義されており、proto2 と同様に 明示的なプレゼンス を持っています（この機能はリリース 3.15 でデフォルトで有効になっています）。
プレゼンスディシプリン {/examples} プレゼンスディシプリン は、API 表現 と シリアライズされた表現 の間の変換のセマンティクスを定義します。 存在しない ディシプリンは、(デ)シリアライズ時にフィールド値自体を使用して決定を行います。 一方、明示的なプレゼンス ディシプリンは、明示的なトラッキング状態に依存します。
タグ値ストリーム（ワイヤーフォーマット）シリアライゼーションにおけるプレゼンス {/examples} ワイヤーフォーマットは、タグ付きの 自己区切り 値のストリームです。 ワイヤーフォーマットは、定義上 存在する 値のシーケンスを表します。 つまり、シリアライゼーション内のすべての値は 存在する フィールドを表し、さらに、シリアライゼーションには 存在しない 値に関する情報が含まれていません。
proto メッセージの生成された API には、API 型と定義上 存在する（タグ、値）のペアのストリームとの間の変換を行う（デ）シリアライズ定義が含まれています。 この変換は、メッセージ定義の変更に対して前方および後方互換性がありますが、この互換性は、ワイヤーフォーマットのメッセージをデシリアライズする際にいくつかの（おそらく驚くべき）考慮事項を導入します。
シリアライズ時、存在しない フィールドは、デフォルト値を持つ場合にはシリアライズされません。 数値型の場合、デフォルト値は0です。 列挙型の場合、デフォルト値はゼロ値の列挙子です。 文字列、バイト、繰り返しフィールドの場合、デフォルト値は長さゼロの値です。 メッセージの場合、デフォルト値は言語固有のnull値です。 &ldquo;空&#34;の長さ区切り値（空の文字列など）は、シリアライズされた値で有効に表現できます：フィールドはワイヤーフォーマットに現れるという意味で「存在します」。ただし、生成されたAPIが存在を追跡していない場合、これらの値は再度シリアライズされないかもしれません。つまり、空のフィールドはシリアライズラウンドトリップ後に「存在しない」かもしれません。 デシリアライズ時、重複するフィールド値は、フィールドの定義に応じて異なる方法で処理される場合があります。 重複する repeated フィールドは通常、フィールドのAPI表現に追加されます。（packed 繰り返しフィールドをシリアライズすると、タグストリームには1つの長さ区切り値のみが生成されることに注意してください。） 重複する optional フィールド値は、「最後のものが勝つ」というルールに従います。 oneof フィールドは、APIレベルの不変条件を公開し、1つのフィールドのみが設定されていることを示します。ただし、ワイヤーフォーマットには複数の（タグ、値）ペアが含まれる場合があり、これらは概念的に oneof に属しています。optional フィールドと同様に、生成されたAPIは「最後のものが勝つ」ルールに従います。 proto2の生成APIでは、列挙型フィールドの範囲外の値は返されません。ただし、範囲外の値はAPI内で未知のフィールドとして保存される場合がありますが、ワイヤーフォーマットのタグが認識された場合でもです。 Named-field Mapping フォーマットにおける存在 Protobufは人間が読みやすいテキスト形式で表現することができます。2つの注目すべきフォーマットはTextFormat（生成されたメッセージのDebugStringメソッドによって生成される出力形式）とJSONです。"><meta itemprop=wordCount content="986"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="背景 {/examples} フィールドの存在 とは、protobuf フィールドに値があるかどうかの概念です。 protobuf には、存在しない プレゼンスと、生成されたメッセージ API がフィールド値のみを保存する 明示的なプレゼンス の 2 つの異なる表現があります。 proto2 は主に 明示的なプレゼンス を採用してきましたが、proto3 は基本型の単数の proto3 フィールドについてのみ 存在しない プレゼンスのセマンティクスを公開しています。 基本型（数値、文字列、バイト、および列挙型）の単数の proto3 フィールドは、optional ラベルで定義されており、proto2 と同様に 明示的なプレゼンス を持っています（この機能はリリース 3.15 でデフォルトで有効になっています）。
プレゼンスディシプリン {/examples} プレゼンスディシプリン は、API 表現 と シリアライズされた表現 の間の変換のセマンティクスを定義します。 存在しない ディシプリンは、(デ)シリアライズ時にフィールド値自体を使用して決定を行います。 一方、明示的なプレゼンス ディシプリンは、明示的なトラッキング状態に依存します。
タグ値ストリーム（ワイヤーフォーマット）シリアライゼーションにおけるプレゼンス {/examples} ワイヤーフォーマットは、タグ付きの 自己区切り 値のストリームです。 ワイヤーフォーマットは、定義上 存在する 値のシーケンスを表します。 つまり、シリアライゼーション内のすべての値は 存在する フィールドを表し、さらに、シリアライゼーションには 存在しない 値に関する情報が含まれていません。
proto メッセージの生成された API には、API 型と定義上 存在する（タグ、値）のペアのストリームとの間の変換を行う（デ）シリアライズ定義が含まれています。 この変換は、メッセージ定義の変更に対して前方および後方互換性がありますが、この互換性は、ワイヤーフォーマットのメッセージをデシリアライズする際にいくつかの（おそらく驚くべき）考慮事項を導入します。
シリアライズ時、存在しない フィールドは、デフォルト値を持つ場合にはシリアライズされません。 数値型の場合、デフォルト値は0です。 列挙型の場合、デフォルト値はゼロ値の列挙子です。 文字列、バイト、繰り返しフィールドの場合、デフォルト値は長さゼロの値です。 メッセージの場合、デフォルト値は言語固有のnull値です。 &ldquo;空&#34;の長さ区切り値（空の文字列など）は、シリアライズされた値で有効に表現できます：フィールドはワイヤーフォーマットに現れるという意味で「存在します」。ただし、生成されたAPIが存在を追跡していない場合、これらの値は再度シリアライズされないかもしれません。つまり、空のフィールドはシリアライズラウンドトリップ後に「存在しない」かもしれません。 デシリアライズ時、重複するフィールド値は、フィールドの定義に応じて異なる方法で処理される場合があります。 重複する repeated フィールドは通常、フィールドのAPI表現に追加されます。（packed 繰り返しフィールドをシリアライズすると、タグストリームには1つの長さ区切り値のみが生成されることに注意してください。） 重複する optional フィールド値は、「最後のものが勝つ」というルールに従います。 oneof フィールドは、APIレベルの不変条件を公開し、1つのフィールドのみが設定されていることを示します。ただし、ワイヤーフォーマットには複数の（タグ、値）ペアが含まれる場合があり、これらは概念的に oneof に属しています。optional フィールドと同様に、生成されたAPIは「最後のものが勝つ」ルールに従います。 proto2の生成APIでは、列挙型フィールドの範囲外の値は返されません。ただし、範囲外の値はAPI内で未知のフィールドとして保存される場合がありますが、ワイヤーフォーマットのタグが認識された場合でもです。 Named-field Mapping フォーマットにおける存在 Protobufは人間が読みやすいテキスト形式で表現することができます。2つの注目すべきフォーマットはTextFormat（生成されたメッセージのDebugStringメソッドによって生成される出力形式）とJSONです。"><link rel=preload href=/scss/main.min.6a57e8f3f347dea5d31cb48e3b4ea9fdae32d499473089bdef9b45457b5debb8.css as=style><link href=/scss/main.min.6a57e8f3f347dea5d31cb48e3b4ea9fdae32d499473089bdef9b45457b5debb8.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-5L8P8GRN4Y"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5L8P8GRN4Y")}</script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/ja/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Protocol Buffers Documentation</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>日本語</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/programming-guides/field_presence/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder=サイトを検索... aria-label=サイトを検索... autocomplete=off></div></div></nav></header><div class="container-fluid td-default td-outer"><main role=main class=td-main><h2 id=背景-examples>背景 {/examples}</h2><p><em>フィールドの存在</em> とは、protobuf フィールドに値があるかどうかの概念です。
protobuf には、<em>存在しない</em> プレゼンスと、生成されたメッセージ API がフィールド値のみを保存する <em>明示的なプレゼンス</em> の 2 つの異なる表現があります。
proto2 は主に <em>明示的なプレゼンス</em> を採用してきましたが、proto3 は基本型の単数の proto3 フィールドについてのみ <em>存在しない</em> プレゼンスのセマンティクスを公開しています。
基本型（数値、文字列、バイト、および列挙型）の単数の proto3 フィールドは、<code>optional</code> ラベルで定義されており、proto2 と同様に <em>明示的なプレゼンス</em> を持っています（この機能はリリース 3.15 でデフォルトで有効になっています）。</p><h3 id=プレゼンスディシプリン-examples>プレゼンスディシプリン {/examples}</h3><p><em>プレゼンスディシプリン</em> は、<em>API 表現</em> と <em>シリアライズされた表現</em> の間の変換のセマンティクスを定義します。
<em>存在しない</em> ディシプリンは、(デ)シリアライズ時にフィールド値自体を使用して決定を行います。
一方、<em>明示的なプレゼンス</em> ディシプリンは、明示的なトラッキング状態に依存します。</p><h3 id=タグ値ストリームワイヤーフォーマットシリアライゼーションにおけるプレゼンス-examples><em>タグ値ストリーム</em>（ワイヤーフォーマット）シリアライゼーションにおけるプレゼンス {/examples}</h3><p>ワイヤーフォーマットは、タグ付きの <em>自己区切り</em> 値のストリームです。
ワイヤーフォーマットは、定義上 <em>存在する</em> 値のシーケンスを表します。
つまり、シリアライゼーション内のすべての値は <em>存在する</em> フィールドを表し、さらに、シリアライゼーションには <em>存在しない</em> 値に関する情報が含まれていません。</p><p>proto メッセージの生成された API には、API 型と定義上 <em>存在する</em>（タグ、値）のペアのストリームとの間の変換を行う（デ）シリアライズ定義が含まれています。
この変換は、メッセージ定義の変更に対して前方および後方互換性がありますが、この互換性は、ワイヤーフォーマットのメッセージをデシリアライズする際にいくつかの（おそらく驚くべき）考慮事項を導入します。</p><ul><li>シリアライズ時、<em>存在しない</em> フィールドは、デフォルト値を持つ場合にはシリアライズされません。<ul><li>数値型の場合、デフォルト値は0です。</li><li>列挙型の場合、デフォルト値はゼロ値の列挙子です。</li><li>文字列、バイト、繰り返しフィールドの場合、デフォルト値は長さゼロの値です。</li><li>メッセージの場合、デフォルト値は言語固有のnull値です。</li></ul></li><li>&ldquo;空"の長さ区切り値（空の文字列など）は、シリアライズされた値で有効に表現できます：フィールドはワイヤーフォーマットに現れるという意味で「存在します」。ただし、生成されたAPIが存在を追跡していない場合、これらの値は再度シリアライズされないかもしれません。つまり、空のフィールドはシリアライズラウンドトリップ後に「存在しない」かもしれません。</li><li>デシリアライズ時、重複するフィールド値は、フィールドの定義に応じて異なる方法で処理される場合があります。<ul><li>重複する <code>repeated</code> フィールドは通常、フィールドのAPI表現に追加されます。（<em>packed</em> 繰り返しフィールドをシリアライズすると、タグストリームには1つの長さ区切り値のみが生成されることに注意してください。）</li><li>重複する <code>optional</code> フィールド値は、「最後のものが勝つ」というルールに従います。</li></ul></li><li><code>oneof</code> フィールドは、APIレベルの不変条件を公開し、1つのフィールドのみが設定されていることを示します。ただし、ワイヤーフォーマットには複数の（タグ、値）ペアが含まれる場合があり、これらは概念的に <code>oneof</code> に属しています。<code>optional</code> フィールドと同様に、生成されたAPIは「最後のものが勝つ」ルールに従います。</li><li>proto2の生成APIでは、列挙型フィールドの範囲外の値は返されません。ただし、範囲外の値はAPI内で<em>未知のフィールド</em>として保存される場合がありますが、ワイヤーフォーマットのタグが認識された場合でもです。</li></ul><h3 id=named-field-mapping-フォーマットにおける存在><em>Named-field Mapping</em> フォーマットにおける存在</h3><p>Protobufは人間が読みやすいテキスト形式で表現することができます。2つの注目すべきフォーマットはTextFormat（生成されたメッセージの<code>DebugString</code>メソッドによって生成される出力形式）とJSONです。</p><p>これらのフォーマットにはそれぞれ独自の正確性要件があり、一般的には<em>tagged-value stream</em>フォーマットよりも厳格です。ただし、TextFormatはワイヤーフォーマットのセマンティクスにより密接に準拠し、一部のケースでは類似したセマンティクスを提供します（たとえば、繰り返し名前値マッピングを繰り返しフィールドに追加する）。特に、ワイヤーフォーマットと同様に、TextFormatには存在するフィールドのみが含まれます。</p><p>JSONははるかに厳格な形式ですが、ワイヤ形式やTextFormatの一部の意味を正しく表現できません。</p><ul><li>JSONの<em>要素</em>は意味的に順不同であり、各メンバーは一意の名前を持たなければなりません。これは、繰り返しフィールドのTextFormatのルールとは異なります。</li><li>JSONには他の形式の<em>存在しない</em>ディシプリンとは異なり、&ldquo;存在しない"フィールドを含めることができます。<ul><li>JSONは<code>null</code>値を定義しており、これは<em>定義されているが存在しないフィールド</em>を表すために使用できます。</li><li>繰り返しフィールドの値は、デフォルト値（空のリスト）と等しい場合でも、フォーマットされた出力に含めることができます。</li></ul></li><li>JSONの要素が順不同であるため、「最後に来たものが勝つ」ルールを曖昧さなく解釈する方法はありません。<ul><li>ほとんどの場合、これは問題ありません：JSONの要素は一意の名前を持たなければならないため、繰り返しフィールドの値は有効なJSONではないため、TextFormatのように解決する必要はありません。</li><li>ただし、これは<code>oneof</code>フィールドを曖昧さなく解釈することができない可能性があることを意味します：複数のケースが存在する場合、それらは順不同です。</li></ul></li></ul><p>理論上、JSONは存在を意味を保持する方法で表現できます。しかし、実際には、実装の選択によって存在の正確性が異なる場合があります、特にJSONがprotobufを使用していないクライアントとの相互運用性を確保する手段として選択された場合。</p><h3 id=proto2-apiにおける存在>Proto2 APIにおける存在</h3><p>この表は、proto2 APIのフィールドに対して存在が追跡されるかどうかを示しています（生成されたAPIと動的リフレクションを使用する場合の両方）：</p><table><thead><tr><th>フィールドの種類</th><th>明示的な存在</th></tr></thead><tbody><tr><td>単一の数値（整数または浮動小数点）</td><td>✔️</td></tr><tr><td>単一の列挙型</td><td>✔️</td></tr><tr><td>単一の文字列またはバイト列</td><td>✔️</td></tr><tr><td>単一のメッセージ</td><td>✔️</td></tr><tr><td>繰り返し</td><td></td></tr><tr><td>Oneof</td><td>✔️</td></tr><tr><td>マップ</td><td></td></tr></tbody></table><p>単一のフィールド（すべてのタイプ）は、生成されたAPIで明示的に存在を追跡します。生成されたメッセージインターフェースには、フィールドの存在をクエリするためのメソッドが含まれています。例えば、フィールド<code>foo</code>には対応する<code>has_foo</code>メソッドがあります。（具体的な名前は、フィールドアクセサと同じ言語固有の命名規則に従います。）これらのメソッドは、protobufの実装内で「hazzers」と呼ばれることがあります。</p><p>同様に、単一のフィールドと同様に、<code>oneof</code> フィールドは明示的に、どのメンバーが値を含んでいるかを追跡します。例えば、次の <code>oneof</code> の例を考えてみてください：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-protobuf data-lang=protobuf><span style=display:flex><span><span style=color:#204a87;font-weight:700>oneof</span> <span style=color:#000>foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>a</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>float</span> <span style=color:#000>b</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>ターゲット言語によっては、生成された API には通常、いくつかのメソッドが含まれます：</p><ul><li><code>oneof</code> の hazzer: <code>has_foo</code></li><li><em>oneof case</em> メソッド: <code>foo</code></li><li>メンバーの hazzer: <code>has_a</code>, <code>has_b</code></li><li>メンバーのゲッター: <code>a</code>, <code>b</code></li></ul><p>繰り返しフィールドやマップは存在を追跡しません：<em>空の</em>繰り返しフィールドと<em>存在しない</em>繰り返しフィールドの区別はありません。</p><h3 id=proto3-api-における存在>Proto3 API における存在</h3><p>この表は、proto3 API においてフィールドの存在が追跡されるかどうかを概説しています（生成された API および動的リフレクションを使用した場合の両方）：</p><table><thead><tr><th>フィールドの種類</th><th><code>optional</code></th><th>明示的な存在</th></tr></thead><tbody><tr><td>単一の数値（整数または浮動小数点）</td><td>いいえ</td><td></td></tr><tr><td>単一の数値（整数または浮動小数点）</td><td>はい</td><td>✔️</td></tr><tr><td>単一の列挙型</td><td>いいえ</td><td></td></tr><tr><td>単一の列挙型</td><td>はい</td><td>✔️</td></tr><tr><td>単一の文字列またはバイト列</td><td>いいえ</td><td></td></tr><tr><td>単一の文字列またはバイト列</td><td>はい</td><td>✔️</td></tr><tr><td>単一のメッセージ</td><td>いいえ</td><td>✔️</td></tr><tr><td>単一のメッセージ</td><td>はい</td><td>✔️</td></tr><tr><td>繰り返し</td><td>N/A</td><td></td></tr><tr><td>Oneof</td><td>N/A</td><td>✔️</td></tr><tr><td>マップ</td><td>N/A</td><td></td></tr></tbody></table><p>proto2 API と同様に、proto3 では繰り返しフィールドの存在を明示的に追跡しません。<code>optional</code> ラベルがない場合、proto3 API では基本型（数値、文字列、バイト列、列挙型）の存在を追跡しません。Oneof フィールドは存在を明示的に公開しますが、proto2 API と同様の hazzer メソッドのセットが生成されない場合もあります。</p><p><em>存在しない</em> ディシプリンの下では、デフォルト値はシリアル化の目的において &ldquo;存在しない&rdquo; と同義です。フィールドを概念的に &ldquo;クリア&rdquo; するために（シリアル化されないようにするために）、API ユーザーはそれをデフォルト値に設定するでしょう。</p><p>デフォルト値は、<em>存在しない</em>状態の列挙型フィールドに対して、対応する0値の列挙子です。proto3構文のルールによると、すべての列挙型は、0にマップされる列挙子値を持つ必要があります。慣習として、これは <code>UNKNOWN</code> または同様の名前の列挙子です。ゼロ値がアプリケーションの有効な値のドメイン外にある場合、この動作は事実上 <em>明示的な存在</em> と見なすことができます。</p><h2 id=意味の違い>意味の違い</h2><p><em>存在しない</em> シリアライゼーション規律は、デフォルト値が設定された場合に <em>明示的な存在</em> 追跡規律とは異なる見える違いをもたらします。数値、列挙型、または文字列型の単一フィールドに対して:</p><ul><li><em>存在しない</em> 規律:<ul><li>デフォルト値はシリアライズされません。</li><li>デフォルト値は <em>マージされません</em>。</li><li>フィールドを &ldquo;クリア&rdquo; するには、デフォルト値に設定します。</li><li>デフォルト値は次の意味を持つ可能性があります:<ul><li>フィールドが明示的にデフォルト値に設定されたことを意味し、それがアプリケーション固有の値のドメインで有効である;</li><li>フィールドがデフォルトに設定することで事実上 &ldquo;クリア&rdquo; された; または</li><li>フィールドが設定されていない。</li></ul></li></ul></li><li><em>明示的な存在</em> 規律:<ul><li>明示的に設定された値は常にシリアライズされ、デフォルト値も含まれます。</li><li>設定されていないフィールドはマージされません。</li><li>明示的に設定されたフィールド &ndash; デフォルト値を含む &ndash; はマージされます。</li><li>生成された <code>has_foo</code> メソッドは、フィールド <code>foo</code> が設定されたかどうか (およびクリアされていないか) を示します。</li><li>クリア (つまり、設定を解除) するには、生成された <code>clear_foo</code> メソッドを使用する必要があります。</li></ul></li></ul><h3 id=マージに関する考慮事項>マージに関する考慮事項</h3><p><em>存在しない</em> 規則に従うと、ターゲットフィールドがデフォルト値からマージされることは事実上不可能です (protobuf の API マージ関数を使用して)。これは、デフォルト値がスキップされるためであり、<em>存在しない</em> シリアライゼーション規律と同様です。マージは、マージ先メッセージのみが更新され、更新元メッセージからスキップされない値を使用して行われます。</p><p>マージ動作の違いは、部分的な &ldquo;パッチ&rdquo; 更新に依存するプロトコルにさらなる影響を与えます。フィールドの存在が追跡されていない場合、更新パッチだけではデフォルト値への更新を表現できません。なぜなら、デフォルト値以外の値だけがマージされるからです。</p><p>更新してこの場合にデフォルト値を設定するには、<code>FieldMask</code>などの外部メカニズムが必要です。ただし、存在が追跡されている場合、すべての明示的に設定された値（デフォルト値も含む）がターゲットにマージされます。</p><h3 id=変更互換性の考慮事項>変更互換性の考慮事項</h3><p>フィールドを<em>明示的な存在</em>と<em>存在しない</em>の間で変更することは、ワイヤ形式のシリアライズされた値にとってバイナリ互換の変更です。ただし、メッセージのシリアライズに使用されたバージョンによって、メッセージのシリアライズされた表現が異なる場合があります。特に、&ldquo;送信者"がフィールドをデフォルト値に明示的に設定した場合：</p><ul><li><em>存在しない</em>の規律に従うシリアル化された値には、明示的に設定されたデフォルト値は含まれません。</li><li><em>明示的な存在</em>の規律に従うシリアル化された値には、デフォルト値を含むすべての"存在する"フィールドが含まれます。</li></ul><p>この変更は、アプリケーションのセマンティクスによって安全であるかどうかが異なります。たとえば、メッセージ定義の異なるバージョンを使用する2つのクライアントを考えてみてください。</p><p>クライアントAは、フィールド<code>foo</code>に対して<em>明示的な存在</em>のシリアライズ規律に従うこのメッセージの定義を使用します：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-protobuf data-lang=protobuf><span style=display:flex><span><span style=color:#000>syntax</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;proto3&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Msg</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>クライアントBは、同じメッセージの定義を使用しますが、<em>存在しない</em>の規律に従います：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-protobuf data-lang=protobuf><span style=display:flex><span><span style=color:#000>syntax</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;proto3&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Msg</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>今、クライアントAがクライアントが繰り返し"同じ"メッセージを逆シリアル化および再シリアル化することで<code>foo</code>の存在を観察するシナリオを考えてみてください：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-protobuf data-lang=protobuf><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Client A:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>Msg</span> <span style=color:#000>m_a</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000>m_a.set_foo</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>);</span>                  <span style=color:#8f5902;font-style:italic>// non-default value
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>assert</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m_a.has_foo</span><span style=color:#000;font-weight:700>());</span>           <span style=color:#8f5902;font-style:italic>// OK
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>Send</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m_a.SerializeAsString</span><span style=color:#000;font-weight:700>());</span>   <span style=color:#8f5902;font-style:italic>// to client B
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// Client B:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>Msg</span> <span style=color:#000>m_b</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000>m_b.ParseFromString</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Receive</span><span style=color:#000;font-weight:700>());</span>  <span style=color:#8f5902;font-style:italic>// from client A
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>assert</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m_b.foo</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>);</span>          <span style=color:#8f5902;font-style:italic>// OK
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>Send</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m_b.SerializeAsString</span><span style=color:#000;font-weight:700>());</span>   <span style=color:#8f5902;font-style:italic>// to client A
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// Client A:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m_a.ParseFromString</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Receive</span><span style=color:#000;font-weight:700>());</span>  <span style=color:#8f5902;font-style:italic>// from client B
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>assert</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m_a.foo</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>);</span>          <span style=color:#8f5902;font-style:italic>// OK
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>assert</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m_a.has_foo</span><span style=color:#000;font-weight:700>());</span>           <span style=color:#8f5902;font-style:italic>// OK
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m_a.set_foo</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>);</span>                  <span style=color:#8f5902;font-style:italic>// default value
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>Send</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m_a.SerializeAsString</span><span style=color:#000;font-weight:700>());</span>   <span style=color:#8f5902;font-style:italic>// to client B
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// Client B:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>Msg</span> <span style=color:#000>m_b</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000>m_b.ParseFromString</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Receive</span><span style=color:#000;font-weight:700>());</span>  <span style=color:#8f5902;font-style:italic>// from client A
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>assert</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m_b.foo</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>);</span>          <span style=color:#8f5902;font-style:italic>// OK
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>Send</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m_b.SerializeAsString</span><span style=color:#000;font-weight:700>());</span>   <span style=color:#8f5902;font-style:italic>// to client A
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// Client A:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>m_a.ParseFromString</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Receive</span><span style=color:#000;font-weight:700>());</span>  <span style=color:#8f5902;font-style:italic>// from client B
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>assert</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m_a.foo</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>);</span>          <span style=color:#8f5902;font-style:italic>// OK
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>assert</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m_a.has_foo</span><span style=color:#000;font-weight:700>());</span>           <span style=color:#8f5902;font-style:italic>// FAIL
</span></span></span></code></pre></div><p>クライアントAが<code>foo</code>に<em>明示的な存在</em>を依存している場合、クライアントBを経由する"ラウンドトリップ"は、クライアントAの観点から見ると損失が発生します。この例では、これは安全な変更ではありません：クライアントAは、フィールドが存在することを（<code>assert</code>によって）要求しており、APIを介しての変更がなくても、その要件は値とピアに依存する場合に失敗します。</p><h2 id=proto3で明示的な存在を有効にする方法>Proto3で<em>明示的な存在</em>を有効にする方法</h2><p>これは、proto3のフィールド追跡サポートを使用する一般的な手順です。</p><ol><li><code>.proto</code>ファイルに<code>optional</code>フィールドを追加します。</li><li><code>protoc</code>を実行します（少なくともv3.15、または<code>--experimental_allow_proto3_optional</code>フラグを使用してv3.12）。</li><li>アプリケーションコードで生成された &ldquo;hazzer"メソッドと &ldquo;clear"メソッドを使用し、デフォルト値を比較または設定する代わりに。</li></ol><h3 id=protoファイルの変更><code>.proto</code>ファイルの変更</h3><p>これは、<em>存在しない</em>と<em>明示的な存在</em>セマンティクスの両方に従うフィールドを持つproto3メッセージの例です：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-protobuf data-lang=protobuf><span style=display:flex><span><span style=color:#000>syntax</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;proto3&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>example</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>MyMessage</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// No presence:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>not_tracked</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Explicit presence:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>tracked</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><h3 id=protocの呼び出し><code>protoc</code>の呼び出し</h3><p>proto3メッセージの存在追跡は、デフォルトで有効になっています
<a href=https://github.com/protocolbuffers/protobuf/releases/tag/v3.15.0>v3.15.0</a>
リリース以降、以前は
<a href=https://github.com/protocolbuffers/protobuf/releases/tag/v3.12.0>v3.12.0</a> で
protocを使用する際に存在追跡を行うために<code>--experimental_allow_proto3_optional</code>フラグが必要でした。</p><h3 id=生成されたコードの使用>生成されたコードの使用</h3><p><em>明示的な存在</em>（<code>optional</code>ラベル）を持つproto3フィールドの生成されたコードは、proto2ファイルであるかのようになります。</p><p>これは、&ldquo;存在しない"例で使用される定義です：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-protobuf data-lang=protobuf><span style=display:flex><span><span style=color:#000>syntax</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;proto3&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>example</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Msg</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>これは、&ldquo;明示的な存在"例で使用される定義です：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-protobuf data-lang=protobuf><span style=display:flex><span><span style=color:#000>syntax</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;proto3&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>example</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Msg</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>例では、<code>GetProto</code>関数が未指定の内容を持つ<code>Msg</code>型のメッセージを構築して返します。</p><h4 id=cの例>C++の例</h4><p>存在しない：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#000>Msg</span> <span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>GetProto</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>foo</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// &#34;Clear&#34; the field:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>set_foo</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Default value: field may not have been present.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>set_foo</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>明示的な存在：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#000>Msg</span> <span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>GetProto</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>has_foo</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Clear the field:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>clear_foo</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Field is not present, so set it.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>set_foo</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=cの例-1>C#の例</h4><p>存在しない：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=display:flex><span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>m</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>GetProto</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>!=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// &#34;Clear&#34; the field:</span>
</span></span><span style=display:flex><span>  <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Default value: field may not have been present.</span>
</span></span><span style=display:flex><span>  <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>明示的な存在：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=display:flex><span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>m</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>GetProto</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HasFoo</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Clear the field:</span>
</span></span><span style=display:flex><span>  <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ClearFoo</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Field is not present, so set it.</span>
</span></span><span style=display:flex><span>  <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=goの例>Goの例</h4><p>存在しない：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>GetProto</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Foo</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// &#34;Clear&#34; the field:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Default value: field may not have been present.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>明示的な存在：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>GetProto</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Foo</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Clear the field:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>nil</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Field is not present, so set it.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>proto</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Int32</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=javaの例>Javaの例</h4><p>これらの例では、<code>Builder</code>を使用してクリアリングをデモンストレーションします。<code>Builder</code>からの存在の確認と値の取得は、メッセージ型と同じAPIに従います。</p><p>存在しない：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>Msg</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>Builder</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>m</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>GetProto</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>toBuilder</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>if</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getFoo</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>!=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic>// &#34;Clear&#34; the field:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>setFoo</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>0</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>else</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic>// Default value: field may not have been present.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>setFoo</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>1</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>明示的な存在：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>Msg</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>Builder</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>m</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>GetProto</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>toBuilder</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>if</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>hasFoo</span><span style=color:#000;font-weight:700>())</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic>// Clear the field:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>clearFoo</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>else</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic>// Field is not present, so set it.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>setFoo</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>1</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=pythonの例>Pythonの例</h4><p>存在しない：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>example</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Msg</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic># &#34;Clear&#34; the field:</span>
</span></span><span style=display:flex><span>  <span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>else</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic># Default value: field may not have been present.</span>
</span></span><span style=display:flex><span>  <span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span>
</span></span></code></pre></div><p>明示的な存在：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>example</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Msg</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>HasField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;foo&#39;</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic># Clear the field:</span>
</span></span><span style=display:flex><span>  <span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ClearField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;foo&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>else</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic># Field is not present, so set it.</span>
</span></span><span style=display:flex><span>  <span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span>
</span></span></code></pre></div><h4 id=rubyの例>Rubyの例</h4><p>存在しない場合：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>new</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic># &#34;Clear&#34; the field:</span>
</span></span><span style=display:flex><span>  <span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>else</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic># Default value: field may not have been present.</span>
</span></span><span style=display:flex><span>  <span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>end</span>
</span></span></code></pre></div><p>明示的な存在：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>new</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>has_foo?</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic># Clear the field:</span>
</span></span><span style=display:flex><span>  <span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>clear_foo</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>else</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic># Field is not present, so set it.</span>
</span></span><span style=display:flex><span>  <span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>end</span>
</span></span></code></pre></div><h4 id=javascriptの例>Javascriptの例</h4><p>存在しない場合：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Msg</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getFoo</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// &#34;Clear&#34; the field:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>setFoo</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Default value: field may not have been present.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>setFoo</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>明示的な存在：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Msg</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>hasFoo</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Clear the field:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>clearFoo</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Field is not present, so set it.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>setFoo</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=objective-cの例>Objective-Cの例</h4><p>存在しない場合：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objective-c data-lang=objective-c><span style=display:flex><span><span style=color:#000>Msg</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[[</span><span style=color:#000>Msg</span> <span style=color:#000>alloc</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>init</span><span style=color:#000;font-weight:700>];</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// &#34;Clear&#34; the field:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Default value: field may not have been present.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>明示的な存在：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objective-c data-lang=objective-c><span style=display:flex><span><span style=color:#000>Msg</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[[</span><span style=color:#000>Msg</span> <span style=color:#000>alloc</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000>init</span><span style=color:#000;font-weight:700>];</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>hasFoo</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Clear the field:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000;font-weight:700>[</span><span style=color:#000>m</span> <span style=color:#000>clearFoo</span><span style=color:#000;font-weight:700>];</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Field is not present, so set it.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000;font-weight:700>[</span><span style=color:#000>m</span> <span style=color:#f57900>setFoo</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>];</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=cheat>チートシート</h2><p><strong>Proto2:</strong></p><p>フィールドの存在を追跡しますか？</p><table><thead><tr><th>フィールドの種類</th><th>追跡されますか？</th></tr></thead><tbody><tr><td>単一のフィールド</td><td>はい</td></tr><tr><td>単一のメッセージフィールド</td><td>はい</td></tr><tr><td>oneof内のフィールド</td><td>はい</td></tr><tr><td>繰り返しフィールド & マップ</td><td>いいえ</td></tr></tbody></table><p><strong>Proto3:</strong></p><p>フィールドの存在を追跡しますか？</p><table><thead><tr><th>フィールドの種類</th><th>追跡されますか？</th></tr></thead><tbody><tr><td><em>その他</em> 単一のフィールド</td><td><code>optional</code>として定義されている場合</td></tr><tr><td>単一のメッセージフィールド</td><td>はい</td></tr><tr><td>oneof内のフィールド</td><td>はい</td></tr><tr><td>繰り返しフィールド & マップ</td><td>いいえ</td></tr></tbody></table><p><strong>Edition 2023:</strong></p><p>フィールドの存在を追跡しますか？</p><table><thead><tr><th>フィールドの種類</th><th>追跡されますか？</th></tr></thead><tbody><tr><td>デフォルト</td><td>はい</td></tr><tr><td><code>features.field_presence</code>が<code>LEGACY_REQUIRED</code>に設定されている場合</td><td>はい</td></tr><tr><td><code>features.field_presence</code>が<code>IMPLICIT</code>に設定されている場合</td><td>いいえ</td></tr><tr><td>繰り返しフィールド & マップ</td><td>いいえ</td></tr></tbody></table><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback></code></pre></div></main><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank rel=noopener href=https://stackoverflow.com/questions/tagged/protocol-buffers aria-label="Stack Overflow"><i class="fab fa-stack-overflow"></i></a></li></ul><script type=text/javascript id=cookiebanner src=https://cdn.jsdelivr.net/gh/dobarkod/cookie-banner@1.2.2/dist/cookiebanner.min.js data-height=50px data-message="Protobuf.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic." data-bg=#ffb data-fg=#000 data-position=bottom data-padding="10px 16px" data-close-text="OK, got it" data-font-size=18px data-moreinfo=https://policies.google.com/technologies/cookies></script></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/protocolbuffers/protobuf aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/g/protobuf aria-label="Developer mailing list"><i class="fa fa-envelope"></i></a></li></ul><script type=text/javascript id=cookiebanner src=https://cdn.jsdelivr.net/gh/dobarkod/cookie-banner@1.2.2/dist/cookiebanner.min.js data-height=50px data-message="Protobuf.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic." data-bg=#ffb data-fg=#000 data-position=bottom data-padding="10px 16px" data-close-text="OK, got it" data-font-size=18px data-moreinfo=https://policies.google.com/technologies/cookies></script></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2024 Google LLC All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank rel=noopener>プライバシーポリシー</a></small>
<span class=text-white>Hosted by GitHub Pages.</span> <a href=https://docs.github.com/en/site-policy/privacy-policies/github-privacy-statement target=_blank>GitHub Privacy Statement</a></div></div></div></footer></div><script src=/js/main.min.ba08a6b7f24e657f0a1b9b55be3a3162585168cd862ace0957f5b44e6cb6dc61.js integrity="sha256-ugimt/JOZX8KG5tVvjoxYlhRaM2GKs4JV/W0Tmy23GE=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>