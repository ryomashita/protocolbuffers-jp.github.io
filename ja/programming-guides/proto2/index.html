<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=ja class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.121.2"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>言語ガイド（proto 2） | Protocol Buffers Documentation</title>
<meta name=description content="プロジェクトでプロトコルバッファのバージョン2を使用する方法について説明します。"><meta property="og:title" content="言語ガイド（proto 2）"><meta property="og:description" content="プロジェクトでプロトコルバッファのバージョン2を使用する方法について説明します。"><meta property="og:type" content="article"><meta property="og:url" content="https://protobuf.dev/ja/programming-guides/proto2/"><meta property="article:section" content="programming-guides"><meta itemprop=name content="言語ガイド（proto 2）"><meta itemprop=description content="プロジェクトでプロトコルバッファのバージョン2を使用する方法について説明します。"><meta itemprop=wordCount content="3072"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="言語ガイド（proto 2）"><meta name=twitter:description content="プロジェクトでプロトコルバッファのバージョン2を使用する方法について説明します。"><link rel=preload href=/scss/main.min.6a57e8f3f347dea5d31cb48e3b4ea9fdae32d499473089bdef9b45457b5debb8.css as=style><link href=/scss/main.min.6a57e8f3f347dea5d31cb48e3b4ea9fdae32d499473089bdef9b45457b5debb8.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-5L8P8GRN4Y"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5L8P8GRN4Y")}</script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/ja/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Protocol Buffers Documentation</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>日本語</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/programming-guides/proto2/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder=サイトを検索... aria-label=サイトを検索... autocomplete=off></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder=サイトを検索... aria-label=サイトを検索... autocomplete=off></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>日本語</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/programming-guides/proto2/>English</a></div></div><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-ja-li><a href=/ja/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-ja><span>Protocol Buffers</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jaoverview-li><a href=/ja/overview/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jaoverview><span>概要</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-janews-li><a href=/ja/news/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-janews><span>ニュース</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janews2022-05-06-li><a href=/ja/news/2022-05-06/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janews2022-05-06><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janews2023-07-06-li><a href=/ja/news/2023-07-06/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janews2023-07-06><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janews2023-08-09-li><a href=/ja/news/2023-08-09/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janews2023-08-09><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janews2023-08-15-li><a href=/ja/news/2023-08-15/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janews2023-08-15><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janews2023-09-15-li><a href=/ja/news/2023-09-15/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janews2023-09-15><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janews2023-12-27-li><a href=/ja/news/2023-12-27/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janews2023-12-27><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janews2024-06-26-li><a href=/ja/news/2024-06-26/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janews2024-06-26><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-japrogramming-guides-li><a href=/ja/programming-guides/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-japrogramming-guides><span>プログラミングガイド</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-japrogramming-guidesproto2-li><a href=/ja/programming-guides/proto2/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesproto2><span class=td-sidebar-nav-active-item>言語ガイド（proto 2）</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesproto3-li><a href=/ja/programming-guides/proto3/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesproto3><span>言語ガイド（proto 3）</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesstyle-li><a href=/ja/programming-guides/style/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesstyle><span>スタイルガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesaddons-li><a href=/ja/programming-guides/addons/ title=サードパーティーアドオン class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesaddons><span>アドオン</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesapi-li><a href=/ja/programming-guides/api/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesapi><span>API ベストプラクティス</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesdos-donts-li><a href=/ja/programming-guides/dos-donts/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesdos-donts><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesencoding-li><a href=/ja/programming-guides/encoding/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesencoding><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesenum-li><a href=/ja/programming-guides/enum/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesenum><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesextension_declarations-li><a href=/ja/programming-guides/extension_declarations/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesextension_declarations><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesfield_presence-li><a href=/ja/programming-guides/field_presence/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesfield_presence><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesserialization-not-canonical-li><a href=/ja/programming-guides/serialization-not-canonical/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesserialization-not-canonical><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidestechniques-li><a href=/ja/programming-guides/techniques/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidestechniques><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jaeditions-li><a href=/ja/editions/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jaeditions><span>Protobuf Editions</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jaeditionsoverview-li><a href=/ja/editions/overview/ title="Protobuf Editions の概要" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jaeditionsoverview><span>概要</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jaeditionsfeatures-li><a href=/ja/editions/features/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jaeditionsfeatures><span>エディション向けの機能設定</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jaeditionsimplementation-li><a href=/ja/editions/implementation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jaeditionsimplementation><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jagetting-started-li><a href=/ja/getting-started/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jagetting-started><span>チュートリアル</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jagetting-startedcpptutorial-li><a href=/ja/getting-started/cpptutorial/ title="プロトコルバッファの基礎: C++" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jagetting-startedcpptutorial><span>C++</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jagetting-startedcsharptutorial-li><a href=/ja/getting-started/csharptutorial/ title="Protocol Buffer Basics: C#" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jagetting-startedcsharptutorial><span>C#</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jagetting-starteddarttutorial-li><a href=/ja/getting-started/darttutorial/ title="Protocol Buffer Basics: Dart" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jagetting-starteddarttutorial><span>Dart</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jagetting-startedgotutorial-li><a href=/ja/getting-started/gotutorial/ title="プロトコルバッファの基本: Go" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jagetting-startedgotutorial><span>Go</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jagetting-startedjavatutorial-li><a href=/ja/getting-started/javatutorial/ title="プロトコルバッファの基礎: Java" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jagetting-startedjavatutorial><span>Java</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jagetting-startedkotlintutorial-li><a href=/ja/getting-started/kotlintutorial/ title="Protocol Buffer Basics: Kotlin" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jagetting-startedkotlintutorial><span>Kotlin</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jagetting-startedpythontutorial-li><a href=/ja/getting-started/pythontutorial/ title="プロトコルバッファの基礎: Python" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jagetting-startedpythontutorial><span>Python</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareference-li><a href=/ja/reference/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareference><span>リファレンスガイド</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferencecpp-li><a href=/ja/reference/cpp/ title="C++ リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencecpp><span>C++</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppcpp-generated-li><a href=/ja/reference/cpp/cpp-generated/ title="C++ 生成コードガイド" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppcpp-generated><span>生成コードガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecpparenas-li><a href=/ja/reference/cpp/arenas/ title="C++ アリーナ割り当てガイド" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecpparenas><span>アリーナ割り当てガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docs-link-li><a href=/reference/cpp/api-docs/ target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docs-link><span>C++ API</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilercpp_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.cpp_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilercpp_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilercsharp_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.csharp_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilercsharp_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilercsharp_names-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.csharp_names/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilercsharp_names><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerjava_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.java_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerjava_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerjava_names-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.java_names/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerjava_names><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerjavanano_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.javanano_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerjavanano_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerjs_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.js_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerjs_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerobjectivec_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.objectivec_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerobjectivec_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerparser-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.parser/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerparser><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerplugin-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.plugin/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerplugin><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerpluginpb-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.plugin.pb/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerpluginpb><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerpython_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.python_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerpython_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerruby_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.ruby_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerruby_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufdescriptorpb-li><a href=/ja/reference/cpp/api-docs/google.protobuf.descriptor.pb/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufdescriptorpb><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufdynamic_message-li><a href=/ja/reference/cpp/api-docs/google.protobuf.dynamic_message/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufdynamic_message><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufutilfield_comparator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.util.field_comparator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufutilfield_comparator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufutiljson_util-li><a href=/ja/reference/cpp/api-docs/google.protobuf.util.json_util/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufutiljson_util><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufutiltype_resolver-li><a href=/ja/reference/cpp/api-docs/google.protobuf.util.type_resolver/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufutiltype_resolver><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufutiltype_resolver_util-li><a href=/ja/reference/cpp/api-docs/google.protobuf.util.type_resolver_util/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufutiltype_resolver_util><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferencecsharp-li><a href=/ja/reference/csharp/ title="C# リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencecsharp><span>C#</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecsharpcsharp-generated-li><a href=/ja/reference/csharp/csharp-generated/ title="C# 生成コードガイド" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecsharpcsharp-generated><span>生成コードガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecsharpapi-docs-link-li><a href=/reference/csharp/api-docs target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecsharpapi-docs-link><span>C# API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferencedart-li><a href=/ja/reference/dart/ title="Dart リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencedart><span>Dart</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencedartdart-generated-li><a href=/ja/reference/dart/dart-generated/ title="Dart Generated Code" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencedartdart-generated><span>生成されたコード</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencedartapi-docs-link-li><a href=https://pub.dartlang.org/documentation/protobuf target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencedartapi-docs-link><span>Dart API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferencego-li><a href=/ja/reference/go/ title=Goリファレンス class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencego><span>Go</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencegogo-generated-li><a href=/ja/reference/go/go-generated/ title="Go Generated Code Guide" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencegogo-generated><span>生成されたコードガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencegoapi-docs-link-li><a href=https://pkg.go.dev/google.golang.org/protobuf/proto target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencegoapi-docs-link><span>Go API</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencegofaq-li><a href=/ja/reference/go/faq/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencegofaq><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencegosize-li><a href=/ja/reference/go/size/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencegosize><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferencejava-li><a href=/ja/reference/java/ title="Java リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencejava><span>Java</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencejavajava-generated-li><a href=/ja/reference/java/java-generated/ title=Java生成コードガイド class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencejavajava-generated><span>生成コードガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencejavajava-proto-names-li><a href=/ja/reference/java/java-proto-names/ title="Java Proto Names" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencejavajava-proto-names><span>生成されたProto名</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencejavaapi-docs-link-li><a href=/reference/java/api-docs/overview-summary.html target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencejavaapi-docs-link><span>Java API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferencekotlin-li><a href=/ja/reference/kotlin/ title="Kotlin リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencekotlin><span>Kotlin</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencekotlinapi-docs-li><a href=/ja/reference/kotlin/api-docs/ title="Kotlin リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencekotlinapi-docs><span>Kotlin</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencekotlinkotlin-generated-li><a href=/ja/reference/kotlin/kotlin-generated/ title="Kotlin 生成コードガイド" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencekotlinkotlin-generated><span>生成コードガイド</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferenceobjective-c-li><a href=/ja/reference/objective-c/ title="Objective-C リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferenceobjective-c><span>Objective-C</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferenceobjective-cobjective-c-generated-li><a href=/ja/reference/objective-c/objective-c-generated/ title="Objective-C 生成コードガイド" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferenceobjective-cobjective-c-generated><span>生成コードガイド</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferencephp-li><a href=/ja/reference/php/ title="PHP リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencephp><span>PHP</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencephpphp-generated-li><a href=/ja/reference/php/php-generated/ title="PHP 生成コードガイド" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencephpphp-generated><span>生成コードガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencephpapi-docs-link-li><a href=/reference/php/api-docs/ target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencephpapi-docs-link><span>PHP API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferencepython-li><a href=/ja/reference/python/ title="Python リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencepython><span>Python</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencepythonpython-generated-li><a href=/ja/reference/python/python-generated/ title="Python 生成コードガイド" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencepythonpython-generated><span>生成コードガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencepythonapi-docs-link-li><a href=https://googleapis.dev/python/protobuf/latest/ target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencepythonapi-docs-link><span>Python API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferenceruby-li><a href=/ja/reference/ruby/ title="Ruby リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferenceruby><span>Ruby</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencerubyruby-generated-li><a href=/ja/reference/ruby/ruby-generated/ title="Ruby Generated Code Guide" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencerubyruby-generated><span>生成されたコードガイド</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferenceprotobuf-li><a href=/ja/reference/protobuf/ title=プロトコルバッファリファレンス class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferenceprotobuf><span>プロトコルバッファ</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferenceprotobufedition-2023-spec-li><a href=/ja/reference/protobuf/edition-2023-spec/ title="Protocol Buffers Edition 2023 言語仕様" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferenceprotobufedition-2023-spec><span>2023 言語仕様</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferenceprotobufproto2-spec-li><a href=/ja/reference/protobuf/proto2-spec/ title="Protocol Buffers Version 2 言語仕様" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferenceprotobufproto2-spec><span>Version 2 言語仕様</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferenceprotobufproto3-spec-li><a href=/ja/reference/protobuf/proto3-spec/ title="Protocol Buffers Version 3 言語仕様" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferenceprotobufproto3-spec><span>Version 3 言語仕様</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferenceprotobuftextformat-spec-li><a href=/ja/reference/protobuf/textformat-spec/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferenceprotobuftextformat-spec><span>テキスト形式言語仕様</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferenceprotobufgoogleprotobuf-li><a href=/ja/reference/protobuf/google.protobuf/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferenceprotobufgoogleprotobuf><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferenceother-li><a href=/ja/reference/other/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferenceother><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jasupport-li><a href=/ja/support/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jasupport><span>サポート</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jasupportversion-support-li><a href=/ja/support/version-support/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jasupportversion-support><span>バージョンサポート</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jasupportcross-version-runtime-guarantee-li><a href=/ja/support/cross-version-runtime-guarantee/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jasupportcross-version-runtime-guarantee><span>クロスバージョンランタイム保証</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jasupportmigration-li><a href=/ja/support/migration/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jasupportmigration><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jaforum-link-li><a href=https://groups.google.com/g/protobuf target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jaforum-link><span>フォーラム</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jadownloads-li><a href=/ja/downloads/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jadownloads><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jahistory-li><a href=/ja/history/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jahistory><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janavbar-li><a href=/ja/navbar/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janavbar><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jasearch-li><a href=/ja/search/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jasearch><span>検索結果</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/protocolbuffers/protocolbuffers.github.io/tree/main/content/programming-guides/proto2.ja.md class=td-page-meta--view target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/protocolbuffers/protocolbuffers.github.io/edit/main/content/programming-guides/proto2.ja.md class=td-page-meta--edit target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> ページの編集</a>
<a href="https://github.com/protocolbuffers/protocolbuffers.github.io/new/main/content/programming-guides/proto2.ja.md?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class=td-page-meta--child target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> 子ページを作成</a>
<a href="https://github.com/protocolbuffers/protocolbuffers.github.io/issues/new?title=%e8%a8%80%e8%aa%9e%e3%82%ac%e3%82%a4%e3%83%89%ef%bc%88proto%202%ef%bc%89" class=td-page-meta--issue target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> ドキュメントのissueを作成</a>
<a href=https://github.com/protocolbuffers/protobuf/issues/new class=td-page-meta--project-issue target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> プロジェクトのissueを作成</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#simple>メッセージタイプの定義</a><ul><li><a href=#specifying-types>フィールドタイプの指定</a></li><li><a href=#assigning>フィールド番号の割り当て</a></li><li><a href=#field-labels>フィールドラベルの指定</a></li><li><a href=#adding-types>Adding More Message Types</a></li><li><a href=#adding-comments>Adding Comments</a></li><li><a href=#deleting>フィールドの削除</a></li><li><a href=#reserved-field-numbers>予約されたフィールド番号</a></li><li><a href=#generated><code>.proto</code>から生成されるものは何ですか？</a></li></ul></li><li><a href=#scalar>スカラー値の型</a></li><li><a href=#optional>オプションフィールドとデフォルト値</a></li><li><a href=#enum>列挙型</a><ul><li><a href=#reserved>予約済みの値</a></li></ul></li><li><a href=#other>他のメッセージタイプの使用</a><ul><li><a href=#importing>定義のインポート</a></li><li><a href=#proto3>proto3 メッセージタイプの使用</a></li></ul></li><li><a href=#nested>ネストしたタイプ</a><ul><li><a href=#groups>グループ</a></li></ul></li><li><a href=#updating>メッセージタイプの更新</a></li><li><a href=#unknowns>未知のフィールド</a></li><li><a href=#extensions>拡張</a><ul><li><a href=#why-ext>拡張を使用する理由</a></li><li><a href=#ext-example>拡張の例</a></li><li><a href=#defining-ranges>拡張範囲の定義</a></li><li><a href=#choosing>拡張番号の選択</a></li><li><a href=#specifying-extension-types>拡張タイプの指定</a></li><li><a href=#nested-exts>ネストされた拡張（推奨されない）</a></li></ul></li><li><a href=#any>Any</a></li><li><a href=#oneof>Oneof</a><ul><li><a href=#using-oneof>Oneofの使用</a></li><li><a href=#oneof-features>Oneofの機能</a></li><li><a href=#backward>互換性の問題</a></li></ul></li><li><a href=#maps>マップ</a><ul><li><a href=#maps-features>マップの機能</a></li><li><a href=#backwards>逆互換性</a></li></ul></li><li><a href=#packages>パッケージ</a><ul><li><a href=#name-resolution>パッケージと名前解決</a></li></ul></li><li><a href=#services>サービスの定義</a></li><li><a href=#json>JSON マッピング</a><ul><li><a href=#json-options>JSON オプション</a></li></ul></li><li><a href=#options>オプション</a><ul><li><a href=#enum-value-options>Enum Value Options</a></li><li><a href=#customoptions>Custom Options</a></li><li><a href=#option-retention>オプションの保持</a></li><li><a href=#option-targets>オプションのターゲット</a></li></ul></li><li><a href=#generating>クラスの生成</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=https://protobuf.dev/ja/programming-guides/>プログラミングガイド</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://protobuf.dev/ja/programming-guides/proto2/ aria-disabled=true class="btn-link disabled">言語ガイド（proto 2）</a></li></ol></nav><div class=td-content><h1>言語ガイド（proto 2）</h1><div class=lead>プロジェクトでプロトコルバッファのバージョン2を使用する方法について説明します。</div><header class=article-meta></header><p>このガイドでは、プロトコルバッファ言語を使用してプロトコルバッファデータを構造化する方法について説明します。<code>.proto</code>ファイルの構文や<code>.proto</code>ファイルからデータアクセスクラスを生成する方法を含みます。このガイドは、プロトコルバッファ言語の<strong>proto2</strong>バージョンをカバーしています。<strong>proto3</strong>構文に関する情報は、<a href=/programming-guides/proto3>Proto3 言語ガイド</a>を参照してください。</p><p>これはリファレンスガイドです。このドキュメントで説明されている多くの機能を使用するステップバイステップの例については、選択した言語の<a href=/getting-started>tutorial</a>を参照してください。</p><h2 id=simple>メッセージタイプの定義</h2><p>まず、非常にシンプルな例を見てみましょう。検索リクエストメッセージ形式を定義したいとします。各検索リクエストには、クエリ文字列、興味のある結果ページ、およびページごとの結果数が含まれます。以下は、メッセージタイプを定義するために使用する<code>.proto</code>ファイルです。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#000>syntax</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;proto2&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>SearchRequest</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>page_number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>results_per_page</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><ul><li>ファイルの最初の行は、<code>proto2</code>構文を使用していることを指定しています。これは、ファイルの最初の空でないコメント行でなければなりません。</li><li><code>SearchRequest</code>メッセージ定義は、このタイプのメッセージに含めたいデータの各部分に対して1つずつ、合計3つのフィールド（名前/値のペア）を指定します。各フィールドには名前とタイプがあります。</li></ul><h3 id=specifying-types>フィールドタイプの指定</h3><p>前述の例では、すべてのフィールドが<a href=#scalar>スカラータイプ</a>であり、2つの整数（<code>page_number</code>と<code>results_per_page</code>）と1つの文字列（<code>query</code>）が含まれています。また、<a href=#enum>列挙型</a>や他のメッセージタイプのような複合型をフィールドに指定することもできます。</p><h3 id=assigning>フィールド番号の割り当て</h3><p>メッセージ定義内の各フィールドには、以下の制限を持つ<code>1</code>から<code>536,870,911</code>の間の番号を割り当てる必要があります。</p><ul><li>指定された番号は、そのメッセージのすべてのフィールドの中で<strong>一意である必要があります</strong>。</li><li>フィールド番号<code>19,000</code>から<code>19,999</code>は、プロトコルバッファの実装用に予約されています。プロトコルバッファコンパイラは、これらの予約されたフィールド番号のいずれかをメッセージで使用すると警告を出します。</li><li>以前に<a href=#fieldreserved>予約された</a>フィールド番号や<a href=#extensions>拡張</a>に割り当てられたフィールド番号を使用することはできません。</li></ul><p>この番号は、メッセージのワイヤ形式でのフィールドを識別するために使用されるため、<strong>メッセージタイプが使用中である場合には変更できません</strong>。フィールド番号を「変更する」とは、そのフィールドを削除し、同じタイプの新しいフィールドを新しい番号で作成することと同等です。これを適切に行う方法については、<a href=#deleting>フィールドの削除</a>を参照してください。</p><p>フィールド番号は<strong>決して再利用してはいけません</strong>。新しいフィールド定義で再利用するために、<a href=#fieldreserved>予約済み</a>リストからフィールド番号を取り出してはいけません。フィールド番号を再利用することの結果については、<a href=#consequences>フィールド番号の再利用の影響</a>を参照してください。</p><p>最も頻繁に設定されるフィールドには、フィールド番号1から15を使用する必要があります。低いフィールド番号値は、ワイヤ形式でのスペースを取らないためです。たとえば、1から15の範囲のフィールド番号は、1バイトでエンコードされます。16から2047の範囲のフィールド番号は2バイトを取ります。これについて詳しくは、<a href=/programming-guides/encoding#structure>プロトコルバッファエンコーディング</a>を参照してください。</p><h4 id=consequences>フィールド番号の再利用の影響</h4><p>フィールド番号を再利用すると、ワイヤ形式のメッセージのデコードが曖昧になります。</p><p>Protobufのワイヤ形式はシンプルであり、エンコード時に使用された定義とデコード時に使用された定義を区別する方法を提供しません。</p><p>1つの定義でフィールドをエンコードし、異なる定義で同じフィールドをデコードすることは、次のような問題を引き起こす可能性があります：</p><ul><li>デバッグに費やされる開発者の時間</li><li>パース/マージエラー（最良の場合）</li><li>PII/SPIIの漏洩</li><li>データの破損</li></ul><p>フィールド番号の再利用の一般的な原因：</p><ul><li>フィールドの番号を変更する（フィールドの番号順序をより見栄えの良いものにするために行われることがあります）。フィールドの番号を変更することは、事実上、再利用されるすべてのフィールドを削除して再追加し、互換性のないワイヤ形式の変更をもたらします。</li><li>フィールドを削除し、将来の再利用を防ぐために番号を<a href=#fieldreserved>予約</a>しない。これは、<a href=#extensions>拡張フィールド</a>に関して非常に簡単に起こり得る間違いでした。<a href=/programming-guides/extension_declarations>拡張宣言</a>は、拡張フィールドを予約するメカニズムを提供します。</li></ul><p>最大フィールドは、3つの下位ビットがワイヤ形式に使用されているため、通常の32ビットではなく29ビットです。詳細については、<a href=/programming-guides/encoding#structure>エンコーディングトピック</a>を参照してください。</p><p><a id=specifying-rules></a></p><h3 id=field-labels>フィールドラベルの指定</h3><p>メッセージフィールドは次のいずれかになります:</p><ul><li><p><code>optional</code>: <code>optional</code>フィールドは次の2つの状態のいずれかです:</p><ul><li>フィールドが設定され、ワイヤから明示的に設定された値または解析された値を含んでいます。ワイヤにシリアル化されます。</li><li>フィールドが未設定で、デフォルト値が返されます。ワイヤにシリアル化されません。</li></ul><p>値が明示的に設定されたかどうかを確認できます。</p></li><li><p><code>repeated</code>: このフィールドタイプは、整形されたメッセージ内でゼロ回以上繰り返すことができます。繰り返し値の順序が保持されます。</p></li><li><p><code>map</code>: これはキー/値のペアフィールドタイプです。このフィールドタイプについては、<a href=/programming-guides/encoding#maps>Maps</a>を参照してください。</p></li><li><p><code>required</code>: <strong>使用しないでください。</strong> 必須フィールドは問題が多いため、proto3から削除されました。必須フィールドのセマンティクスはアプリケーションレイヤーで実装する必要があります。使用する場合、整形されたメッセージにはこのフィールドが1つだけ含まれている必要があります。</p></li></ul><p>歴史的な理由から、スカラー数値型（たとえば、<code>int32</code>、<code>int64</code>、<code>enum</code>）の<code>repeated</code>フィールドは、効率的にエンコードされていません。新しいコードでは、より効率的なエンコーディングを得るために特別なオプション <code>[packed = true]</code> を使用する必要があります。例:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>samples</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>packed</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>ProtoEnum</span> <span style=color:#000>results</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5</span> <span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>packed</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span></code></pre></div><p><code>packed</code>エンコーディングについて詳細は、<a href=/programming-guides/encoding#packed>Protocol Buffer Encoding</a>を参照してください。</p><div class="alert alert-warning" role=alert><h4 class=alert-heading>重要</h4><strong>必須は永遠に</strong>
前述のように <strong><code>required</code> は新しいフィールドに使用してはいけません</strong>。必須フィールドのセマンティクスは代わりにアプリケーションレイヤーで実装する必要があります。
既存の<code>required</code>フィールドは、メッセージ定義の永続的で変更不可能な要素として扱われるべきです。<code>required</code>から<code>optional</code>に安全に変更することはほぼ不可能です。古いリーダーが存在する可能性がある場合、このフィールドがないメッセージを不完全と見なし、拒否または破棄する可能性があります。</div><p>第二の問題は、必須フィールドに値を追加した場合に発生します。この場合、認識されないenum値は欠落したものとして扱われ、これにより必須値のチェックも失敗します。</p><h4 id=well-formed>Well-formed Messages</h4><p>「well-formed」という用語は、protobufメッセージに適用されると、シリアル化/デシリアル化されたバイトを指します。protocパーサーは、与えられたproto定義ファイルが解析可能であることを検証します。</p><p>複数の値を持つ<code>optional</code>フィールドの場合、protocパーサーは入力を受け入れますが、最後のフィールドのみを使用します。そのため、「バイト」は「well-formed」でないかもしれませんが、生成されるメッセージは1つだけであり、「well-formed」である可能性があります（ただし、同じものをラウンドトリップさせることはできません）。</p><h3 id=adding-types>Adding More Message Types</h3><p>複数のメッセージタイプを1つの<code>.proto</code>ファイルで定義することができます。これは、複数の関連するメッセージを定義する場合に便利です。たとえば、<code>SearchResponse</code>メッセージタイプに対応する応答メッセージ形式を定義したい場合、同じ<code>.proto</code>に追加できます。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>SearchRequest</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>page_number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>results_per_page</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>SearchResponse</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span> <span style=color:#ce5c00;font-weight:700>...</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p><strong>メッセージの結合は膨張を引き起こす</strong> 複数のメッセージタイプ（メッセージ、enum、およびサービスなど）を1つの<code>.proto</code>ファイルで定義できますが、大量のメッセージが1つのファイルで定義されると、依存関係の膨張を引き起こす可能性があります。1つの<code>.proto</code>ファイルあたりでできるだけ少ないメッセージタイプを含めることが推奨されています。</p><h3 id=adding-comments>Adding Comments</h3><p><code>.proto</code>ファイルにコメントを追加するには、C/C++スタイルの<code>//</code>および<code>/* ... */</code>構文を使用します。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#8f5902;font-style:italic>/* SearchRequest represents a search query, with pagination options to
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> * indicate which results to include in the response. */</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>SearchRequest</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>page_number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span>  <span style=color:#8f5902;font-style:italic>// Which page number do we want?
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>results_per_page</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span>  <span style=color:#8f5902;font-style:italic>// Number of results to return per page.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><h3 id=deleting>フィールドの削除</h3><p>フィールドを削除すると、適切に行われない場合に深刻な問題を引き起こす可能性があります。</p><p><strong><code>required</code>フィールドを削除しないでください</strong> これを安全に行うのはほぼ不可能です。</p><p>非必須フィールドが不要になり、すべての参照がクライアントコードから削除された場合、メッセージからフィールド定義を削除することができます。ただし、削除したフィールド番号を<a href=#fieldreserved>予約する必要があります</a>。フィールド番号を予約しないと、将来開発者がその番号を再利用する可能性があります。</p><p><a id=fieldreserved></a></p><h3 id=reserved-field-numbers>予約されたフィールド番号</h3><p>メッセージタイプを<a href=#updating>更新</a>する際に、フィールドを完全に削除したり、コメントアウトしたりすると、将来の開発者がタイプを更新する際にフィールド番号を再利用する可能性があります。これは<a href=#consequences>フィールド番号の再利用の影響</a>で説明されているように深刻な問題を引き起こす可能性があります。これを防ぐために、削除されたフィールド番号を<code>reserved</code>リストに追加してください。</p><p>protocコンパイラは、将来の開発者がこれらの予約されたフィールド番号を使用しようとした場合にエラーメッセージを生成します。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>reserved</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>15</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>9</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#0000cf;font-weight:700>11</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>予約されたフィールド番号の範囲は包括的です（<code>9 to 11</code>は<code>9, 10, 11</code>と同じです）。</p><h4 id=reserved-field-names>予約されたフィールド名</h4><p>古いフィールド名を後で再利用することは一般的に安全ですが、TextProtoやJSONエンコーディングを使用する場合、フィールド名がシリアライズされるため、問題が発生する可能性があります。このリスクを回避するために、削除されたフィールド名を<code>reserved</code>リストに追加できます。</p><p>予約された名前はprotocコンパイラの動作のみに影響し、ランタイムの動作には影響しません。ただし、TextProtoの実装では、予約された名前を持つ未知のフィールドを解析時に破棄する場合があります（他の未知のフィールドと同様にエラーを発生させず、現在はC++およびGoの実装のみがそうしています）。ランタイムのJSONパースは予約された名前には影響されません。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>reserved</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>15</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>9</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#0000cf;font-weight:700>11</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>reserved</span> <span style=color:#4e9a06>&#34;foo&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;bar&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>フィールド名とフィールド番号を同じ<code>reserved</code>ステートメントで混在させることはできないことに注意してください。</p><h3 id=generated><code>.proto</code>から生成されるものは何ですか？</h3><p><code>.proto</code>ファイルに<a href=#generating>protocol bufferコンパイラ</a>を実行すると、コンパイラは、ファイルで説明されているメッセージタイプを操作するために必要な選択した言語のコードを生成します。これには、フィールド値の取得と設定、メッセージを出力ストリームにシリアライズすること、および入力ストリームからメッセージを解析することが含まれます。</p><ul><li>**C++**の場合、コンパイラは、<code>.proto</code>ごとに<code>.h</code>および<code>.cc</code>ファイルを生成し、ファイルで説明されている各メッセージタイプに対するクラスを生成します。</li><li><strong>Java</strong>の場合、コンパイラは、各メッセージタイプに対するクラスと、メッセージクラスインスタンスを作成するための特別な<code>Builder</code>クラスを生成する<code>.java</code>ファイルを生成します。</li><li><strong>Kotlin</strong>の場合、Java生成コードに加えて、各メッセージタイプに対する<code>.kt</code>ファイルを生成し、メッセージインスタンスの作成を簡素化するために使用できるDSLを含めます。</li><li><strong>Python</strong>は少し異なります。Pythonコンパイラは、<code>.proto</code>内の各メッセージタイプの静的記述子を持つモジュールを生成し、これはランタイムで必要なPythonデータアクセスクラスを作成するために<em>メタクラス</em>と共に使用されます。</li><li><strong>Go</strong>の場合、コンパイラは、<code>.pb.go</code>ファイルを生成し、ファイルで説明されている各メッセージタイプに対する型を生成します。</li><li><strong>Ruby</strong>の場合、コンパイラは、メッセージタイプを含むRubyモジュールを生成する<code>.rb</code>ファイルを生成します。</li><li><strong>Objective-C</strong>の場合、コンパイラは、<code>.proto</code>ごとに<code>pbobjc.h</code>および<code>pbobjc.m</code>ファイルを生成し、ファイルで説明されている各メッセージタイプに対するクラスを生成します。</li><li>**C#**の場合、コンパイラは、<code>.proto</code>ごとに<code>.cs</code>ファイルを生成し、ファイルで説明されている各メッセージタイプに対するクラスを生成します。</li><li><strong>Dart</strong>の場合、コンパイラは、<code>.pb.dart</code>ファイルを生成し、ファイルで説明されている各メッセージタイプに対するクラスを生成します。</li></ul><h2 id=scalar>スカラー値の型</h2><p>スカラーメッセージフィールドは、次のいずれかのタイプを持つことができます - テーブルには<code>.proto</code>ファイルで指定されたタイプと、自動生成されたクラスでの対応するタイプが示されています。</p><div style=overflow:auto;width:100%><table style=width:110%><tbody><tr><th>.proto タイプ</th><th>ノート</th><th>C++ タイプ</th><th>Java/Kotlin タイプ<sup>[1]</sup></th><th>Python タイプ<sup>[3]</sup></th><th>Go タイプ</th><th>Ruby タイプ</th><th>C# タイプ</th><th>Dart タイプ</th></tr><tr><td>double</td><td></td><td>double</td><td>double</td><td>float</td><td>*float64</td><td>Float</td><td>double</td><td>double</td></tr><tr><td>float</td><td></td><td>float</td><td>float</td><td>float</td><td>*float32</td><td>Float</td><td>float</td><td>double</td></tr><tr><td>int32</td><td>可変長エンコーディングを使用します。負の値をエンコードするには非効率です - フィールドが負の値を取る可能性が高い場合は、代わりにsint32を使用してください。</td><td>int32</td><td>int</td><td>int</td><td>int32</td><td>FixnumまたはBignum（必要に応じて）</td><td>int</td><td>*int32</td></tr><tr><td>int64</td><td>可変長エンコーディングを使用します。負の値をエンコードするには非効率です - フィールドが負の値を取る可能性が高い場合は、代わりにsint64を使用してください。</td><td>int64</td><td>long</td><td>int/long<sup>[4]</sup></td><td>*int64</td><td>Bignum</td><td>long</td><td>Int64</td></tr><tr><td>uint32</td><td>可変長エンコーディングを使用します。</td><td>uint32</td><td>int<sup>[2]</sup></td><td>int/long<sup>[4]</sup></td><td>*uint32</td><td>FixnumまたはBignum（必要に応じて）</td><td>uint</td><td>int</td></tr><tr><td>uint64</td><td>可変長エンコーディングを使用します。</td><td>uint64</td><td>long<sup>[2]</sup></td><td>int/long<sup>[4]</sup></td><td>*uint64</td><td>Bignum</td><td>ulong</td><td>Int64</td></tr><tr><td>sint32</td><td>可変長エンコーディングを使用します。符号付き整数値です。これらは通常のint32よりも負の数を効率的にエンコードします。</td><td>int32</td><td>int</td><td>int</td><td>int32</td><td>FixnumまたはBignum（必要に応じて）</td><td>int</td><td>*int32</td></tr><tr><td>sint64</td><td>可変長エンコーディングを使用します。符号付き整数値です。これらは通常のint64よりも負の数を効率的にエンコードします。</td><td>int64</td><td>long</td><td>int/long<sup>[4]</sup></td><td>*int64</td><td>Bignum</td><td>long</td><td>Int64</td></tr><tr><td>fixed32</td><td>常に4バイトです。値が2<sup>28</sup>よりも大きい場合は、uint32よりも効率的です。</td><td>uint32</td><td>int<sup>[2]</sup></td><td>int/long<sup>[4]</sup></td><td>*uint32</td><td>FixnumまたはBignum（必要に応じて）</td><td>uint</td><td>int</td></tr><tr><td>fixed64</td><td>常に8バイトです。値が2<sup>56</sup>よりも大きい場合は、uint64よりも効率的です。</td><td>uint64</td><td>long<sup>[2]</sup></td><td>int/long<sup>[4]</sup></td><td>*uint64</td><td>Bignum</td><td>ulong</td><td>Int64</td></tr><tr><td>sfixed32</td><td>常に4バイトです。</td><td>int32</td><td>int</td><td>int</td><td>*int32</td><td>FixnumまたはBignum（必要に応じて）</td><td>int</td><td>int</td></tr><tr><td>sfixed64</td><td>常に8バイトです。</td><td>int64</td><td>long</td><td>int/long<sup>[4]</sup></td><td>*int64</td><td>Bignum</td><td>long</td><td>Int64</td></tr><tr><td>bool</td><td></td><td>bool</td><td>boolean</td><td>bool</td><td>*bool</td><td>TrueClass/FalseClass</td><td>bool</td><td>bool</td></tr><tr><td>string</td><td>文字列は常にUTF-8エンコード<sup>[5]</sup>または7ビットASCIIテキストを含む必要があり、2<sup>32</sup>より長くすることはできません。</td><td>string</td><td>String</td><td>unicode（Python 2）またはstr（Python 3）</td><td>*string</td><td>String（UTF-8）</td><td>string</td><td>String</td></tr><tr><td>bytes</td><td>2<sup>32</sup>より長くない任意のバイトシーケンスを含むことができます。</td><td>string</td><td>ByteString</td><td>bytes</td><td>[]byte</td><td>String（ASCII-8BIT）</td><td>ByteString</td><td>List<int></td></tr></tbody></table></div><p><sup>[1]</sup> Kotlinは、Javaと対応する型を使用し、Java/Kotlinの混在するコードベースでの互換性を確保します。</p><p><sup>[2]</sup> Javaでは、符号付きの対応する型を使用して、符号なしの32ビットおよび64ビット整数を表現し、最上位ビットは単純に符号ビットに格納されます。</p><p><sup>[3]</sup> すべての場合において、フィールドに値を設定すると、その値が有効であることを確認するために型チェックが実行されます。</p><p><sup>[4]</sup> 64ビットまたは符号なしの32ビット整数は、デコードされると常にlongとして表現されますが、フィールドを設定する際にintが指定された場合はintになります。すべての場合において、設定されたときに表現される型に値が収まる必要があります。[2]を参照してください。</p><p><sup>[5]</sup> Proto2では、通常、文字列フィールドのUTF-8の有効性をチェックしません。ただし、言語によって動作が異なり、無効なUTF-8データは文字列フィールドに保存すべきではありません。</p><p>これらの型がどのようにエンコードされるかについては、メッセージをシリアライズする際の<a href=/programming-guides/encoding>Protocol Buffer Encoding</a>を参照してください。</p><h2 id=optional>オプションフィールドとデフォルト値</h2><p>前述のように、メッセージの説明の要素は<code>optional</code>とラベル付けされることがあります。整形されたメッセージには、オプションの要素が含まれていても含まれていなくても構いません。メッセージが解析されると、エンコードされたメッセージにオプションの要素が含まれていない場合、解析されたオブジェクトの対応するフィールドにアクセスすると、そのフィールドのデフォルト値が返されます。デフォルト値はメッセージの説明の一部として指定できます。たとえば、<code>SearchRequest</code>の<code>result_per_page</code>の値にデフォルト値10を指定したい場合は次のようにします。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>result_per_page</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span> <span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>default</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>オプションの要素にデフォルト値が指定されていない場合、型固有のデフォルト値が代わりに使用されます。</p><ul><li>文字列の場合、デフォルト値は空の文字列です。</li><li>バイトの場合、デフォルト値は空のバイトです。</li><li>ブールの場合、デフォルト値はfalseです。</li><li>数値型の場合、デフォルト値はゼロです。</li><li>列挙型の場合、デフォルト値は<strong>最初に定義された列挙値</strong>です。</li></ul><p>列挙型のデフォルト値は最初に定義された列挙値であるため、列挙値リストの先頭に値を追加する際には注意が必要です。定義を安全に変更する方法については、<a href=#updating>メッセージタイプの更新</a>セクションを参照してください。</p><h2 id=enum>列挙型</h2><p>メッセージタイプを定義する際、事前に定義された値のリストの中から1つだけを持つようにしたい場合があります。たとえば、各 <code>SearchRequest</code> に <code>corpus</code> フィールドを追加したいとします。ここで、corpus は <code>UNIVERSAL</code>、<code>WEB</code>、<code>IMAGES</code>、<code>LOCAL</code>、<code>NEWS</code>、<code>PRODUCTS</code>、または <code>VIDEO</code> のいずれかであるとします。これは、メッセージ定義に <code>enum</code> を追加することで非常に簡単に行うことができます。<code>enum</code> 型のフィールドは、指定された定数のセットのうちの1つだけを値として持つことができます（異なる値を提供しようとすると、パーサーは未知のフィールドとして扱います）。</p><p>以下の例では、すべての可能な値を持つ <code>Corpus</code> という <code>enum</code> を追加し、<code>Corpus</code> 型のフィールドを追加しています：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>Corpus</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>CORPUS_UNSPECIFIED</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>CORPUS_UNIVERSAL</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>CORPUS_WEB</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>CORPUS_IMAGES</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>CORPUS_LOCAL</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>CORPUS_NEWS</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>CORPUS_PRODUCTS</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>CORPUS_VIDEO</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>7</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>SearchRequest</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>page_number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>results_per_page</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span> <span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>default</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>Corpus</span> <span style=color:#000>corpus</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>default</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>CORPUS_UNIVERSAL</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p><code>SearchRequest</code> は <code>corpus</code> フィールドの値のデフォルトを設定しているため、<code>CORPUS_UNSPECIFIED</code> 値はデフォルトとして使用されません。ワイヤー上で値 0 がエンカウントされた場合には引き続き使用されます。デフォルトを設定していない <code>Corpus</code> 型の他のインスタンスは、デフォルトとして <code>CORPUS_UNSPECIFIED</code> 値が使用されます。</p><p>異なる列挙定数に同じ値を割り当てることでエイリアスを定義することができます。これを行うには、<code>allow_alias</code> オプションを <code>true</code> に設定する必要があります。そうしないと、エイリアスが見つかったときにプロトコルバッファコンパイラが警告メッセージを生成します。エイリアス値はすべて逆シリアル化中に有効ですが、シリアル化中には常に最初の値が使用されます。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>EnumAllowingAlias</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>allow_alias</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>EAA_UNSPECIFIED</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>EAA_STARTED</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>EAA_RUNNING</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>EAA_FINISHED</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>EnumNotAllowingAlias</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>ENAA_UNSPECIFIED</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>ENAA_STARTED</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// ENAA_RUNNING = 1;  // Uncommenting this line will cause a warning message.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>ENAA_FINISHED</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>列挙定数は 32 ビット整数の範囲内にある必要があります。<code>enum</code> 値はワイヤー上で <a href=/programming-guides/encoding>varint エンコーディング</a> を使用するため、負の値は効率が悪く、推奨されません。メッセージ定義内で <code>enum</code> を定義することもできます（前述の例のように）、または外部で定義することもできます。これらの <code>enum</code> は <code>.proto</code> ファイル内の任意のメッセージ定義で再利用することができます。また、1つのメッセージで宣言された <code>enum</code> 型を、別のメッセージのフィールドの型として使用することもできます。その際の構文は <code>_MessageType_._EnumType_</code> を使用します。</p><p><code>enum</code> を使用する <code>.proto</code> ファイルに対してプロトコルバッファコンパイラを実行すると、生成されたコードには、Java、Kotlin、または C++ 用の対応する <code>enum</code> が含まれるか、Python 用の特別な <code>EnumDescriptor</code> クラスが含まれ、ランタイム生成されたクラス内で整数値を持つ一連のシンボリック定数を作成するために使用されます。</p><div class="alert alert-warning" role=alert><h4 class=alert-heading>重要</h4>生成されたコードは、1つの言語に対して数千を下回る列挙子の言語固有の制限の対象となる可能性があります。使用する言語の制限事項を確認してください。</div><div class="alert alert-warning" role=alert><h4 class=alert-heading>重要</h4>現在の動作とは対照的に、列挙型がどのように動作すべきかについての情報は、異なる言語での現在の動作に関しては、<a href=/programming-guides/enum>Enum Behavior</a>を参照してください。</div><p>列挙値を削除することは、永続化されたプロトに対する破壊的な変更です。値を削除する代わりに、値に<code>reserved</code>キーワードを付けて列挙値がコード生成されないようにしたり、値を保持したまま<code>deprecated</code>フィールドオプションを使用して後で削除されることを示すことができます：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>PhoneType</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>PHONE_TYPE_UNSPECIFIED</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>PHONE_TYPE_MOBILE</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>PHONE_TYPE_HOME</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>PHONE_TYPE_WORK</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>deprecated</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>reserved</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>アプリケーションでメッセージの<code>enum</code>を使用する方法の詳細については、選択した言語の<a href=/reference/>生成されたコードガイド</a>を参照してください。</p><h3 id=reserved>予約済みの値</h3><p>列挙型のエントリを完全に削除したり、コメントアウトしたりして列挙型を<a href=#updating>更新</a>する場合、将来のユーザーは、自分の更新を行う際に数値値を再利用することができます。これは、同じ<code>.proto</code>の古いバージョンを後で読み込むと、データの破損、プライバシーバグなどの深刻な問題を引き起こす可能性があります。これが起こらないようにする方法の1つは、削除されたエントリの数値値（および/または名前、JSONシリアライゼーションにも問題を引き起こす可能性がある）が<code>reserved</code>であることを指定することです。プロトコルバッファコンパイラは、将来のユーザーがこれらの識別子を使用しようとすると警告を出します。<code>max</code>キーワードを使用して、予約済みの数値値の範囲が可能な限り最大値になるように指定することができます。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>reserved</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>15</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>9</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#0000cf;font-weight:700>11</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>40</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#204a87;font-weight:700>max</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>reserved</span> <span style=color:#4e9a06>&#34;FOO&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;BAR&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p><code>reserved</code>ステートメント内でフィールド名と数値値を混在させることはできないことに注意してください。</p><h2 id=other>他のメッセージタイプの使用</h2><p>他のメッセージタイプをフィールドタイプとして使用することができます。たとえば、各<code>SearchResponse</code>メッセージに<code>Result</code>メッセージを含めたい場合は、同じ<code>.proto</code>内で<code>Result</code>メッセージタイプを定義し、<code>SearchResponse</code>内で<code>Result</code>タイプのフィールドを指定することができます。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>SearchResponse</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>Result</span> <span style=color:#000>results</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Result</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>url</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>title</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>snippets</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><h3 id=importing>定義のインポート</h3><p>前述の例では、<code>SearchResponse</code> と同じファイルに <code>Result</code> メッセージタイプが定義されていますが、もしフィールドタイプとして使用したいメッセージタイプが別の <code>.proto</code> ファイルで既に定義されている場合はどうなるでしょうか？</p><p>他の <code>.proto</code> ファイルから定義を使用するには、それらを <em>インポート</em> します。別の <code>.proto</code> の定義をインポートするには、ファイルの先頭にインポートステートメントを追加します:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;myproject/other_protos.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>デフォルトでは、直接インポートされた <code>.proto</code> ファイルからのみ定義を使用できます。しかし、時には <code>.proto</code> ファイルを新しい場所に移動する必要があるかもしれません。1つの変更ですべての呼び出し箇所を更新する代わりに、古い場所にプレースホルダーの <code>.proto</code> ファイルを配置し、<code>import public</code> 機能を使用してすべてのインポートを新しい場所に転送できます。</p><p><strong>Java では、<code>import public</code> 機能は使用できません。</strong></p><p><code>import public</code> 依存関係は、<code>import public</code> ステートメントを含む proto をインポートするすべてのコードに移譲的に依存できます。例:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// new.proto
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// すべての定義がここに移動されます
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// old.proto
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// This is the proto that all clients are importing.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>public</span> <span style=color:#4e9a06>&#34;new.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;other.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// client.proto
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;old.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// old.proto と new.proto の定義を使用しますが、other.proto は使用しません
</span></span></span></code></pre></div><p>プロトコルコンパイラは、<code>-I</code>/<code>--proto_path</code> フラグを使用してプロトコルコンパイラのコマンドラインで指定されたディレクトリセット内のインポートファイルを検索します。フラグが指定されていない場合、コンパイラが呼び出されたディレクトリを検索します。一般的には、<code>--proto_path</code> フラグをプロジェクトのルートに設定し、すべてのインポートに完全修飾名を使用する必要があります。</p><h3 id=proto3>proto3 メッセージタイプの使用</h3><p><a href=/programming-guides/proto3>proto3</a> メッセージタイプをインポートして、proto2 メッセージで使用したり、その逆も可能です。ただし、proto2 の列挙型は proto3 構文で使用できません。</p><h2 id=nested>ネストしたタイプ</h2><p>他のメッセージタイプ内でメッセージタイプを定義して使用することができます。次の例では、<code>Result</code> メッセージが <code>SearchResponse</code> メッセージ内で定義されています:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>SearchResponse</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Result</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>url</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>title</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>snippets</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>Result</span> <span style=color:#000>results</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>このメッセージタイプを親メッセージタイプの外で再利用する場合は、<code>_Parent_._Type_</code> として参照します：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>SomeOtherMessage</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>SearchResponse.Result</span> <span style=color:#000>result</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>メッセージを好きなだけ深くネストすることができます。以下の例では、2 つの <code>Inner</code> という名前のネストされた型は、異なるメッセージ内で定義されているため、完全に独立しています：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Outer</span> <span style=color:#000;font-weight:700>{</span>       <span style=color:#8f5902;font-style:italic>// Level 0
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>MiddleAA</span> <span style=color:#000;font-weight:700>{</span>  <span style=color:#8f5902;font-style:italic>// Level 1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Inner</span> <span style=color:#000;font-weight:700>{</span>   <span style=color:#8f5902;font-style:italic>// Level 2
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>      <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int64</span> <span style=color:#000>ival</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>      <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>bool</span>  <span style=color:#000>booly</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>MiddleBB</span> <span style=color:#000;font-weight:700>{</span>  <span style=color:#8f5902;font-style:italic>// Level 1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Inner</span> <span style=color:#000;font-weight:700>{</span>   <span style=color:#8f5902;font-style:italic>// Level 2
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>      <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span>  <span style=color:#000>ival</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>      <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>bool</span>   <span style=color:#000>booly</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><h3 id=groups>グループ</h3><p><strong>グループ機能は非推奨であり、新しいメッセージタイプを作成する際には使用しないでください。代わりにネストされたメッセージタイプを使用してください。</strong></p><p>グループはメッセージ定義内で情報をネストする別の方法です。たとえば、複数の <code>Result</code> を含む <code>SearchResponse</code> を指定する別の方法は次のとおりです：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>SearchResponse</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#204a87;font-weight:700>group</span> <span style=color:#000>Result</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>url</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>title</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>snippets</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>グループは単にネストされたメッセージ型とフィールドを単一の宣言に組み合わせるものです。コード内では、このメッセージを、<code>result</code> という名前の <code>Result</code> 型フィールドを持つかのように扱うことができます（後者の名前は小文字に変換されるため、前者と競合しないようになります）。したがって、この例は以前の <code>SearchResponse</code> とまったく同等であることに注意してください。</p><h2 id=updating>メッセージタイプの更新</h2><p>既存のメッセージタイプがすべてのニーズを満たさなくなった場合（たとえば、メッセージ形式に追加のフィールドが必要になった場合）でも、古い形式で作成されたコードを引き続き使用したい場合は心配しないでください！バイナリワイヤ形式を使用すると、既存のコードを壊すことなくメッセージタイプを簡単に更新できます。</p><div class="alert alert-note" role=alert><h4 class=alert-heading>注意</h4>もし
JSON や
<a href=/reference/protobuf/textformat-spec>proto テキスト形式</a>
を使用してプロトコルバッファメッセージを保存する場合、プロト定義で行える変更は異なります。</div><p><a href=/programming-guides/dos-donts>Proto ベストプラクティス</a> と以下のルールを確認してください：</p><ul><li>既存のフィールドのフィールド番号を変更しないでください。フィールド番号を「変更」することは、フィールドを削除して同じ型の新しいフィールドを追加することと同等です。フィールド番号を変更したい場合は、<a href=#deleting>フィールドの削除</a>の手順を参照してください。</li><li>追加する新しいフィールドは <code>optional</code> または <code>repeated</code> である必要があります。これにより、「古い」メッセージ形式を使用してシリアル化されたメッセージが、新しく生成されたコードによってパースされる際に <code>required</code> 要素が欠落していないため、新しいコードが適切に古いコードによって生成されたメッセージとやり取りできるようになります。これらの要素の<a href=#optional>デフォルト値</a>を考慮して、新しいコードが古いコードによって生成されたメッセージと適切にやり取りできるようにする必要があります。同様に、新しいコードによって作成されたメッセージは、古いコードによってパースされることができます：古いバイナリは、パース時に新しいフィールドを無視します。ただし、未知のフィールドは破棄されず、メッセージが後でシリアル化されると、未知のフィールドはそれと一緒にシリアル化されます。したがって、メッセージが新しいコードに渡される場合、新しいフィールドは引き続き利用可能です。詳細については、<a href=#unknowns>未知のフィールド</a>セクションを参照してください。</li><li>必須でないフィールドは、更新されたメッセージタイプでフィールド番号が再利用されない限り削除できます。フィールド名を変更したり、フィールド番号を<a href=#fieldreserved>予約</a>したりして、将来の <code>.proto</code> のユーザーが誤って番号を再利用しないようにすることができます。</li><li>必須でないフィールドは、タイプと番号が同じであれば、<a href=#extensions>拡張</a>に変換することができます。</li><li><code>int32</code>、<code>uint32</code>、<code>int64</code>、<code>uint64</code>、<code>bool</code> はすべて互換性があります。これは、これらのタイプのフィールドを他のタイプに変更しても、前方互換性や後方互換性が壊れないことを意味します。対応するタイプに収まらない数値がワイヤからパースされた場合、C++ でそのタイプに数値をキャストした場合と同じ効果が得られます（たとえば、64 ビットの数値が int32 として読み取られると、32 ビットに切り捨てられます）。</li><li><code>sint32</code> と <code>sint64</code> は互換性がありますが、他の整数型とは互換性がありません。</li><li><code>string</code> と <code>bytes</code> は、バイトが有効な UTF-8 である限り互換性があります。</li><li>埋め込まれたメッセージは、バイトがメッセージのエンコードバージョンを含んでいる場合、<code>bytes</code> と互換性があります。</li><li><code>fixed32</code> は <code>sfixed32</code> と、<code>fixed64</code> は <code>sfixed64</code> と互換性があります。</li><li><code>string</code>、<code>bytes</code>、およびメッセージフィールドについて、<code>optional</code> は <code>repeated</code> と互換性があります。入力として繰り返しフィールドのシリアル化データが与えられた場合、このフィールドを <code>optional</code> として期待するクライアントは、スカラータイプフィールドの場合は最後の入力値を取得し、メッセージタイプフィールドの場合はすべての入力要素をマージします。これは、数値型（ブール値や列挙型を含む）には<strong>一般的に</strong>安全ではありません。数値型の繰り返しフィールドは、<a href=/programming-guides/encoding#packed>packed</a>形式でシリアル化される可能性があり、<code>optional</code> フィールドが期待される場合には正しくパースされません。</li><li>デフォルト値を変更することは一般的に問題ありません。デフォルト値は決してワイヤを介して送信されません。したがって、プログラムが特定のフィールドが設定されていないメッセージを受信した場合、そのプログラムはそのプロトコルのバージョンで定義されたデフォルト値を見ることになります。送信元のコードで定義されたデフォルト値は見えません。</li><li><code>enum</code> は、ワイヤ形式の観点から <code>int32</code>、<code>uint32</code>、<code>int64</code>、および <code>uint64</code> と互換性があります（値が収まらない場合は切り捨てられます）。ただし、メッセージがデシリアライズされるときにクライアントコードが異なる方法で扱う可能性があることに注意してください。特に、認識されない <code>enum</code> 値は、メッセージがデシリアライズされるときに破棄されるため、フィールドの <code>has..</code> アクセサは false を返し、そのゲッターは <code>enum</code> 定義で最初にリストされている値、または指定されている場合はデフォルト値を返します。繰り返しの列挙型フィールドの場合、認識されない値はリストから削除されます。ただし、整数フィールドは常に値を保持します。そのため、整数を <code>enum</code> にアップグレードする際に、ワイヤ上で範囲外の <code>enum</code> 値を受け取る可能性があることに注意する必要があります。</li><li>現在の Java および C++ の実装では、認識されない <code>enum</code> 値が削除されると、他の未知のフィールドと一緒に格納されます。これにより、これらの値を認識するクライアントがこのデータをシリアル化してから再解析すると、奇妙な動作が発生する可能性があります。オプションフィールドの場合、元のメッセージがデシリアライズされた後に新しい値が書き込まれても、古い値は引き続き認識されます。繰り返しフィールドの場合、認識された値と新たに追加された値の後に古い値が表示されるため、順序が保持されません。</li><li>単一の <code>optional</code> フィールドまたは拡張を新しい <code>oneof</code> のメンバーに変更することはバイナリ互換性がありますが、一部の言語（特に Go）では生成されたコードの API が非互換な方法で変更されます。このため、Google は<a href=https://google.aip.dev/180#moving-into-oneofs>AIP-180</a>で文書化されているように、公開 API でこのような変更を行いません。ソース互換性については同じ警告が適用され、複数のフィールドを新しい <code>oneof</code> に移動することは、一度に複数のフィールドを設定するコードがないことを確認すれば安全かもしれません。既存の <code>oneof</code> にフィールドを移動することは安全ではありません。同様に、単一のフィールド <code>oneof</code> を <code>optional</code> フィールドまたは拡張に変更することは安全です。</li><li><code>map&lt;K, V></code> と対応する <code>repeated</code> メッセージフィールドの間でフィールドを変更することはバイナリ互換性があります（メッセージのレイアウトやその他の制限については、以下の<a href=#maps>Maps</a>を参照）。ただし、変更の安全性はアプリケーションに依存します。メッセージをデシリアライズして再シリアライズするとき、<code>repeated</code> フィールド定義を使用するクライアントは、意味的に同一の結果を生成します。ただし、<code>map</code> フィールド定義を使用するクライアントはエントリを並べ替えたり、重複キーのエントリを削除したりする可能性があります。</li></ul><h2 id=unknowns>未知のフィールド</h2><p>未知のフィールドは、パーサーが認識しないフィールドを表す、適切に形成されたプロトコルバッファシリアライズされたデータです。たとえば、古いバイナリが新しいフィールドを持つ新しいバイナリによって送信されたデータを解析するとき、その新しいフィールドは古いバイナリ内の未知のフィールドとなります。</p><p>元々、proto3 メッセージはパース中に常に未知のフィールドを破棄していましたが、バージョン 3.5 では、proto2 の動作に合わせて未知のフィールドの保存を再導入しました。バージョン 3.5 以降では、パース中に未知のフィールドが保持され、シリアライズされた出力に含まれます。</p><h2 id=extensions>拡張</h2><p>拡張とは、通常、コンテナメッセージの <code>.proto</code> ファイルとは別の <code>.proto</code> ファイルで定義されたフィールドです。</p><h3 id=why-ext>拡張を使用する理由</h3><p>拡張を使用する主な理由は次の2つです：</p><ul><li>コンテナメッセージの <code>.proto</code> ファイルには、より少ないインポート/依存関係が含まれます。これにより、ビルド時間が短縮され、循環依存関係が解消され、疎結合が促進されます。拡張はこれに非常に適しています。</li><li>システムが最小限の依存関係と調整でコンテナメッセージにデータをアタッチできるようにします。拡張はこれには適していませんが、限られたフィールド番号スペースと<a href=#consequences>フィールド番号の再利用の影響</a>があります。非常に多くの拡張に対して非常に低い調整が必要なユースケースの場合は、代わりに<a href=/reference/protobuf/google.protobuf#any><code>Any</code> メッセージタイプ</a>を使用することを検討してください。</li></ul><h3 id=ext-example>拡張の例</h3><p>例として、次の拡張を見てみましょう：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// file kittens/video_ext.proto
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;kittens/video.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;media/user_content.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>kittens</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// This extension allows kitten videos in a media.UserContent message.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>media</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>UserContent</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Video is a message imported from kittens/video.proto
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>Video</span> <span style=color:#000>kitten_videos</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>126</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>この拡張を定義するファイル（<code>kittens/video_ext.proto</code>）は、コンテナメッセージのファイル（<code>media/user_content.proto</code>）をインポートしています。</p><p>コンテナメッセージは、拡張のために一部のフィールド番号を予約する必要があります。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// file media/user_content.proto
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>media</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// A container message to hold stuff that a user has created.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>UserContent</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Set verification to `DECLARATION` to enforce extension declarations for all
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// extensions in this range.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>extensions</span> <span style=color:#0000cf;font-weight:700>100</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#0000cf;font-weight:700>199</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>verification</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>DECLARATION</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>コンテナメッセージのファイル（<code>media/user_content.proto</code>）は、メッセージ <code>UserContent</code> を定義し、拡張のために[100 から 199]のフィールド番号を予約しています。範囲に対して <code>verification = DECLARATION</code> を設定して、すべての拡張に宣言が必要になるようにすることを推奨します。</p><p>新しい拡張子（<code>kittens/video_ext.proto</code>）が追加された場合、対応する宣言を<code>UserContent</code>に追加し、<code>verification</code>を削除する必要があります。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>// A container message to hold stuff that a user has created.
</span></span><span style=display:flex><span>message UserContent {
</span></span><span style=display:flex><span>  extensions 100 to 199 [
</span></span><span style=display:flex><span>    declaration = {
</span></span><span style=display:flex><span>      number: 126,
</span></span><span style=display:flex><span>      full_name: &#34;.kittens.kitten_videos&#34;,
</span></span><span style=display:flex><span>      type: &#34;.kittens.Video&#34;,
</span></span><span style=display:flex><span>      repeated: true
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    // Ensures all field numbers in this extension range are declarations.
</span></span><span style=display:flex><span>    verification = DECLARATION
</span></span><span style=display:flex><span>  ];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>UserContent</code>は、フィールド番号<code>126</code>が、完全修飾名<code>.kittens.kitten_videos</code>および完全修飾型<code>.kittens.Video</code>を持つ<code>repeated</code>拡張フィールドによって使用されることを宣言しています。拡張の宣言について詳しくは、<a href=/programming-guides/extension_declarations>拡張の宣言</a>を参照してください。</p><p>コンテナメッセージのファイル（<code>media/user_content.proto</code>）は、子猫ビデオ拡張の定義（<code>kittens/video_ext.proto</code>）を<strong>インポートしていません</strong>。</p><p>拡張フィールドのワイヤーフォーマットエンコーディングは、同じフィールド番号、型、基数を持つ標準フィールドと比較しても違いはありません。したがって、標準フィールドをコンテナから拡張に移動させるか、拡張フィールドをコンテナメッセージに標準フィールドとして移動させることは安全です。ただし、フィールド番号、型、基数が一定である限りです。</p><p>ただし、拡張はコンテナメッセージの外部で定義されているため、特殊なアクセサは特定の拡張フィールドを取得および設定するために生成されません。この例では、protobufコンパイラは<code>AddKittenVideos()</code>や<code>GetKittenVideos()</code>アクセサを<strong>生成しません</strong>。代わりに、拡張は<code>HasExtension()</code>、<code>ClearExtension()</code>、<code>GetExtension()</code>、<code>MutableExtension()</code>、<code>AddExtension()</code>などのパラメータ化された関数を介してアクセスされます。</p><p>C++では、次のようになります：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#000>UserContent</span> <span style=color:#000>user_content</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>user_content</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>AddExtension</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>kittens</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>kitten_videos</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>kittens</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Video</span><span style=color:#000;font-weight:700>());</span>
</span></span><span style=display:flex><span><span style=color:#000>assert</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>user_content</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetExtensionCount</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>kittens</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>kitten_videos</span><span style=color:#000;font-weight:700>));</span>
</span></span><span style=display:flex><span><span style=color:#000>user_content</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetExtension</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>kittens</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>kitten_videos</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>);</span>
</span></span></code></pre></div><h3 id=defining-ranges>拡張範囲の定義</h3><p>コンテナメッセージの所有者である場合、メッセージへの拡張のための拡張範囲を定義する必要があります。</p><p>拡張フィールドに割り当てられたフィールド番号は、標準フィールドに再利用することはできません。</p><p>定義された後で拡張範囲を拡張することは安全です。比較的小さな数値を1000割り当て、拡張の宣言を使用してそのスペースを密に埋めるのが良いデフォルトです：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>ModernExtendableMessage</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// All extensions in this range should use extension declarations.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>extensions</span> <span style=color:#0000cf;font-weight:700>1000</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#0000cf;font-weight:700>2000</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>verification</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>DECLARATION</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>拡張宣言の前に実際の拡張機能を追加する場合は、<code>verification = DECLARATION</code> を追加して、この新しい範囲で宣言が使用されるように強制する必要があります。実際の宣言が追加されると、このプレースホルダを削除できます。</p><p>既存の拡張範囲を同じ合計範囲をカバーする別々の範囲に分割することは安全です。これは、レガシー メッセージ タイプを <a href=/programming-guides/extension_declarations>拡張宣言</a> に移行する際に必要になる場合があります。たとえば、移行前に、範囲は次のように定義されているかもしれません：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>LegacyMessage</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>extensions</span> <span style=color:#0000cf;font-weight:700>1000</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#204a87;font-weight:700>max</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>移行後（範囲を分割する）は次のようになります：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>LegacyMessage</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Legacy range that was using an unverified allocation scheme.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>extensions</span> <span style=color:#0000cf;font-weight:700>1000</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#0000cf;font-weight:700>524999999</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>verification</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>UNVERIFIED</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Current range that uses extension declarations.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>extensions</span> <span style=color:#0000cf;font-weight:700>525000000</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#204a87;font-weight:700>max</span>  <span style=color:#000;font-weight:700>[</span><span style=color:#000>verification</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>DECLARATION</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>拡張範囲を移動または縮小するために開始フィールド番号を増やしたり、終了フィールド番号を減らしたりすることは安全ではありません。これらの変更は既存の拡張を無効にする可能性があります。</p><p>proto のほとんどのインスタンスで設定される標準フィールドには、フィールド番号 1 から 15 を使用することをお勧めします。これらの番号を拡張機能に使用することは推奨されません。</p><p>番号付けの規則が非常に大きなフィールド番号を持つ拡張を含む可能性がある場合は、拡張範囲が最大の可能なフィールド番号までであることを指定できます。<code>max</code> キーワードを使用して次のように指定できます：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>extensions</span> <span style=color:#0000cf;font-weight:700>1000</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#204a87;font-weight:700>max</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p><code>max</code> は 2<sup>29</sup> - 1、つまり 536,870,911 です。</p><h3 id=choosing>拡張番号の選択</h3><p>拡張は、コンテナ メッセージの外部で指定できるフィールドです。拡張フィールド番号には <a href=#assigning>フィールド番号の割り当て</a> のすべてのルールが適用されます。同じ <a href=#consequences>フィールド番号の再利用の結果</a> も拡張フィールド番号の再利用に適用されます。</p><p>一意の拡張フィールド番号を選択するのは簡単です。コンテナ メッセージが <a href=/programming-guides/extension_declarations>拡張宣言</a> を使用している場合は、新しい拡張を定義する際に、コンテナ メッセージで定義された最高の拡張範囲からのすべての他の宣言よりも高い最低のフィールド番号を選択します。たとえば、コンテナ メッセージが次のように定義されている場合：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Container</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Legacy range that was using an unverified allocation scheme
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>extensions</span> <span style=color:#0000cf;font-weight:700>1000</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#0000cf;font-weight:700>524999999</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Current range that uses extension declarations. (highest extension range)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>extensions</span> <span style=color:#0000cf;font-weight:700>525000000</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#204a87;font-weight:700>max</span>  <span style=color:#000;font-weight:700>[</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>declaration</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>      <span style=color:#000>number</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>525000001</span><span style=color:#000;font-weight:700>,</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>      <span style=color:#000>full_name</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;.bar.baz_ext&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>      <span style=color:#000>type</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;.bar.Baz&#34;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#8f5902;font-style:italic>// 525,000,002 is the lowest field number above all other declarations
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p><code>Container</code>の次の拡張機能には、番号<code>525000002</code>を追加する必要があります。</p><h4 id=unverified>未検証の拡張番号割り当て（推奨されない）</h4><p>コンテナメッセージの所有者は、自身の未検証の拡張番号割り当て戦略を優先して、拡張宣言を省略することができます。</p><p>未検証の割り当てスキームは、選択した拡張範囲内で拡張フィールド番号を割り当てるために、protobufエコシステム外部のメカニズムを使用します。1つの例として、モノレポのコミット番号を使用することができます。このシステムはprotobufコンパイラの観点から「未検証」であり、適切に取得された拡張フィールド番号を使用しているかどうかを確認する方法がないためです。</p><p>拡張宣言のような検証済みシステムに比べて、未検証システムの利点は、コンテナメッセージの所有者と調整することなく拡張を定義できることです。</p><p>未検証システムのデメリットは、protobufコンパイラが参加者を拡張フィールド番号の再利用から保護できないことです。</p><p><strong>未検証の拡張フィールド番号割り当て戦略は推奨されません</strong>。なぜなら、<a href=#consequences>フィールド番号の再利用の結果</a>はメッセージのすべての拡張者に影響するからです（推奨事項に従わなかった開発者だけでなく）。非常に低い調整が必要な場合は、代わりに<a href=/reference/protobuf/google.protobuf#any><code>Any</code>メッセージ</a>を使用することを検討してください。</p><p>未検証の拡張フィールド番号割り当て戦略は、範囲1から524,999,999に限定されています。フィールド番号525,000,000以上は拡張宣言でのみ使用できます。</p><h3 id=specifying-extension-types>拡張タイプの指定</h3><p>拡張は、<code>oneof</code>や<code>map</code>以外の任意のフィールドタイプであることができます。</p><h3 id=nested-exts>ネストされた拡張（推奨されない）</h3><p>別のメッセージのスコープ内で拡張を宣言することができます：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;common/user_profile.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>puppies</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Photo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>common</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>UserProfile</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>likes_count</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>111</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#ce5c00;font-weight:700>...</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>この場合、この拡張にアクセスするためのC++コードは次のようになります：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#000>UserProfile</span> <span style=color:#000>user_profile</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>user_profile</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SetExtension</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>puppies</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Photo</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>likes_count</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>);</span>
</span></span></code></pre></div><p>言い換えると、<code>likes_count</code> は <code>puppies.Photo</code> のスコープ内で定義されています。</p><p>これは混乱の一般的な原因です: メッセージ型内にネストされた <code>extend</code> ブロックを宣言することは、外部型と拡張型の間に関係があることを意味しません。特に、前述の例は <code>Photo</code> が <code>UserProfile</code> のサブクラスであることを意味しません。単に、シンボル <code>likes_count</code> が <code>Photo</code> のスコープ内で宣言されていることを意味します。それは単に静的メンバーです。</p><p>一般的なパターンは、拡張を拡張のフィールド型のスコープ内に定義することです - 例えば、ここでは、<code>puppies.Photo</code> 型の <code>media.UserContent</code> への拡張が <code>Photo</code> の一部として定義されています:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;media/user_content.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>puppies</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Photo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>media</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>UserContent</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>Photo</span> <span style=color:#000>puppy_photo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>127</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#ce5c00;font-weight:700>...</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>ただし、メッセージ型を持つ拡張をその型内で定義する必要はありません。標準の定義パターンも使用できます:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;media/user_content.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>puppies</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Photo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#ce5c00;font-weight:700>...</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// This can even be in a different file.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>media</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>UserContent</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>Photo</span> <span style=color:#000>puppy_photo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>127</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p><strong>標準（ファイルレベル）構文が推奨</strong>されており、混乱を避けるために使用されます。ネストされた構文は、拡張について既に慣れていないユーザーによってしばしばサブクラス化と誤解されます。</p><h2 id=any>Any</h2><p><code>Any</code> メッセージ型を使用すると、<code>.proto</code> 定義を持たないメッセージを埋め込み型として使用できます。<code>Any</code> は、<code>bytes</code> として任意のシリアライズされたメッセージを含み、そのメッセージのタイプを一意に識別し、解決するためのグローバルに一意な識別子として機能する URL を持ちます。<code>Any</code> 型を使用するには、<code>google/protobuf/any.proto</code> を<a href=#other>import</a>する必要があります。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;google/protobuf/any.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>ErrorStatus</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>string</span> <span style=color:#204a87;font-weight:700>message</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>google.protobuf.Any</span> <span style=color:#000>details</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>特定のメッセージ型のデフォルトのタイプ URL は <code>type.googleapis.com/_packagename_._messagename_</code> です。</p><p>異なる言語の実装は、<code>Any</code> 値を型安全な方法でパックおよびアンパックするためのランタイムライブラリヘルパーをサポートします - たとえば、Java では、<code>Any</code> 型には特別な <code>pack()</code> および <code>unpack()</code> アクセサがあり、C++ では <code>PackFrom()</code> および <code>UnpackTo()</code> メソッドがあります:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Storing an arbitrary message type in Any.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>NetworkErrorDetails</span> <span style=color:#000>details</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>...;</span>
</span></span><span style=display:flex><span><span style=color:#000>ErrorStatus</span> <span style=color:#000>status</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>status</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>add_details</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>PackFrom</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>details</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Reading an arbitrary message from Any.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>ErrorStatus</span> <span style=color:#000>status</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>...;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>for</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Any</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#f57900>detail</span> <span style=color:#000;font-weight:700>:</span> <span style=color:#000>status</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>details</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>detail</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Is</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>NetworkErrorDetails</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>NetworkErrorDetails</span> <span style=color:#000>network_error</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>detail</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>UnpackTo</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>network_error</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>...</span> <span style=color:#000>processing</span> <span style=color:#000>network_error</span> <span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p><strong>現在、<code>Any</code> 型を扱うためのランタイムライブラリは開発中</strong>です。</p><p>含まれるメッセージを少数のタイプに制限し、リストに新しいタイプを追加する前に許可を要求する場合は、<code>Any</code> メッセージ型の代わりに<a href=#extensions>extensions</a>と<a href=/programming-guides/extension_declarations>extension declarations</a>を使用することを検討してください。</p><h2 id=oneof>Oneof</h2><p>メッセージに多くのオプションフィールドがあり、同時に1つのフィールドのみが設定される可能性がある場合、oneof機能を使用してこの動作を強制し、メモリを節約できます。</p><p>Oneofフィールドは、すべてのフィールドが1つのメモリを共有し、同時に1つのフィールドのみが設定できるオプションフィールドのようです。oneofのメンバーのいずれかを設定すると、自動的に他のメンバーがすべてクリアされます。選択した言語に応じて、特別な<code>case()</code>または<code>WhichOneof()</code>メソッドを使用して、oneofのどの値が設定されているか（あれば）を確認できます。</p><p><em>複数の値が設定されている場合、proto内の順序によって決定された最後に設定された値がすべて以前の値を上書きすることに注意してください</em>。</p><p>oneofフィールドのフィールド番号は、包含メッセージ内で一意である必要があります。</p><h3 id=using-oneof>Oneofの使用</h3><p><code>.proto</code>でoneofを定義するには、<code>oneof</code>キーワードに続いてoneof名を指定します。この場合は<code>test_oneof</code>です：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>SampleMessage</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>oneof</span> <span style=color:#000>test_oneof</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>     <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>     <span style=color:#000>SubMessage</span> <span style=color:#000>sub_message</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>9</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>その後、oneof定義にoneofフィールドを追加します。<code>map</code>フィールド以外の任意のタイプのフィールドを追加できますが、<code>required</code>、<code>optional</code>、または<code>repeated</code>キーワードは使用できません。oneofに繰り返しフィールドを追加する必要がある場合は、繰り返しフィールドを含むメッセージを使用できます。</p><p>生成されたコードでは、oneofフィールドには通常の<code>optional</code>フィールドと同じゲッターとセッターがあります。また、oneof内で設定されている値（あれば）を確認するための特別なメソッドも取得できます。選択した言語に関するoneof APIについて詳細を知るには、関連する<a href=/reference/>APIリファレンス</a>を参照してください。</p><h3 id=oneof-features>Oneofの機能</h3><ul><li><p>oneofフィールドを設定すると、oneofの他のメンバーが自動的にクリアされます。したがって、複数のoneofフィールドを設定した場合、最後に設定したフィールドのみが値を保持します。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#000>SampleMessage</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>set_name</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>CHECK</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>has_name</span><span style=color:#000;font-weight:700>());</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Calling mutable_sub_message() will clear the name field and will set
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// sub_message to a new instance of SubMessage with none of its fields set.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>mutable_sub_message</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#000>CHECK</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>has_name</span><span style=color:#000;font-weight:700>());</span>
</span></span></code></pre></div></li><li><p>パーサーがワイヤー上で同じoneofの複数のメンバーに遭遇した場合、解析されたメッセージで使用されるのは最後に見たメンバーのみです。</p></li><li><p>拡張はoneofに対してサポートされていません。</p></li><li><p>oneofは<code>repeated</code>にすることはできません。</p></li><li><p>oneofフィールドに対してはリフレクションAPIが機能します。</p></li><li><p>ワンオブフィールドをデフォルト値に設定する場合（たとえば、int32のワンオブフィールドを0に設定する場合）、そのワンオブフィールドの「case」が設定され、値がワイヤー上でシリアル化されます。</p></li><li><p>C++を使用している場合は、コードがメモリクラッシュを引き起こさないようにしてください。次のサンプルコードはクラッシュします。なぜなら、<code>sub_message</code> が <code>set_name()</code> メソッドを呼び出すことで既に削除されていたからです。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#000>SampleMessage</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>SubMessage</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>sub_message</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>mutable_sub_message</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>set_name</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#000;font-weight:700>);</span>      <span style=color:#8f5902;font-style:italic>// Will delete sub_message
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>sub_message</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>set_</span><span style=color:#000;font-weight:700>...</span>            <span style=color:#8f5902;font-style:italic>// Crashes here
</span></span></span></code></pre></div></li><li><p>再びC++で、ワンオブを持つ2つのメッセージを<code>Swap()</code>する場合、各メッセージはもう一方のワンオブケースで終わることになります。以下の例では、<code>msg1</code> には <code>sub_message</code> が、<code>msg2</code> には <code>name</code> が含まれます。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#000>SampleMessage</span> <span style=color:#000>msg1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>msg1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>set_name</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>SampleMessage</span> <span style=color:#000>msg2</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>msg2</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>mutable_sub_message</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#000>msg1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>swap</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>msg2</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>CHECK</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>msg1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>has_sub_message</span><span style=color:#000;font-weight:700>());</span>
</span></span><span style=display:flex><span><span style=color:#000>CHECK</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>msg2</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>has_name</span><span style=color:#000;font-weight:700>());</span>
</span></span></code></pre></div></li></ul><h3 id=backward>互換性の問題</h3><p>ワンオブフィールドを追加または削除する際には注意してください。ワンオブの値をチェックして<code>None</code>/<code>NOT_SET</code>が返される場合、それはワンオブが設定されていないか、異なるバージョンのワンオブのフィールドに設定されている可能性があることを意味します。ワイヤー上の未知のフィールドがワンオブのメンバーであるかどうかを知る方法がないため、違いを判断する方法はありません。</p><h4 id=reuse>タグの再利用の問題</h4><ul><li><strong>オプションフィールドをワンオブに移動または移動させる</strong>: メッセージがシリアル化および解析された後、一部の情報が失われる可能性があります（一部のフィールドがクリアされます）。ただし、1つのフィールドを<strong>新しい</strong>ワンオブに移動することは安全であり、1つだけが設定されることがわかっている場合は複数のフィールドを移動することもできます。詳細については、<a href=#updating>メッセージタイプの更新</a>を参照してください。</li><li><strong>ワンオブフィールドを削除して追加する</strong>: メッセージがシリアル化および解析された後、現在設定されているワンオブフィールドがクリアされる可能性があります。</li><li><strong>ワンオブを分割または統合する</strong>: これは通常の<code>optional</code>フィールドを移動する場合と同様の問題があります。</li></ul><h2 id=maps>マップ</h2><p>データ定義の一部として連想マップを作成したい場合、プロトコルバッファは便利なショートカット構文を提供しています。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#000>map</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>key_type</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>value_type</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000>map_field</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>N</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>&mldr;ここで、<code>key_type</code> は任意の整数型または文字列型（つまり、浮動小数点型や<code>bytes</code>を除く<a href=#scalar>スカラー</a>型）であることに注意してください。列挙型は有効な<code>key_type</code>ではありません。<code>value_type</code> は別のマップ以外の任意の型であることができます。</p><p>たとえば、各 <code>Project</code> メッセージが文字列キーに関連付けられたプロジェクトのマップを作成したい場合、次のように定義できます：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#000>map</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Project</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000>projects</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div><h3 id=maps-features>マップの機能</h3><ul><li>拡張機能はマップに対してサポートされていません。</li><li>マップは <code>repeated</code>、<code>optional</code>、または <code>required</code> にすることはできません。</li><li>マップ値のワイヤーフォーマットの順序付けとマップの反復順序は未定義であり、特定の順序でマップアイテムがあることを信頼することはできません。</li><li><code>.proto</code> のテキスト形式を生成する際、マップはキーでソートされます。数値キーは数値順にソートされます。</li><li>ワイヤーからのパースやマージ時に、重複するマップキーがある場合、最後に見たキーが使用されます。テキスト形式からマップをパースする際、重複するキーがあるとパースに失敗する可能性があります。</li></ul><p>生成されたマップAPIは現在、すべてのサポートされている言語で利用可能です。選択した言語に関するマップAPIの詳細については、関連する<a href=/reference/>APIリファレンス</a>で確認できます。</p><h3 id=backwards>逆互換性</h3><p>マップ構文は、ワイヤー上で次のように等価です。したがって、マップをサポートしていないプロトコルバッファの実装でもデータを処理できます：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>MapFieldEntry</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>key_type</span> <span style=color:#000>key</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>value_type</span> <span style=color:#000>value</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>MapFieldEntry</span> <span style=color:#000>map_field</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>N</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>マップをサポートするプロトコルバッファの実装は、以前の定義で受け入れられるデータを生成および受け入れる必要があります。</p><h2 id=packages>パッケージ</h2><p>プロトコルメッセージタイプ間の名前の衝突を防ぐために、<code>.proto</code> ファイルにオプションの <code>package</code> 指定子を追加できます。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bar</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Open</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#ce5c00;font-weight:700>...</span> <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>その後、メッセージタイプのフィールドを定義する際にパッケージ指定子を使用できます：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#ce5c00;font-weight:700>...</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>foo.bar.Open</span> <span style=color:#000>open</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#ce5c00;font-weight:700>...</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>パッケージ指定子が生成されたコードに与える影響は、選択した言語によって異なります：</p><ul><li><strong>C++</strong> では、生成されたクラスはC++の名前空間内にラップされます。たとえば、<code>Open</code> は <code>foo::bar</code> の名前空間にあります。</li><li><strong>Java</strong> および <strong>Kotlin</strong> では、パッケージはJavaパッケージとして使用されます。ただし、<code>.proto</code> ファイルで明示的に <code>option java_package</code> を指定しない限りです。</li><li><strong>Python</strong> では、<code>package</code> ディレクティブは無視されます。Pythonモジュールはファイルシステム内の場所に従って構成されます。</li><li><strong>Go</strong> では、<code>package</code> ディレクティブは無視され、生成された <code>.pb.go</code> ファイルは、対応する <code>go_proto_library</code> Bazelルールの名前で指定されたパッケージになります。オープンソースプロジェクトでは、<code>go_package</code> オプションを提供するか、Bazelの <code>-M</code> フラグを設定する必要があります。</li><li><strong>Ruby</strong> では、生成されたクラスはネストされたRuby名前空間内にラップされ、必要なRubyの大文字化スタイルに変換されます（最初の文字が大文字になります。最初の文字が文字でない場合は、<code>PB_</code> が先頭に追加されます）。たとえば、<code>Open</code> は <code>Foo::Bar</code> の名前空間にあります。</li><li><strong>C#</strong> では、パッケージは、PascalCaseに変換した後の名前空間として使用されます。ただし、<code>.proto</code> ファイルで明示的に <code>option csharp_namespace</code> を指定しない限りです。たとえば、<code>Open</code> は <code>Foo.Bar</code> の名前空間にあります。</li></ul><p>注意してください。<code>package</code> ディレクティブが生成されたコードに直接影響を与えない場合でも、たとえば Python では、<code>.proto</code> ファイルのパッケージを指定することを強くお勧めします。そうしないと、記述子での名前の競合が発生し、他の言語に移植できなくなる可能性があります。</p><h3 id=name-resolution>パッケージと名前解決</h3><p>プロトコルバッファ言語における型名の解決は C++ のように動作します。最初に最も内側のスコープが検索され、次にその内側のスコープが検索され、以降、各パッケージがその親パッケージに対して「内側」であると見なされます。先頭に &lsquo;.&rsquo;（たとえば、<code>.foo.bar.Baz</code>）を付けると、最も外側のスコープから開始することを意味します。</p><p>プロトコルバッファコンパイラは、インポートされた <code>.proto</code> ファイルを解析してすべての型名を解決します。各言語のコード生成ツールは、異なるスコープルールを持っていても、その言語で各型を参照する方法を知っています。</p><h2 id=services>サービスの定義</h2><p>メッセージ型を RPC（Remote Procedure Call）システムで使用したい場合、<code>.proto</code> ファイルに RPC サービスインターフェースを定義し、プロトコルバッファコンパイラは選択した言語でサービスインターフェースコードとスタブを生成します。たとえば、<code>SearchRequest</code> を取り、<code>SearchResponse</code> を返すメソッドを持つ RPC サービスを定義したい場合、<code>.proto</code> ファイルに次のように定義できます。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>service</span> <span style=color:#000>SearchService</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>rpc</span> <span style=color:#000>Search</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>SearchRequest</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>returns</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>SearchResponse</span><span style=color:#000;font-weight:700>);</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>デフォルトでは、プロトコルコンパイラは <code>SearchService</code> という抽象インターフェースと対応する &ldquo;スタブ&rdquo; 実装を生成します。スタブはすべての呼び出しを <code>RpcChannel</code> に転送します。<code>RpcChannel</code> は、自分自身の RPC システムに関して自分で定義する必要がある抽象インターフェースです。たとえば、メッセージをシリアライズして HTTP 経由でサーバーに送信する <code>RpcChannel</code> を実装することができます。言い換えると、生成されたスタブは、特定の RPC 実装に固定されることなく、プロトコルバッファベースの RPC 呼び出しを行うための型安全なインターフェースを提供します。そのため、C++ では、次のようなコードが生成されるかもしれません。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>protobuf</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>RpcChannel</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>channel</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>RpcController</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>controller</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>SearchService</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>service</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>SearchRequest</span> <span style=color:#000>request</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>SearchResponse</span> <span style=color:#000>response</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>DoSearch</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// You provide classes MyRpcChannel and MyRpcController, which implement
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// the abstract interfaces protobuf::RpcChannel and protobuf::RpcController.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>channel</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>MyRpcChannel</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;somehost.example.com:1234&#34;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#000>controller</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>MyRpcController</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// The protocol compiler generates the SearchService class based on the
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// definition given earlier.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>service</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>SearchService</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Stub</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>channel</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Set up the request.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>request</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>set_query</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;protocol buffers&#34;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Execute the RPC.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>service</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>Search</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>controller</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>request</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>response</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>                  <span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>NewCallback</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>Done</span><span style=color:#000;font-weight:700>));</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>Done</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>delete</span> <span style=color:#000>service</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>delete</span> <span style=color:#000>channel</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>delete</span> <span style=color:#000>controller</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>すべてのサービスクラスは、特定のメソッド名やその入出力タイプをコンパイル時に知ることなく、特定のメソッドを呼び出す方法を提供する <code>Service</code> インターフェースを実装しています。サーバーサイドでは、これを使用して、サービスを登録できる RPC サーバーを実装することができます。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>protobuf</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>ExampleSearchService</span> <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>SearchService</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span> <span style=color:#204a87;font-weight:700>public</span><span style=color:#ce5c00;font-weight:700>:</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>Search</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>RpcController</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>controller</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>SearchRequest</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>request</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#000>SearchResponse</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>response</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Closure</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>done</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>request</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>query</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;google&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>response</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>add_result</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>set_url</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;http://www.google.com&#34;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>request</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>query</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;protocol buffers&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>response</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>add_result</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>set_url</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;http://protobuf.googlecode.com&#34;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000>done</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>Run</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>};</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// You provide class MyRpcServer.  It does not have to implement any
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// particular interface; this is just an example.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>MyRpcServer</span> <span style=color:#000>server</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Service</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>service</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ExampleSearchService</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ExportOnPort</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1234</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>service</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Run</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>delete</span> <span style=color:#000>service</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>独自の既存の RPC システムを接続したくない場合は、Google で開発された言語やプラットフォームに依存しないオープンソースの RPC システムである <a href=https://github.com/grpc/grpc-common>gRPC</a> を使用できます。gRPC は、特にプロトコルバッファと非常にうまく機能し、<code>.proto</code> ファイルから関連する RPC コードを直接生成することができます。ただし、proto2 と proto3 で生成されたクライアントとサーバーの間に互換性の問題があるため、gRPC を定義するために proto3 を使用することをお勧めします。proto3 構文について詳しくは、<a href=/programming-guides/proto3>Proto3 Language Guide</a> を参照してください。gRPC で proto2 を使用したい場合は、プロトコルバッファコンパイラとライブラリのバージョン 3.0.0 以上を使用する必要があります。</p><p>gRPC に加えて、Protocol Buffers のための RPC 実装を開発するためのいくつかの第三者プロジェクトも進行中です。知っているプロジェクトへのリンクのリストについては、<a href=https://github.com/protocolbuffers/protobuf/blob/master/docs/third_party.md>third-party add-ons wiki page</a> を参照してください。</p><h2 id=json>JSON マッピング</h2><p>Proto2 は、JSON での正規エンコーディングをサポートしており、システム間でデータを共有しやすくしています。エンコーディングは以下の表に示されているタイプごとに記述されています。</p><p>JSON エンコードされたデータをプロトコルバッファにパースする際、値が欠落しているか、その値が <code>null</code> の場合、それは対応する<a href=#optional>デフォルト値</a>として解釈されます。</p><p><code>optional</code> キーワードで定義された proto2 フィールドは、フィールドの存在をサポートします。値が設定されていてフィールドの存在をサポートするフィールドは、常に JSON エンコードされた出力にフィールド値を含めます。たとえそれがデフォルト値であってもです。</p><table><tbody><tr><th>proto2</th><th>JSON</th><th>JSON の例</th><th>ノート</th></tr><tr><td>message</td><td>object</td><td><code>{"fooBar": v, "g": null, ...}</code></td><td>JSON オブジェクトを生成します。メッセージフィールド名は lowerCamelCase にマップされ、JSON オブジェクトのキーになります。`json_name` フィールドオプションが指定されている場合、指定された値がキーとして使用されます。パーサーは、lowerCamelCase 名（または `json_name` オプションで指定された名前）と元の proto フィールド名の両方を受け入れます。`null` はすべてのフィールドタイプの受け入れられる値であり、対応するフィールドタイプのデフォルト値として扱われます。ただし、`json_name` の値には `null` を使用できません。詳細については、[Stricter validation for json_name](/news/2023-04-28#json-name) を参照してください。</td></tr><tr><td>enum</td><td>string</td><td><code>"FOO_BAR"</code></td><td>proto で指定された enum 値の名前が使用されます。パーサーは、enum 名と整数値の両方を受け入れます。</td></tr><tr><td>map&lt;K,V></td><td>object</td><td><code>{"k": v, ...}</code></td><td>すべてのキーは文字列に変換されます。</td></tr><tr><td>repeated V</td><td>array</td><td><code>[v, ...]</code></td><td><code>null</code> は空のリスト <code>[]</code> として受け入れられます。</td></tr><tr><td>bool</td><td>true, false</td><td><code>true, false</code></td><td></td></tr><tr><td>string</td><td>string</td><td><code>"Hello World!"</code></td><td></td></tr><tr><td>bytes</td><td>base64 string</td><td><code>"YWJjMTIzIT8kKiYoKSctPUB+"</code></td><td>JSON 値は、標準の base64 エンコーディングを使用して文字列としてエンコードされます。標準または URL セーフな base64 エンコーディング（パディングあり/なし）のいずれも受け入れられます。</td></tr><tr><td>int32, fixed32, uint32</td><td>number</td><td><code>1, -10, 0</code></td><td>JSON 値は 10 進数です。数値または文字列のいずれも受け入れられます。</td></tr><tr><td>int64, fixed64, uint64</td><td>string</td><td><code>"1", "-10"</code></td><td>JSON 値は 10 進数の文字列です。数値または文字列のいずれも受け入れられます。</td></tr><tr><td>float, double</td><td>number</td><td><code>1.1, -10.0, 0, "NaN", "Infinity"</code></td><td>JSON 値は数値または特別な文字列値 "NaN"、"Infinity"、"-Infinity" のいずれかです。数値または文字列のいずれも受け入れられます。指数表記も受け入れられます。-0 は 0 と同等と見なされます。</td></tr><tr><td>Any</td><td><code>object</code></td><td><code>{"@type": "url", "f": v, ... }</code></td><td><code>Any</code> に特別な JSON マッピングを持つ値が含まれている場合、次のように変換されます: <code>{"@type": xxx, "value": yyy}</code>。それ以外の場合、値は JSON オブジェクトに変換され、実際のデータ型を示すために <code>"@type"</code> フィールドが挿入されます。</td></tr><tr><td>Timestamp</td><td>string</td><td><code>"1972-01-01T10:00:20.021Z"</code></td><td>生成された出力は常に Z に正規化され、0、3、6、または 9 桁の小数部を使用します。"Z" 以外のオフセットも受け入れられます。</td></tr><tr><td>Duration</td><td>string</td><td><code>"1.000340012s", "1s"</code></td><td>生成された出力には常に 0、3、6、または 9 桁の小数部が含まれ、必要な精度に応じて "s" 接尾辞が続きます。フィットする限り、任意の小数部（なしも含む）が受け入れられ、接尾辞 "s" が必要です。</td></tr><tr><td>Struct</td><td><code>object</code></td><td><code>{ ... }</code></td><td>任意の JSON オブジェクト。詳細は <code>struct.proto</code> を参照してください。</td></tr><tr><td>Wrapper types</td><td>various types</td><td><code>2, "2", "foo", true, "true", null, 0, ...</code></td><td>ラッパーは、ラップされたスカラータイプと同じ表現を JSON で使用しますが、`null` が許可され、データの変換と転送中に保持されます。</td></tr><tr><td>FieldMask</td><td>string</td><td><code>"f.fooBar,h"</code></td><td><code>field_mask.proto</code> を参照してください。</td></tr><tr><td>ListValue</td><td>array</td><td><code>[foo, bar, ...]</code></td><td></td></tr><tr><td>Value</td><td>value</td><td></td><td>任意の JSON 値。詳細については、<code><a href=/reference/protobuf/google.protobuf#value>google.protobuf.Value</a></code> を確認してください。</td></tr><tr><td>NullValue</td><td>null</td><td></td><td>JSON の null</td></tr><tr><td>Empty</td><td>object</td><td><code>{}</code></td><td>空の JSON オブジェクト</td></tr></tbody></table><h3 id=json-options>JSON オプション</h3><p>proto2 JSON の実装では、以下のオプションが提供される場合があります:</p><ul><li><p><strong>常に存在しないフィールドを出力する</strong>: 存在しないフィールドで、デフォルト値を持つフィールドは、JSON 出力ではデフォルトでは省略されます（たとえば、0 の値を持つ暗黙の存在整数、空の文字列である暗黙の存在文字列フィールド、空の繰り返しフィールドおよびマップフィールド）。実装によっては、この動作をオーバーライドしてデフォルト値を持つフィールドを出力するオプションを提供する場合があります。</p><p>v25.x では、C++、Java、および Python の実装は、このフラグが proto2 <code>optional</code> フィールドに影響を与えるが、proto3 <code>optional</code> フィールドには影響を与えないため、準拠していません。将来のリリースで修正が予定されています。</p></li><li><p><strong>未知のフィールドを無視する</strong>: Proto2 JSON パーサーは、デフォルトでは未知のフィールドを拒否するべきですが、パーシング時に未知のフィールドを無視するオプションを提供する場合があります。</p></li><li><p><strong>lowerCamelCase 名の代わりに proto フィールド名を使用する</strong>: デフォルトでは、proto2 JSON プリンターはフィールド名を lowerCamelCase に変換し、それを JSON 名として使用するべきです。実装によっては、代わりに proto フィールド名を JSON 名として使用するオプションを提供する場合があります。Proto2 JSON パーサーは、変換された lowerCamelCase 名と proto フィールド名の両方を受け入れる必要があります。</p></li><li><p><strong>列挙値を文字列ではなく整数として出力する</strong>: 列挙値の名前がデフォルトで JSON 出力に使用されます。代わりに列挙値の数値を使用するオプションが提供される場合があります。</p></li></ul><h2 id=options>オプション</h2><p><code>.proto</code> ファイル内の個々の宣言には、複数の <em>オプション</em> を付与することができます。オプションは宣言の全体的な意味を変更しませんが、特定のコンテキストでの処理方法に影響を与える場合があります。利用可能なオプションの完全なリストは、<a href=https://github.com/protocolbuffers/protobuf/blob/main/src/google/protobuf/descriptor.proto><code>/google/protobuf/descriptor.proto</code></a> で定義されています。</p><p>一部のオプションはファイルレベルのオプションであり、メッセージ、列挙型、またはサービス定義の内部ではなく、トップレベルスコープに記述する必要があります。一部のオプションはメッセージレベルのオプションであり、メッセージ定義の内部に記述する必要があります。一部のオプションはフィールドレベルのオプションであり、フィールド定義の内部に記述する必要があります。オプションは列挙型、列挙値、oneof フィールド、サービス型、およびサービスメソッドにも記述できますが、これらのいずれに対しても有用なオプションは現在存在しません。</p><p>ここには、最も一般的に使用されるいくつかのオプションがあります：</p><ul><li><p><code>java_package</code>（ファイルオプション）：生成されたJava/Kotlinクラスで使用するパッケージ。<code>.proto</code>ファイルで明示的な<code>java_package</code>オプションが指定されていない場合、デフォルトでprotoパッケージ（<code>.proto</code>ファイルで「package」キーワードを使用して指定されたもの）が使用されます。ただし、protoパッケージは一般的に逆ドメイン名で始まることが期待されていないため、protoパッケージは良いJavaパッケージとは言えません。JavaまたはKotlinコードを生成しない場合、このオプションは効果がありません。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>java_package</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;com.example.foo&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div></li><li><p><code>java_outer_classname</code>（ファイルオプション）：生成するラッパーJavaクラスのクラス名（およびファイル名）。<code>.proto</code>ファイルで明示的な<code>java_outer_classname</code>が指定されていない場合、クラス名は<code>.proto</code>ファイル名をキャメルケースに変換して構築されます（つまり、<code>foo_bar.proto</code>は<code>FooBar.java</code>になります）。<code>java_multiple_files</code>オプションが無効になっている場合、<code>.proto</code>ファイルに生成される他のすべてのクラス/列挙型などは、この外部のラッパーJavaクラス内にネストされたクラス/列挙型などとして生成されます。Javaコードを生成しない場合、このオプションは効果がありません。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>java_outer_classname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Ponycopter&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div></li><li><p><code>java_multiple_files</code>（ファイルオプション）：falseの場合、この<code>.proto</code>ファイルに対して単一の<code>.java</code>ファイルが生成され、トップレベルのメッセージ、サービス、列挙型に生成されたすべてのJavaクラス/列挙型などが外部クラス（<code>java_outer_classname</code>を参照）内にネストされます。trueの場合、トップレベルのメッセージ、サービス、列挙型に生成された各Javaクラス/列挙型などに対して個別の<code>.java</code>ファイルが生成され、この<code>.proto</code>ファイルに対して生成されるラッパーJavaクラスにはネストされたクラス/列挙型などが含まれません。これはデフォルトで<code>false</code>に設定されるブールオプションです。Javaコードを生成しない場合、このオプションは効果がありません。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>java_multiple_files</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div></li></ul><p>{/<em>examples</em>/}</p><ul><li><p><code>optimize_for</code>（ファイルオプション）：<code>SPEED</code>、<code>CODE_SIZE</code>、または<code>LITE_RUNTIME</code>に設定できます。これはC++およびJavaのコードジェネレータ（およびサードパーティのジェネレータ）に以下のように影響します：</p><ul><li><code>SPEED</code>（デフォルト）：プロトコルバッファコンパイラは、メッセージタイプのシリアル化、パース、およびその他の一般的な操作のためのコードを生成します。このコードは高度に最適化されています。</li><li><code>CODE_SIZE</code>：プロトコルバッファコンパイラは最小限のクラスを生成し、共有されたリフレクションベースのコードに依存してシリアル化、パース、およびさまざまな他の操作を実装します。生成されるコードは<code>SPEED</code>よりもはるかに小さくなりますが、操作は遅くなります。クラスは引き続き<code>SPEED</code>モードとまったく同じパブリックAPIを実装します。このモードは、非常に多くの<code>.proto</code>ファイルを含むアプリで、すべてを極めて高速にする必要がない場合に最も有用です。</li><li><code>LITE_RUNTIME</code>：プロトコルバッファコンパイラは、「lite」ランタイムライブラリ（<code>libprotobuf-lite</code>ではなく<code>libprotobuf</code>）にのみ依存するクラスを生成します。ライトランタイムはフルライブラリよりもはるかに小さく（約1桁小さい）、記述子やリフレクションなどの特定の機能を省略します。これは、モバイル電話などの制約のあるプラットフォームで実行されるアプリに特に有用です。コンパイラは引き続き、<code>SPEED</code>モードと同様にすべてのメソッドの高速な実装を生成します。生成されたクラスは、各言語で<code>MessageLite</code>インターフェースのみを実装し、完全な<code>Message</code>インターフェースの一部のメソッドのみを提供します。</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>optimize_for</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>CODE_SIZE</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div></li><li><p><code>cc_generic_services</code>、<code>java_generic_services</code>、<code>py_generic_services</code>（ファイルオプション）：**ジェネリックサービスは非推奨です。**プロトコルバッファコンパイラが、C++、Java、およびPythonの<a href=#services>サービス定義</a>に基づいて抽象サービスコードを生成するかどうか。遺産上、これらはデフォルトで<code>true</code>になっています。ただし、2010年1月のバージョン2.3.0以降では、RPC実装が各システムに特化したコードを生成するために、&ldquo;抽象"サービスに依存するのではなく、
<a href=/reference/cpp/api-docs/google.protobuf.compiler.plugin.pb>コードジェネレータプラグイン</a>
を提供することが好ましいと考えられています。</p></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#000;font-weight:700>(</span><span style=color:#8f5902;font-style:italic>// This file relies on plugins to generate service code.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>cc_generic_services</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>java_generic_services</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>py_generic_services</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div><ul><li><p><code>cc_enable_arenas</code>（ファイルオプション）：C++生成コードのために<a href=/reference/cpp/arenas>アリーナ割り当て</a>を有効にします。</p></li><li><p><code>objc_class_prefix</code>（ファイルオプション）：この.protoから生成されたすべてのObjective-Cクラスおよび列挙型の前に付加されるObjective-Cクラスプレフィックスを設定します。デフォルトはありません。<a href=https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/Conventions/Conventions.html#//apple_ref/doc/uid/TP40011210-CH10-SW4>Appleの推奨</a>に従って、3〜5文字の大文字のプレフィックスを使用する必要があります。2文字のプレフィックスはすべてAppleによって予約されていることに注意してください。</p></li><li><p><code>message_set_wire_format</code>（メッセージオプション）：<code>true</code>に設定されている場合、メッセージはGoogle内で使用されていた古いフォーマットである<code>MessageSet</code>と互換性のある異なるバイナリ形式を使用します。Google外のユーザーはおそらくこのオプションを使用する必要はありません。メッセージは次のように厳密に宣言されている必要があります：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>message_set_wire_format</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>extensions</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#204a87;font-weight:700>max</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div></li><li><p><code>packed</code>（フィールドオプション）：基本的な数値型の繰り返しフィールドに<code>true</code>が設定されている場合、よりコンパクトな<a href=/programming-guides/encoding#packed>エンコーディング</a>が使用されます。このオプションを使用する際のデメリットはありません。ただし、バージョン2.3.0以前では、予期しない状況でパックされたデータを受信したパーサーは無視していました。したがって、既存のフィールドをパック形式に変更することは、ワイヤー互換性を壊さないようにすることができませんでした。2.3.0以降では、パック可能なフィールドのパーサーは常に両方の形式を受け入れるため、この変更は安全ですが、古いプロトコルバッファのバージョンを使用している古いプログラムを扱う場合は注意が必要です。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>samples</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>packed</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span></code></pre></div></li><li><p><code>deprecated</code>（フィールドオプション）：<code>true</code>に設定されている場合、フィールドが非推奨であり、新しいコードで使用すべきではないことを示します。ほとんどの言語では、これに実際の効果はありません。Javaでは、これは<code>@Deprecated</code>注釈になります。C++では、clang-tidyは非推奨のフィールドが使用されるたびに警告を生成します。将来、他の言語固有のコードジェネレーターは、フィールドのアクセサーに非推奨の注釈を生成し、その結果、フィールドを使用しようとするコードをコンパイルする際に警告が発生します。誰も使用していないフィールドであり、新しいユーザーが使用するのを防ぎたい場合は、フィールド宣言を<a href=#fieldreserved>予約</a>ステートメントで置き換えることを検討してください。</p></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>old_field</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>6</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>deprecated</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span></code></pre></div><h3 id=enum-value-options>Enum Value Options</h3><p>列挙値オプションはサポートされています。<code>deprecated</code> オプションを使用して、もはや使用されない値を示すことができます。また、拡張機能を使用してカスタムオプションを作成することもできます。</p><p>次の例は、これらのオプションを追加する構文を示しています：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;google/protobuf/descriptor.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.EnumValueOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>string_name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>123456789</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>Data</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>DATA_UNSPECIFIED</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>DATA_SEARCH</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>deprecated</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>DATA_DISPLAY</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>[</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000;font-weight:700>(</span><span style=color:#000>string_name</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;display_value&#34;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p><code>string_name</code> オプションを読み取るための C++ コードは次のようになるかもしれません：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>absl</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>string_view</span> <span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>proto2</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>GetEnumDescriptor</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Data</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>FindValueByName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;DATA_DISPLAY&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>options</span><span style=color:#000;font-weight:700>().</span><span style=color:#000>GetExtension</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>string_name</span><span style=color:#000;font-weight:700>);</span>
</span></span></code></pre></div><p>カスタムオプションを列挙値やフィールドに適用する方法については、<a href=#customoptions>カスタムオプション</a> を参照してください。</p><h3 id=customoptions>Custom Options</h3><p>Protocol Buffers では、独自のオプションを定義して使用することもできます。これはほとんどの人が必要としない <strong>高度な機能</strong> であることに注意してください。オプションは <code>google/protobuf/descriptor.proto</code> で定義されたメッセージによって定義されているため（<code>FileOptions</code> や <code>FieldOptions</code> のように）、独自のオプションを定義することは単にこれらのメッセージを<a href=#extensions>拡張</a>することです。たとえば：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;google/protobuf/descriptor.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.MessageOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>my_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>51234</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>MyMessage</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>my_option</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Hello world!&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>ここでは、<code>MessageOptions</code> を拡張して新しいメッセージレベルのオプションを定義しています。その後、オプションを使用するときは、オプション名を括弧で囲んで拡張であることを示す必要があります。C++ で <code>my_option</code> の値を読み取ることができます：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>value</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>MyMessage</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>descriptor</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000;font-weight:700>&gt;</span><span style=color:#000>options</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>GetExtension</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>my_option</span><span style=color:#000;font-weight:700>);</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>ここで、<code>MyMessage::descriptor()->options()</code> は <code>MyMessage</code> のための <code>MessageOptions</code> プロトコルメッセージを返します。それからそれからカスタムオプションを読み取ることは、他の<a href=#extensions>拡張</a>を読み取るのと同じです。</p><p>同様に、Javaでは次のように書きます：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>value</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>MyProtoFile</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>MyMessage</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getDescriptor</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getOptions</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getExtension</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>MyProtoFile</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>myOption</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Pythonでは次のようになります：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>value</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>my_proto_file_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>MyMessage</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>DESCRIPTOR</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>GetOptions</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Extensions</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>my_proto_file_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>my_option</span><span style=color:#000;font-weight:700>]</span>
</span></span></code></pre></div><p>カスタムオプションは、Protocol Buffers 言語のあらゆる構造に対して定義することができます。以下は、すべての種類のオプションを使用する例です：```</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;google/protobuf/descriptor.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.FileOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>my_file_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>50000</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.MessageOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>my_message_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>50001</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.FieldOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>float</span> <span style=color:#000>my_field_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>50002</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.OneofOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int64</span> <span style=color:#000>my_oneof_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>50003</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.EnumOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>bool</span> <span style=color:#000>my_enum_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>50004</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.EnumValueOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>uint32</span> <span style=color:#000>my_enum_value_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>50005</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.ServiceOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>MyEnum</span> <span style=color:#000>my_service_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>50006</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.MethodOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>MyMessage</span> <span style=color:#000>my_method_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>50007</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>my_file_option</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Hello world!&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>MyMessage</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>my_message_option</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1234</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>[(</span><span style=color:#000>my_field_option</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4.5</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>bar</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>oneof</span> <span style=color:#000>qux</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>my_oneof_option</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>quux</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>MyEnum</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>my_enum_option</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>FOO</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>[(</span><span style=color:#000>my_enum_value_option</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>321</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>BAR</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>RequestType</span> <span style=color:#000;font-weight:700>{}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>ResponseType</span> <span style=color:#000;font-weight:700>{}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>service</span> <span style=color:#000>MyService</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>my_service_option</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>FOO</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>rpc</span> <span style=color:#000>MyMethod</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>RequestType</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>returns</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ResponseType</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#8f5902;font-style:italic>// Note:  my_method_option has type MyMessage.  We can set each field
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#8f5902;font-style:italic>//   within it using a separate &#34;option&#34; line.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>my_method_option</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>567</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>my_method_option</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bar</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Some string&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>カスタムオプションを使用する場合、それが定義されたパッケージ以外のパッケージでカスタムオプションを使用する場合は、オプション名を型名と同様にパッケージ名で接頭辞付きで指定する必要があります。例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// foo.proto
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;google/protobuf/descriptor.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>foo</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.MessageOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>my_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>51234</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// bar.proto
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;foo.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>bar</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>MyMessage</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>foo.my_option</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Hello world!&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>最後に：カスタムオプションは拡張機能であるため、他のフィールドや拡張機能と同様にフィールド番号を割り当てる必要があります。前述の例では、50000〜99999の範囲のフィールド番号を使用しています。この範囲は個々の組織内での内部利用のために予約されているため、社内アプリケーションでこの範囲の番号を自由に使用できます。ただし、公開アプリケーションでカスタムオプションを使用する場合は、フィールド番号がグローバルに一意であることを確認することが重要です。グローバルに一意なフィールド番号を取得するには、<a href=https://github.com/protocolbuffers/protobuf/blob/master/docs/options.md>protobuf global extension registry</a> にエントリを追加するためのリクエストを送信してください。通常、1つの拡張番号だけが必要です。複数のオプションを1つの拡張番号で宣言するには、それらをサブメッセージに入れることができます：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>FooOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>opt1</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>opt2</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.FieldOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>FooOptions</span> <span style=color:#000>foo_options</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1234</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// usage:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Bar</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>a</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>[(</span><span style=color:#000>foo_options</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>opt1</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>123</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>foo_options</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>opt2</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;baz&#34;</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// alternative aggregate syntax (uses TextFormat):
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>b</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>[(</span><span style=color:#000>foo_options</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>opt1</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>123</span> <span style=color:#000>opt2</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;baz&#34;</span> <span style=color:#000;font-weight:700>}];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>また、各オプションタイプ（ファイルレベル、メッセージレベル、フィールドレベルなど）には独自の番号空間がありますので、例えば、FieldOptions と MessageOptions の拡張を同じ番号で宣言することができます。</p><h3 id=option-retention>オプションの保持</h3><p>オプションには、生成されたコードでオプションが保持されるかどうかを制御する <em>保持</em> の概念があります。オプションはデフォルトで <em>ランタイム保持</em> を持ち、つまり生成されたコードで保持され、生成された記述子プールでランタイムで見えるようになります。ただし、<code>retention = RETENTION_SOURCE</code> を設定してオプション（またはオプション内のフィールド）がランタイムで保持されないようにすることができます。これを <em>ソース保持</em> と呼びます。</p><p>オプションの保持は、ほとんどのユーザーが気にする必要がない高度な機能ですが、バイナリに保持するコードサイズのコストを支払わずに特定のオプションを使用したい場合に役立ちます。ソース保持のオプションは引き続き <code>protoc</code> および <code>protoc</code> プラグインに見えるため、コード生成ツールは動作をカスタマイズするためにそれらを使用できます。</p><p>保持は、次のようにオプションに直接設定できます：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.FileOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>source_retention_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1234</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>      <span style=color:#000;font-weight:700>[</span><span style=color:#000>retention</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>RETENTION_SOURCE</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>また、プレーンなフィールドにも設定できます。その場合、そのフィールドがオプション内に現れるときのみ効果があります：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>OptionsMessage</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>source_retention_field</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>retention</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>RETENTION_SOURCE</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p><code>retention = RETENTION_RUNTIME</code> を設定することもできますが、これはデフォルトの動作なので効果はありません。メッセージフィールドが <code>RETENTION_SOURCE</code> とマークされている場合、その内容全体が削除されます。その内部のフィールドは、<code>RETENTION_RUNTIME</code> を設定しようとしてもそれを上書きすることはできません。</p><div class="alert alert-note" role=alert><h4 class=alert-heading>Note</h4>Protocol Buffers 22.0 では、オプションの保持に関するサポートはまだ進行中であり、C++ と Java のみがサポートされています。Go は 1.29.0 からサポートされています。Python のサポートは完了していますが、リリースにはまだ含まれていません。</div><h3 id=option-targets>オプションのターゲット</h3><p>フィールドには <code>targets</code> オプションがあり、そのフィールドがオプションとして使用されるときに適用できるエンティティの種類を制御します。たとえば、フィールドに <code>targets = TARGET_TYPE_MESSAGE</code> がある場合、そのフィールドは enum（または他の非メッセージエンティティ）のカスタムオプションで設定できません。Protoc はこれを強制し、ターゲット制約が違反された場合にエラーを発生させます。</p><p>一見すると、この機能は不要に見えるかもしれません。なぜなら、すべてのカスタムオプションは特定のエンティティのオプションメッセージの拡張であり、すでにその1つのエンティティにオプションを制限しているからです。ただし、オプションのターゲットは、複数のエンティティタイプに適用される共有オプションメッセージがある場合や、そのメッセージ内の個々のフィールドの使用を制御したい場合に便利です。たとえば：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>MyOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>file_only_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>targets</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>TARGET_TYPE_FILE</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>message_and_enum_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>targets</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>TARGET_TYPE_MESSAGE</span><span style=color:#000;font-weight:700>,</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>                                              <span style=color:#000>targets</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>TARGET_TYPE_ENUM</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.FileOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>MyOptions</span> <span style=color:#000>file_options</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>50000</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.MessageOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>MyOptions</span> <span style=color:#000>message_options</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>50000</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>protobuf.EnumOptions</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>MyOptions</span> <span style=color:#000>enum_options</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>50000</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// OK: this field is allowed on file options
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>file_options</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>file_only_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;abc&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>MyMessage</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// OK: this field is allowed on both message and enum options
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>message_options</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>message_and_enum_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>MyEnum</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>MY_ENUM_UNSPECIFIED</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#8f5902;font-style:italic>// Error: file_only_option cannot be set on an enum.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>enum_options</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>file_only_option</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;xyz&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><h2 id=generating>クラスの生成</h2><p><code>.proto</code> ファイルで定義されたメッセージタイプで作業するために必要な Java、Kotlin、Python、C++、Go、Ruby、Objective-C、または C# コードを生成するには、<code>.proto</code> ファイルに対してプロトコルバッファコンパイラ <code>protoc</code> を実行する必要があります。コンパイラをインストールしていない場合は、<a href=/downloads>パッケージをダウンロード</a> して README の手順に従ってください。Go の場合、コンパイラ用の特別なコードジェネレータプラグインもインストールする必要があります。これについては、GitHub の <a href=https://github.com/golang/protobuf/>golang/protobuf</a> リポジトリで見つけることができ、インストール手順もそこに記載されています。</p><p>プロトコルコンパイラは次のように呼び出されます：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>protoc --proto_path<span style=color:#ce5c00;font-weight:700>=</span>IMPORT_PATH --cpp_out<span style=color:#ce5c00;font-weight:700>=</span>DST_DIR --java_out<span style=color:#ce5c00;font-weight:700>=</span>DST_DIR --python_out<span style=color:#ce5c00;font-weight:700>=</span>DST_DIR --go_out<span style=color:#ce5c00;font-weight:700>=</span>DST_DIR --ruby_out<span style=color:#ce5c00;font-weight:700>=</span>DST_DIR --objc_out<span style=color:#ce5c00;font-weight:700>=</span>DST_DIR --csharp_out<span style=color:#ce5c00;font-weight:700>=</span>DST_DIR path/to/file.proto
</span></span></code></pre></div><ul><li><p><code>IMPORT_PATH</code> は、<code>import</code> ディレクティブを解決する際に <code>.proto</code> ファイルを探すディレクトリを指定します。省略した場合、現在のディレクトリが使用されます。複数のインポートディレクトリを指定するには、<code>--proto_path</code> オプションを複数回渡すことができます。それらは順番に検索されます。<code>-I=_IMPORT_PATH_</code> は <code>--proto_path</code> の短縮形として使用できます。</p></li><li><p>1つ以上の <em>出力ディレクティブ</em> を指定できます：</p><ul><li><code>--cpp_out</code> は <code>DST_DIR</code> に C++ コードを生成します。詳細については、<a href=/reference/cpp/cpp-generated>C++ 生成コードリファレンス</a> を参照してください。</li><li><code>--java_out</code> は <code>DST_DIR</code> に Java コードを生成します。詳細については、<a href=/reference/java/java-generated>Java 生成コードリファレンス</a> を参照してください。</li><li><code>--kotlin_out</code> は <code>DST_DIR</code> に追加の Kotlin コードを生成します。詳細については、<a href=/reference/kotlin/kotlin-generated>Kotlin 生成コードリファレンス</a> を参照してください。</li><li><code>--python_out</code> は <code>DST_DIR</code> に Python コードを生成します。詳細については、<a href=/reference/python/python-generated>Python 生成コードリファレンス</a> を参照してください。</li><li><code>--go_out</code> は <code>DST_DIR</code> に Go コードを生成します。詳細については、<a href=/reference/go/go-generated>Go 生成コードリファレンス</a> を参照してください。</li><li><code>--ruby_out</code> は <code>DST_DIR</code> に Ruby コードを生成します。詳細については、<a href=/reference/ruby/ruby-generated>Ruby 生成コードリファレンス</a> を参照してください。</li><li><code>--objc_out</code> は <code>DST_DIR</code> に Objective-C コードを生成します。詳細については、<a href=/reference/objective-c/objective-c-generated>Objective-C 生成コードリファレンス</a> を参照してください。</li><li><code>--csharp_out</code> は <code>DST_DIR</code> に C# コードを生成します。詳細については、<a href=/reference/csharp/csharp-generated>C# 生成コードリファレンス</a> を参照してください。</li></ul><p>さらなる便宜のために、<code>DST_DIR</code> が <code>.zip</code> または <code>.jar</code> で終わる場合、コンパイラは指定された名前の単一の ZIP 形式アーカイブファイルに出力を書き込みます。<code>.jar</code> 出力には、Java JAR 仕様で必要とされるマニフェストファイルも付属します。出力アーカイブがすでに存在する場合は上書きされます。</p></li><li><p>入力として1つ以上の<code>.proto</code>ファイルを提供する必要があります。複数の<code>.proto</code>ファイルを一度に指定できます。ファイルは現在のディレクトリを基準として名前が付けられていますが、各ファイルは<code>IMPORT_PATH</code>の1つに存在する必要があります。これにより、コンパイラがその正規名を決定できます。</p></li></ul><p>{#location}</p><p><code>.proto</code>ファイルを他の言語ソースと同じディレクトリに置かないことをお勧めします。プロジェクトのルートパッケージの下に<code>.proto</code>ファイル用のサブパッケージ<code>proto</code>を作成することを検討してください。</p><p>{#location-language-agnostic}</p><p>Javaコードを扱う場合、関連する<code>.proto</code>ファイルをJavaソースと同じディレクトリに置くと便利です。ただし、他の言語のコードが同じprotoを使用する場合、パスの接頭辞はもはや意味をなさなくなります。そのため、一般的には、<code>//myteam/mypackage</code>などの関連する言語に依存しないディレクトリにprotoを配置してください。</p><p>このルールの例外は、protoがテスト用など、Javaコンテキストでのみ使用されることが明らかな場合です。</p><p>{#platforms}</p><p>以下の情報については:</p><ul><li>サポートされているオペレーティングシステム、コンパイラ、ビルドシステム、およびサポートされているC++バージョンについては、<a href=https://opensource.google/documentation/policies/cplusplus-support>基本的なC++サポートポリシー</a>を参照してください。</li><li>サポートされているPHPバージョンについては、<a href=https://cloud.google.com/php/getting-started/supported-php-versions>サポートされているPHPバージョン</a>を参照してください。</li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank rel=noopener href=https://stackoverflow.com/questions/tagged/protocol-buffers aria-label="Stack Overflow"><i class="fab fa-stack-overflow"></i></a></li></ul><script type=text/javascript id=cookiebanner src=https://cdn.jsdelivr.net/gh/dobarkod/cookie-banner@1.2.2/dist/cookiebanner.min.js data-height=50px data-message="Protobuf.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic." data-bg=#ffb data-fg=#000 data-position=bottom data-padding="10px 16px" data-close-text="OK, got it" data-font-size=18px data-moreinfo=https://policies.google.com/technologies/cookies></script></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/protocolbuffers/protobuf aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/g/protobuf aria-label="Developer mailing list"><i class="fa fa-envelope"></i></a></li></ul><script type=text/javascript id=cookiebanner src=https://cdn.jsdelivr.net/gh/dobarkod/cookie-banner@1.2.2/dist/cookiebanner.min.js data-height=50px data-message="Protobuf.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic." data-bg=#ffb data-fg=#000 data-position=bottom data-padding="10px 16px" data-close-text="OK, got it" data-font-size=18px data-moreinfo=https://policies.google.com/technologies/cookies></script></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2024 Google LLC All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank rel=noopener>プライバシーポリシー</a></small>
<span class=text-white>Hosted by GitHub Pages.</span> <a href=https://docs.github.com/en/site-policy/privacy-policies/github-privacy-statement target=_blank>GitHub Privacy Statement</a></div></div></div></footer></div><script src=/js/main.min.ba08a6b7f24e657f0a1b9b55be3a3162585168cd862ace0957f5b44e6cb6dc61.js integrity="sha256-ugimt/JOZX8KG5tVvjoxYlhRaM2GKs4JV/W0Tmy23GE=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>