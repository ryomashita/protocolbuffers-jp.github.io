<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=ja class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.121.2"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Python 生成コードガイド | Protocol Buffers Documentation</title>
<meta name=description content="与えられたプロトコル定義に対してプロトコルバッファコンパイラが生成する Python 定義を正確に説明します。"><meta property="og:title" content="Python 生成コードガイド"><meta property="og:description" content="与えられたプロトコル定義に対してプロトコルバッファコンパイラが生成する Python 定義を正確に説明します。"><meta property="og:type" content="article"><meta property="og:url" content="https://protobuf.dev/ja/reference/python/python-generated/"><meta property="article:section" content="reference"><meta itemprop=name content="Python 生成コードガイド"><meta itemprop=description content="与えられたプロトコル定義に対してプロトコルバッファコンパイラが生成する Python 定義を正確に説明します。"><meta itemprop=wordCount content="1374"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Python 生成コードガイド"><meta name=twitter:description content="与えられたプロトコル定義に対してプロトコルバッファコンパイラが生成する Python 定義を正確に説明します。"><link rel=preload href=/scss/main.min.6a57e8f3f347dea5d31cb48e3b4ea9fdae32d499473089bdef9b45457b5debb8.css as=style><link href=/scss/main.min.6a57e8f3f347dea5d31cb48e3b4ea9fdae32d499473089bdef9b45457b5debb8.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-5L8P8GRN4Y"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5L8P8GRN4Y")}</script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/ja/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Protocol Buffers Documentation</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>日本語</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/reference/python/python-generated/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder=サイトを検索... aria-label=サイトを検索... autocomplete=off></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder=サイトを検索... aria-label=サイトを検索... autocomplete=off></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>日本語</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/reference/python/python-generated/>English</a></div></div><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-ja-li><a href=/ja/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-ja><span>Protocol Buffers</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jaoverview-li><a href=/ja/overview/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jaoverview><span>概要</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-janews-li><a href=/ja/news/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-janews><span>ニュース</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janews2022-05-06-li><a href=/ja/news/2022-05-06/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janews2022-05-06><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janews2023-07-06-li><a href=/ja/news/2023-07-06/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janews2023-07-06><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janews2023-08-09-li><a href=/ja/news/2023-08-09/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janews2023-08-09><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janews2023-08-15-li><a href=/ja/news/2023-08-15/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janews2023-08-15><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janews2023-09-15-li><a href=/ja/news/2023-09-15/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janews2023-09-15><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janews2023-12-27-li><a href=/ja/news/2023-12-27/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janews2023-12-27><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janews2024-06-26-li><a href=/ja/news/2024-06-26/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janews2024-06-26><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-japrogramming-guides-li><a href=/ja/programming-guides/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-japrogramming-guides><span>プログラミングガイド</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesproto2-li><a href=/ja/programming-guides/proto2/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesproto2><span>言語ガイド（proto 2）</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesproto3-li><a href=/ja/programming-guides/proto3/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesproto3><span>言語ガイド（proto 3）</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesstyle-li><a href=/ja/programming-guides/style/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesstyle><span>スタイルガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesaddons-li><a href=/ja/programming-guides/addons/ title=サードパーティーアドオン class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesaddons><span>アドオン</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesapi-li><a href=/ja/programming-guides/api/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesapi><span>API ベストプラクティス</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesdos-donts-li><a href=/ja/programming-guides/dos-donts/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesdos-donts><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesencoding-li><a href=/ja/programming-guides/encoding/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesencoding><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesenum-li><a href=/ja/programming-guides/enum/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesenum><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesextension_declarations-li><a href=/ja/programming-guides/extension_declarations/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesextension_declarations><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesfield_presence-li><a href=/ja/programming-guides/field_presence/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesfield_presence><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesserialization-not-canonical-li><a href=/ja/programming-guides/serialization-not-canonical/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesserialization-not-canonical><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidestechniques-li><a href=/ja/programming-guides/techniques/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidestechniques><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jaeditions-li><a href=/ja/editions/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jaeditions><span>Protobuf Editions</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jaeditionsoverview-li><a href=/ja/editions/overview/ title="Protobuf Editions の概要" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jaeditionsoverview><span>概要</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jaeditionsfeatures-li><a href=/ja/editions/features/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jaeditionsfeatures><span>エディション向けの機能設定</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jaeditionsimplementation-li><a href=/ja/editions/implementation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jaeditionsimplementation><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jagetting-started-li><a href=/ja/getting-started/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jagetting-started><span>チュートリアル</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jagetting-startedcpptutorial-li><a href=/ja/getting-started/cpptutorial/ title="プロトコルバッファの基礎: C++" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jagetting-startedcpptutorial><span>C++</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jagetting-startedcsharptutorial-li><a href=/ja/getting-started/csharptutorial/ title="Protocol Buffer Basics: C#" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jagetting-startedcsharptutorial><span>C#</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jagetting-starteddarttutorial-li><a href=/ja/getting-started/darttutorial/ title="Protocol Buffer Basics: Dart" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jagetting-starteddarttutorial><span>Dart</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jagetting-startedgotutorial-li><a href=/ja/getting-started/gotutorial/ title="プロトコルバッファの基本: Go" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jagetting-startedgotutorial><span>Go</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jagetting-startedjavatutorial-li><a href=/ja/getting-started/javatutorial/ title="プロトコルバッファの基礎: Java" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jagetting-startedjavatutorial><span>Java</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jagetting-startedkotlintutorial-li><a href=/ja/getting-started/kotlintutorial/ title="Protocol Buffer Basics: Kotlin" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jagetting-startedkotlintutorial><span>Kotlin</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jagetting-startedpythontutorial-li><a href=/ja/getting-started/pythontutorial/ title="プロトコルバッファの基礎: Python" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jagetting-startedpythontutorial><span>Python</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-jareference-li><a href=/ja/reference/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareference><span>リファレンスガイド</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferencecpp-li><a href=/ja/reference/cpp/ title="C++ リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencecpp><span>C++</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppcpp-generated-li><a href=/ja/reference/cpp/cpp-generated/ title="C++ 生成コードガイド" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppcpp-generated><span>生成コードガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecpparenas-li><a href=/ja/reference/cpp/arenas/ title="C++ アリーナ割り当てガイド" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecpparenas><span>アリーナ割り当てガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docs-link-li><a href=/reference/cpp/api-docs/ target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docs-link><span>C++ API</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilercpp_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.cpp_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilercpp_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilercsharp_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.csharp_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilercsharp_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilercsharp_names-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.csharp_names/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilercsharp_names><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerjava_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.java_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerjava_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerjava_names-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.java_names/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerjava_names><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerjavanano_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.javanano_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerjavanano_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerjs_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.js_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerjs_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerobjectivec_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.objectivec_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerobjectivec_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerparser-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.parser/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerparser><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerplugin-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.plugin/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerplugin><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerpluginpb-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.plugin.pb/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerpluginpb><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerpython_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.python_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerpython_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerruby_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.ruby_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerruby_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufdescriptorpb-li><a href=/ja/reference/cpp/api-docs/google.protobuf.descriptor.pb/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufdescriptorpb><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufdynamic_message-li><a href=/ja/reference/cpp/api-docs/google.protobuf.dynamic_message/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufdynamic_message><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufutilfield_comparator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.util.field_comparator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufutilfield_comparator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufutiljson_util-li><a href=/ja/reference/cpp/api-docs/google.protobuf.util.json_util/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufutiljson_util><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufutiltype_resolver-li><a href=/ja/reference/cpp/api-docs/google.protobuf.util.type_resolver/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufutiltype_resolver><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufutiltype_resolver_util-li><a href=/ja/reference/cpp/api-docs/google.protobuf.util.type_resolver_util/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufutiltype_resolver_util><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferencecsharp-li><a href=/ja/reference/csharp/ title="C# リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencecsharp><span>C#</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecsharpcsharp-generated-li><a href=/ja/reference/csharp/csharp-generated/ title="C# 生成コードガイド" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecsharpcsharp-generated><span>生成コードガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecsharpapi-docs-link-li><a href=/reference/csharp/api-docs target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecsharpapi-docs-link><span>C# API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferencedart-li><a href=/ja/reference/dart/ title="Dart リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencedart><span>Dart</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencedartdart-generated-li><a href=/ja/reference/dart/dart-generated/ title="Dart Generated Code" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencedartdart-generated><span>生成されたコード</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencedartapi-docs-link-li><a href=https://pub.dartlang.org/documentation/protobuf target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencedartapi-docs-link><span>Dart API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferencego-li><a href=/ja/reference/go/ title=Goリファレンス class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencego><span>Go</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencegogo-generated-li><a href=/ja/reference/go/go-generated/ title="Go Generated Code Guide" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencegogo-generated><span>生成されたコードガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencegoapi-docs-link-li><a href=https://pkg.go.dev/google.golang.org/protobuf/proto target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencegoapi-docs-link><span>Go API</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencegofaq-li><a href=/ja/reference/go/faq/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencegofaq><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencegosize-li><a href=/ja/reference/go/size/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencegosize><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferencejava-li><a href=/ja/reference/java/ title="Java リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencejava><span>Java</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencejavajava-generated-li><a href=/ja/reference/java/java-generated/ title=Java生成コードガイド class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencejavajava-generated><span>生成コードガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencejavajava-proto-names-li><a href=/ja/reference/java/java-proto-names/ title="Java Proto Names" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencejavajava-proto-names><span>生成されたProto名</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencejavaapi-docs-link-li><a href=/reference/java/api-docs/overview-summary.html target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencejavaapi-docs-link><span>Java API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferencekotlin-li><a href=/ja/reference/kotlin/ title="Kotlin リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencekotlin><span>Kotlin</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencekotlinapi-docs-li><a href=/ja/reference/kotlin/api-docs/ title="Kotlin リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencekotlinapi-docs><span>Kotlin</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencekotlinkotlin-generated-li><a href=/ja/reference/kotlin/kotlin-generated/ title="Kotlin 生成コードガイド" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencekotlinkotlin-generated><span>生成コードガイド</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferenceobjective-c-li><a href=/ja/reference/objective-c/ title="Objective-C リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferenceobjective-c><span>Objective-C</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferenceobjective-cobjective-c-generated-li><a href=/ja/reference/objective-c/objective-c-generated/ title="Objective-C 生成コードガイド" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferenceobjective-cobjective-c-generated><span>生成コードガイド</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferencephp-li><a href=/ja/reference/php/ title="PHP リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencephp><span>PHP</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencephpphp-generated-li><a href=/ja/reference/php/php-generated/ title="PHP 生成コードガイド" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencephpphp-generated><span>生成コードガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencephpapi-docs-link-li><a href=/reference/php/api-docs/ target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencephpapi-docs-link><span>PHP API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-jareferencepython-li><a href=/ja/reference/python/ title="Python リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencepython><span>Python</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-jareferencepythonpython-generated-li><a href=/ja/reference/python/python-generated/ title="Python 生成コードガイド" class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-jareferencepythonpython-generated><span class=td-sidebar-nav-active-item>生成コードガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencepythonapi-docs-link-li><a href=https://googleapis.dev/python/protobuf/latest/ target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencepythonapi-docs-link><span>Python API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferenceruby-li><a href=/ja/reference/ruby/ title="Ruby リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferenceruby><span>Ruby</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencerubyruby-generated-li><a href=/ja/reference/ruby/ruby-generated/ title="Ruby Generated Code Guide" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencerubyruby-generated><span>生成されたコードガイド</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferenceprotobuf-li><a href=/ja/reference/protobuf/ title=プロトコルバッファリファレンス class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferenceprotobuf><span>プロトコルバッファ</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferenceprotobufedition-2023-spec-li><a href=/ja/reference/protobuf/edition-2023-spec/ title="Protocol Buffers Edition 2023 言語仕様" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferenceprotobufedition-2023-spec><span>2023 言語仕様</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferenceprotobufproto2-spec-li><a href=/ja/reference/protobuf/proto2-spec/ title="Protocol Buffers Version 2 言語仕様" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferenceprotobufproto2-spec><span>Version 2 言語仕様</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferenceprotobufproto3-spec-li><a href=/ja/reference/protobuf/proto3-spec/ title="Protocol Buffers Version 3 言語仕様" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferenceprotobufproto3-spec><span>Version 3 言語仕様</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferenceprotobuftextformat-spec-li><a href=/ja/reference/protobuf/textformat-spec/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferenceprotobuftextformat-spec><span>テキスト形式言語仕様</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferenceprotobufgoogleprotobuf-li><a href=/ja/reference/protobuf/google.protobuf/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferenceprotobufgoogleprotobuf><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferenceother-li><a href=/ja/reference/other/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferenceother><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jasupport-li><a href=/ja/support/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jasupport><span>サポート</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jasupportversion-support-li><a href=/ja/support/version-support/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jasupportversion-support><span>バージョンサポート</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jasupportcross-version-runtime-guarantee-li><a href=/ja/support/cross-version-runtime-guarantee/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jasupportcross-version-runtime-guarantee><span>クロスバージョンランタイム保証</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jasupportmigration-li><a href=/ja/support/migration/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jasupportmigration><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jaforum-link-li><a href=https://groups.google.com/g/protobuf target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jaforum-link><span>フォーラム</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jadownloads-li><a href=/ja/downloads/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jadownloads><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jahistory-li><a href=/ja/history/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jahistory><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janavbar-li><a href=/ja/navbar/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janavbar><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jasearch-li><a href=/ja/search/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jasearch><span>検索結果</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/protocolbuffers/protocolbuffers.github.io/tree/main/content/reference/python/python-generated.ja.md class=td-page-meta--view target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/protocolbuffers/protocolbuffers.github.io/edit/main/content/reference/python/python-generated.ja.md class=td-page-meta--edit target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> ページの編集</a>
<a href="https://github.com/protocolbuffers/protocolbuffers.github.io/new/main/content/reference/python/python-generated.ja.md?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class=td-page-meta--child target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> 子ページを作成</a>
<a href="https://github.com/protocolbuffers/protocolbuffers.github.io/issues/new?title=Python%20%e7%94%9f%e6%88%90%e3%82%b3%e3%83%bc%e3%83%89%e3%82%ac%e3%82%a4%e3%83%89" class=td-page-meta--issue target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> ドキュメントのissueを作成</a>
<a href=https://github.com/protocolbuffers/protobuf/issues/new class=td-page-meta--project-issue target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> プロジェクトのissueを作成</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#invocation>コンパイラの呼び出し</a></li><li><a href=#package>パッケージ</a></li><li><a href=#message>メッセージ</a><ul><li><a href=#nested-types>ネストされた型</a></li></ul></li><li><a href=#wkt>Well Known Types</a><ul><li><a href=#any>Any</a></li><li><a href=#timestamp>タイムスタンプ</a></li><li><a href=#duration>持続時間</a></li><li><a href=#fieldmask>FieldMask</a></li><li><a href=#struct>Struct</a></li><li><a href=#listvalue>ListValue</a></li></ul></li><li><a href=#fields>Fields</a><ul><li><a href=#singular-fields-proto2>Singular Fields (proto2)</a></li><li><a href=#singular-fields-proto3>単数フィールド（proto3）</a></li><li><a href=#embedded_message>単数メッセージフィールド</a></li><li><a href=#repeated-fields>繰り返しフィールド</a></li><li><a href=#repeated-message-fields>繰り返しメッセージフィールド</a></li><li><a href=#groups-proto2>グループ (proto2)</a></li><li><a href=#map-fields>マップフィールド</a></li></ul></li><li><a href=#enum>列挙型</a></li><li><a href=#oneof>Oneof</a></li><li><a href=#keyword-conflicts>Pythonのキーワードと競合する名前</a></li><li><a href=#extension>拡張機能（proto2のみ）</a><ul><li><a href=#interface>インターフェース</a></li><li><a href=#stub>Stub</a></li></ul></li><li><a href=#plugins>プラグイン挿入ポイント</a></li><li><a href=#sharing-messages>PythonとC++間でメッセージを共有する</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=https://protobuf.dev/ja/reference/>リファレンスガイド</a></li><li class=breadcrumb-item><a href=https://protobuf.dev/ja/reference/python/>Python</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://protobuf.dev/ja/reference/python/python-generated/ aria-disabled=true class="btn-link disabled">生成コードガイド</a></li></ol></nav><div class=td-content><h1>Python 生成コードガイド</h1><div class=lead>与えられたプロトコル定義に対してプロトコルバッファコンパイラが生成する Python 定義を正確に説明します。</div><header class=article-meta></header><p>プロト2とプロト3で生成されるコードの違いは強調されています - これらの違いは、このドキュメントで説明されている生成されたコードにあります。ベースのメッセージクラス/インターフェースは両バージョンで同じです。このドキュメントを読む前に、<a href=/programming-guides/proto2>プロト2言語ガイド</a>および/または<a href=/programming-guides/proto3>プロト3言語ガイド</a>を読む必要があります。</p><p>Python Protocol Buffers の実装は、C++やJavaとは少し異なります。Pythonでは、コンパイラは生成されたクラスの記述子を構築するためのコードのみを出力し、<a href=https://docs.python.org/2.7/reference/datamodel#metaclasses>Python メタクラス</a>が実際の作業を行います。このドキュメントは、メタクラスが適用された後に得られる内容を説明します。</p><h2 id=invocation>コンパイラの呼び出し</h2><p>プロトコルバッファコンパイラは、<code>--python_out=</code> コマンドラインフラグを使用して呼び出されると、Python 出力を生成します。<code>--python_out=</code> オプションのパラメータは、コンパイラが Python 出力を書き込むディレクトリです。コンパイラは、各 <code>.proto</code> ファイルの入力ごとに <code>.py</code> ファイルを作成します。出力ファイルの名前は、次の2つの変更を行うことで計算されます。</p><ul><li>拡張子（<code>.proto</code>）は <code>_pb2.py</code> に置き換えられます。</li><li>proto パス（<code>--proto_path=</code> または <code>-I</code> コマンドラインフラグで指定）は、出力パス（<code>--python_out=</code> フラグで指定）に置き換えられます。</li></ul><p>例えば、次のようにコンパイラを呼び出すとします：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>protoc --proto_path<span style=color:#ce5c00;font-weight:700>=</span>src --python_out<span style=color:#ce5c00;font-weight:700>=</span>build/gen src/foo.proto src/bar/baz.proto
</span></span></code></pre></div><p>コンパイラは、<code>src/foo.proto</code> と <code>src/bar/baz.proto</code> ファイルを読み込み、2つの出力ファイル <code>build/gen/foo_pb2.py</code> と <code>build/gen/bar/baz_pb2.py</code> を生成します。必要に応じてコンパイラはディレクトリ <code>build/gen/bar</code> を自動的に作成しますが、<code>build</code> または <code>build/gen</code> は作成しません。それらはすでに存在している必要があります。</p><p>Protocは、<code>--pyi_out</code>パラメータを使用してPythonスタブ（<code>.pyi</code>）を生成できます。</p><p><code>.proto</code>ファイルまたはそのパスにPythonモジュール名として使用できない文字が含まれている場合（例：ハイフンなど）、それらはアンダースコアに置き換えられます。したがって、ファイル<code>foo-bar.proto</code>はPythonファイル<code>foo_bar_pb2.py</code>になります。</p><div class="alert alert-note" role=alert><h4 class=alert-heading>ヒント</h4>Pythonコードを出力する際、プロトコルバッファコンパイラがZIPアーカイブに直接出力できる機能は特に便利です。Pythonインタプリタは、これらのアーカイブが<code>PYTHONPATH</code>に配置されている場合に直接読み取ることができます。ZIPファイルに出力するには、単に<code>.zip</code>で終わる出力場所を指定します。</div><div class="alert alert-note" role=alert><h4 class=alert-heading>注意</h4>拡張子<code>_pb2.py</code>の中の数字2は、Protocol Buffersのバージョン2を示しています。バージョン1は主にGoogle内部で使用されていましたが、Protocol Buffersより前にリリースされた他のPythonコードの一部に含まれている可能性があります。Python Protocol Buffersのバージョン2は、完全に異なるインターフェースを持っており、Pythonにはコンパイル時の型チェックがないため、間違いをキャッチするためのコンパイル時の型チェックがないため、生成されたPythonファイル名の一部としてバージョン番号を目立たせることを選択しました。現在、proto2とproto3の両方が生成されたファイルに<code>_pb2.py</code>を使用しています。</div><h2 id=package>パッケージ</h2><p>プロトコルバッファコンパイラによって生成されたPythonコードは、<code>.proto</code>ファイルで定義されたパッケージ名には全く影響を受けません。代わりに、Pythonパッケージはディレクトリ構造によって識別されます。</p><h2 id=message>メッセージ</h2><p>単純なメッセージ宣言がある場合：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>プロトコルバッファコンパイラは、<code>google.protobuf.Message</code>をサブクラス化した<code>Foo</code>というクラスを生成します。このクラスは具象クラスであり、未実装の抽象メソッドはありません。C++やJavaとは異なり、Python生成コードは<code>.proto</code>ファイルの<code>optimize_for</code>オプションに影響を受けません。実際には、すべてのPythonコードはコードサイズに最適化されています。</p><p>Pythonのキーワードと競合する名前の場合、そのクラスは<a href=#keyword-conflicts><em>Pythonのキーワードと競合する名前</em></a>セクションで説明されているように<code>getattr()</code>を介してのみアクセス可能です。</p><p>独自の<code>Foo</code>のサブクラスを作成しないでください。生成されたクラスはサブクラス化のために設計されておらず、「壊れやすい基底クラス」の問題を引き起こす可能性があります。さらに、実装継承は悪い設計です。</p><p>Pythonのメッセージクラスには、<code>Message</code>インターフェースで定義されたものと、ネストされたフィールド、メッセージ、列挙型で生成されたものを除いて、特に公開メンバーはありません（以下で説明）。<code>Message</code>は、バイナリ文字列からのパースやシリアライズを含む、メッセージ全体のチェック、操作、読み取り、書き込みに使用できるメソッドを提供します。これらのメソッドに加えて、<code>Foo</code>クラスは以下の静的メソッドを定義しています：</p><ul><li><code>FromString(s)</code>: 指定された文字列からデシリアライズされた新しいメッセージインスタンスを返します。</li></ul><p>プロトコルメッセージをテキスト形式で扱うために<a href=https://googleapis.dev/python/protobuf/latest/google/protobuf/text_format.html><code>text_format</code></a>モジュールを使用することもできます。たとえば、<code>Merge()</code>メソッドを使用すると、メッセージのASCII表現を既存のメッセージにマージできます。</p><h3 id=nested-types>ネストされた型</h3><p>メッセージは他のメッセージの内部で宣言できます。例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Bar</span> <span style=color:#000;font-weight:700>{}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>この場合、<code>Bar</code>クラスは<code>Foo</code>の静的メンバーとして宣言されているため、<code>Foo.Bar</code>として参照できます。</p><h2 id=wkt>Well Known Types</h2><p>Protocol Buffersは、独自のメッセージ型と一緒に使用できるいくつかの<a href=/reference/protobuf/google.protobuf>well-known types</a>を提供しています。一部のWKTメッセージには、通常のプロトコルバッファメッセージメソッドに加えて特別なメソッドがあり、これらは<a href=https://googleapis.dev/python/protobuf/latest/google/protobuf/message.html#google.protobuf.message.Message><code>google.protobuf.Message</code></a>とWKTクラスの両方をサブクラス化しています。</p><h3 id=any>Any</h3><p>Anyメッセージの場合、<code>Pack()</code>を呼び出して指定されたメッセージを現在のAnyメッセージにパックしたり、<code>Unpack()</code>を呼び出して現在のAnyメッセージを指定されたメッセージにアンパックしたりできます。例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>any_message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Pack</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>message</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>any_message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Unpack</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>message</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p><code>Unpack()</code>は、渡されたメッセージオブジェクトの記述子を格納されたものと照合し、一致しない場合は<code>False</code>を返し、アンパッキングを試みません。一致する場合は<code>True</code>を返します。</p><p>また、<code>Is()</code>メソッドを呼び出して、Anyメッセージが指定されたプロトコルバッファタイプを表しているかどうかを確認できます。例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>any_message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Is</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>DESCRIPTOR</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p><code>TypeName()</code>メソッドを使用して、内部メッセージのprotobufタイプ名を取得できます。</p><h3 id=timestamp>タイムスタンプ</h3><p>タイムスタンプメッセージは、RFC 3339日付文字列形式（JSON文字列）に変換するために<code>ToJsonString()</code>/<code>FromJsonString()</code>メソッドを使用できます。例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>timestamp_message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>FromJsonString</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;1970-01-01T00:00:00Z&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>timestamp_message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ToJsonString</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;1970-01-01T00:00:00Z&#34;</span>
</span></span></code></pre></div><p>また、<code>GetCurrentTime()</code>を呼び出して、タイムスタンプメッセージを現在時刻で埋めることもできます。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>timestamp_message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>GetCurrentTime</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>エポック以降の他の時間単位間の変換には、<code>ToNanoseconds()、FromNanoseconds()、ToMicroseconds()、FromMicroseconds()、ToMilliseconds()、FromMilliseconds()、ToSeconds()</code>、<code>FromSeconds()</code>を呼び出すことができます。生成されたコードには、Pythonのdatetimeオブジェクトとタイムスタンプ間の変換を行う<code>ToDatetime()</code>および<code>FromDatetime()</code>メソッドもあります。例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>timestamp_message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>FromMicroseconds</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>timestamp_message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ToMicroseconds</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span><span style=color:#000>dt</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>datetime</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2016</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>timestamp_message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>FromDatetime</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dt</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>assertEqual</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dt</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>timestamp_message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ToDatetime</span><span style=color:#000;font-weight:700>())</span>
</span></span></code></pre></div><h3 id=duration>持続時間</h3><p>持続時間メッセージは、JSON文字列と他の時間単位間の変換に関するタイムスタンプと同じメソッドを持っています。timedeltaとDurationの間で変換するには、<code>ToTimedelta()</code>または<code>FromTimedelta</code>を呼び出すことができます。例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>duration_message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>FromNanoseconds</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1999999999</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>td</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>duration_message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ToTimedelta</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>td</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>seconds</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>td</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>microseconds</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>999999</span>
</span></span></code></pre></div><h3 id=fieldmask>FieldMask</h3><p>FieldMaskメッセージは、<code>ToJsonString()</code>/<code>FromJsonString()</code>メソッドを使用してJSON文字列に変換および変換できます。さらに、FieldMaskメッセージには次のメソッドがあります：</p><ul><li><code>IsValidForDescriptor(message_descriptor)</code>: FieldMaskがメッセージ記述子に対して有効かどうかをチェックします。</li><li><code>AllFieldsFromDescriptor(message_descriptor)</code>: メッセージ記述子のすべての直接フィールドをFieldMaskに取得します。</li><li><code>CanonicalFormFromMask(mask)</code>: FieldMaskを正規形に変換します。</li><li><code>Union(mask1, mask2)</code>: 2つのFieldMaskをこのFieldMaskにマージします。</li><li><code>Intersect(mask1, mask2)</code>: 2つのFieldMaskをこのFieldMaskにインターセクトします。</li><li><code>MergeMessage(source, destination, replace_message_field=False, replace_repeated_field=False)</code>: FieldMaskで指定されたフィールドをソースからデスティネーションにマージします。</li></ul><h3 id=struct>Struct</h3><p>Structメッセージを使用すると、アイテムを直接取得および設定できます。例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>struct_message</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;key1&#34;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5</span>
</span></span><span style=display:flex><span><span style=color:#000>struct_message</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;key2&#34;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;abc&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>struct_message</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;key3&#34;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>True</span>
</span></span></code></pre></div><p>リスト/構造体を取得または作成するには、<code>get_or_create_list()</code>/<code>get_or_create_struct()</code> を呼び出すことができます。例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>struct</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_or_create_struct</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;key4&#34;</span><span style=color:#000;font-weight:700>)[</span><span style=color:#4e9a06>&#34;subkey&#34;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>11.0</span>
</span></span><span style=display:flex><span><span style=color:#000>struct</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_or_create_list</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;key5&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h3 id=listvalue>ListValue</h3><p>ListValueメッセージは、Pythonのシーケンスのように機能し、次のような操作ができます：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>list_value</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>struct_message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_or_create_list</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;key&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>list_value</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>extend</span><span style=color:#000;font-weight:700>([</span><span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;seven&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>True</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>None</span><span style=color:#000;font-weight:700>])</span>
</span></span><span style=display:flex><span><span style=color:#000>list_value</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>append</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>False</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>list_value</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>5</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>list_value</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>6</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>list_value</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;seven&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>list_value</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>True</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>list_value</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>None</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>list_Value</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>False</span>
</span></span></code></pre></div><p>ListValue/Structを追加するには、<code>add_list()</code>/<code>add_struct()</code> を呼び出します。例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>list_value</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>add_struct</span><span style=color:#000;font-weight:700>()[</span><span style=color:#4e9a06>&#34;key&#34;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span><span style=color:#000>list_value</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>add_list</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>extend</span><span style=color:#000;font-weight:700>([</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;two&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>True</span><span style=color:#000;font-weight:700>])</span>
</span></span></code></pre></div><h2 id=fields>Fields</h2><p>メッセージタイプの各フィールドについて、対応するクラスにはフィールドと同じ名前のプロパティがあります。プロパティを操作する方法は、そのタイプによって異なります。</p><p>プロパティと同様に、コンパイラは各フィールドに対して整数定数を生成し、そのフィールド番号を含みます。定数名は、フィールド名を大文字に変換してから <code>_FIELD_NUMBER</code> を追加したものです。たとえば、フィールド <code>optional int32 foo_bar = 5;</code> が与えられた場合、コンパイラは定数 <code>FOO_BAR_FIELD_NUMBER = 5</code> を生成します。</p><p>フィールドの名前がPythonのキーワードの場合、そのプロパティは <code>getattr()</code> および <code>setattr()</code> を介してのみアクセス可能であり、<a href=#keyword-conflicts><em>Pythonのキーワードと競合する名前</em></a> セクションで説明されているようになります。</p><h3 id=singular-fields-proto2>Singular Fields (proto2)</h3><p>任意の非メッセージタイプの単数の（オプションまたは必須の）フィールド <code>foo</code> がある場合、<code>foo</code> フィールドを通常のフィールドとして操作できます。たとえば、<code>foo</code> のタイプが <code>int32</code> の場合、次のようにできます：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>123</span>
</span></span><span style=display:flex><span><span style=color:#204a87>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>foo</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p><code>foo</code> を間違ったタイプの値に設定すると、<code>TypeError</code> が発生します。</p><p><code>foo</code> が設定されていない状態で読み取られると、そのフィールドのデフォルト値がその値となります。<code>foo</code> が設定されているかどうかを確認したり、<code>foo</code> の値をクリアするには、<a href=https://googleapis.dev/python/protobuf/latest/google/protobuf/message.html#google.protobuf.message.Message><code>Message</code></a> インターフェースの <code>HasField()</code> メソッドまたは <code>ClearField()</code> メソッドを呼び出す必要があります。例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#204a87;font-weight:700>not</span> <span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>HasField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;foo&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>123</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>HasField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;foo&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ClearField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;foo&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#204a87;font-weight:700>not</span> <span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>HasField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;foo&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h3 id=singular-fields-proto3>単数フィールド（proto3）</h3><p>もし、任意の非メッセージ型の単数フィールド <code>foo</code> がある場合、そのフィールド <code>foo</code> を通常のフィールドのように操作できます。例えば、もし <code>foo</code> の型が <code>int32</code> である場合、以下のようにできます：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>123</span>
</span></span><span style=display:flex><span><span style=color:#204a87>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>foo</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p><code>foo</code> を間違った型の値に設定すると <code>TypeError</code> が発生することに注意してください。</p><p>もし <code>foo</code> が設定されていない状態で読み取られた場合、そのフィールドのデフォルト値がその値となります。<code>foo</code> の値をクリアして、その型のデフォルト値にリセットするには、<a href=https://googleapis.dev/python/protobuf/latest/google/protobuf/message.html#google.protobuf.message.Message><code>Message</code></a> インターフェースの <code>ClearField()</code> メソッドを呼び出します。例えば：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>123</span>
</span></span><span style=display:flex><span><span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ClearField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;foo&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h3 id=embedded_message>単数メッセージフィールド</h3><p>メッセージ型は少し異なる動作をします。埋め込まれたメッセージフィールドに値を割り当てることはできません。代わりに、子メッセージ内の任意のフィールドに値を割り当てることは、親のメッセージフィールドを設定することを意味します。また、親メッセージの <code>HasField()</code> メソッドを使用して、メッセージ型フィールドの値が設定されているかどうかを確認できます。</p><p>例えば、次の <code>.proto</code> 定義があるとします：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>Bar</span> <span style=color:#000>bar</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Bar</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>以下のようなことはできません：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Foo</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bar</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Bar</span><span style=color:#000;font-weight:700>()</span>  <span style=color:#8f5902;font-style:italic># 間違い！</span>
</span></span></code></pre></div><p>代わりに、<code>bar</code> を設定するには、単純に <code>bar</code> 内のフィールドに直接値を割り当てるだけで、<code>foo</code> に <code>bar</code> フィールドができます：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Foo</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#204a87;font-weight:700>not</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>HasField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;bar&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bar</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>HasField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;bar&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bar</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span><span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ClearField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;bar&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#204a87;font-weight:700>not</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>HasField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;bar&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bar</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>0</span>  <span style=color:#8f5902;font-style:italic># Default value</span>
</span></span></code></pre></div><p>同様に、<a href=https://googleapis.dev/python/protobuf/latest/google/protobuf/message.html#google.protobuf.message.Message><code>Message</code></a> インターフェースの <code>CopyFrom()</code> メソッドを使用して <code>bar</code> を設定できます。これにより、<code>bar</code> と同じ型の別のメッセージからすべての値がコピーされます。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bar</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>CopyFrom</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>baz</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p><code>bar</code> 内のフィールドを単に読み取るだけでは、そのフィールドは設定されません：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Foo</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#204a87;font-weight:700>not</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>HasField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;bar&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bar</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>)</span>  <span style=color:#8f5902;font-style:italic># Print i&#39;s default value</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#204a87;font-weight:700>not</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>HasField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;bar&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>もし、設定する必要のないメッセージに "has" ビットが必要な場合は、<code>SetInParent()</code> メソッドを使用できます。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Foo</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#204a87;font-weight:700>not</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>HasField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;bar&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bar</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>SetInParent</span><span style=color:#000;font-weight:700>()</span>  <span style=color:#8f5902;font-style:italic># Set Foo.bar to a default Bar message</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>HasField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;bar&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h3 id=repeated-fields>繰り返しフィールド</h3><p>繰り返しフィールドは、Pythonのシーケンスのように振る舞うオブジェクトとして表されます。
埋め込まれたメッセージと同様に、フィールドに直接値を割り当てることはできませんが、操作することはできます。たとえば、次のメッセージ定義が与えられた場合：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>nums</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>次のようにできます：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Foo</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>nums</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>append</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>15</span><span style=color:#000;font-weight:700>)</span>        <span style=color:#8f5902;font-style:italic># Appends one value</span>
</span></span><span style=display:flex><span><span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>nums</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>extend</span><span style=color:#000;font-weight:700>([</span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>47</span><span style=color:#000;font-weight:700>])</span>  <span style=color:#8f5902;font-style:italic># Appends an entire list</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>nums</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>3</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>nums</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>15</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>nums</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>32</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>nums</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>15</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>47</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>nums</span><span style=color:#000;font-weight:700>[:]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>48</span><span style=color:#000;font-weight:700>]</span>     <span style=color:#8f5902;font-style:italic># Assigns an entire list</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>nums</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>33</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>48</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>nums</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>56</span>    <span style=color:#8f5902;font-style:italic># Reassigns a value</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>nums</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>56</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>nums</span><span style=color:#000;font-weight:700>:</span>  <span style=color:#8f5902;font-style:italic># Loops and print</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>del</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>nums</span><span style=color:#000;font-weight:700>[:]</span>     <span style=color:#8f5902;font-style:italic># Clears list (works just like in a Python list)</span>
</span></span></code></pre></div><p><a href=https://googleapis.dev/python/protobuf/latest/google/protobuf/message.html#google.protobuf.message.Message><code>Message</code></a> インターフェースの <code>ClearField()</code> メソッドを使用することも、Python の <code>del</code> を使用することもできます。</p><p>値を取得するためにインデックスを使用する場合、負の数を使用して、リスト内の最後の要素を取得することができます。インデックスが範囲外になると、<code>IndexError: list index out of range</code> が発生します。</p><h3 id=repeated-message-fields>繰り返しメッセージフィールド</h3><p>繰り返しメッセージフィールドは、繰り返しスカラーフィールドと同様に機能します。ただし、対応する Python オブジェクトには、新しいメッセージオブジェクトを作成し、リストに追加して呼び出し元が埋め込むための <code>add()</code> メソッドもあります。また、オブジェクトの <code>append()</code> メソッドは、与えられたメッセージのコピーを作成し、そのコピーをリストに追加します。これは、メッセージが常に親メッセージによって所有されるようにするために行われます。これにより、可変データ構造が複数の所有者を持つ場合に発生する循環参照やその他の混乱を回避できます。同様に、オブジェクトの <code>extend()</code> メソッドは、メッセージのリスト全体を追加しますが、リスト内の各メッセージのコピーを作成します。</p><p>たとえば、次のメッセージ定義が与えられた場合：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>Bar</span> <span style=color:#000>bars</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Bar</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>j</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>次のようにできます：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Foo</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000>bar</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>add</span><span style=color:#000;font-weight:700>()</span>        <span style=color:#8f5902;font-style:italic># Adds a Bar then modify</span>
</span></span><span style=display:flex><span><span style=color:#000>bar</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>15</span>
</span></span><span style=display:flex><span><span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>add</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>32</span>       <span style=color:#8f5902;font-style:italic># Adds and modify at the same time</span>
</span></span><span style=display:flex><span><span style=color:#000>new_bar</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Bar</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000>new_bar</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>40</span>
</span></span><span style=display:flex><span><span style=color:#000>another_bar</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Bar</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000>another_bar</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>57</span>
</span></span><span style=display:flex><span><span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>append</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>new_bar</span><span style=color:#000;font-weight:700>)</span>        <span style=color:#8f5902;font-style:italic># Uses append() to copy</span>
</span></span><span style=display:flex><span><span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>extend</span><span style=color:#000;font-weight:700>([</span><span style=color:#000>another_bar</span><span style=color:#000;font-weight:700>])</span>  <span style=color:#8f5902;font-style:italic># Uses extend() to copy</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>4</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>15</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>32</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>40</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>new_bar</span>      <span style=color:#8f5902;font-style:italic># The appended message is equal,</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>is</span> <span style=color:#204a87;font-weight:700>not</span> <span style=color:#000>new_bar</span>  <span style=color:#8f5902;font-style:italic># but it is a copy!</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>57</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>another_bar</span>      <span style=color:#8f5902;font-style:italic># The extended message is equal,</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>is</span> <span style=color:#204a87;font-weight:700>not</span> <span style=color:#000>another_bar</span>  <span style=color:#8f5902;font-style:italic># but it is a copy!</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>56</span>    <span style=color:#8f5902;font-style:italic># Modifies a single element</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>56</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>bar</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#000;font-weight:700>:</span>  <span style=color:#8f5902;font-style:italic># Loops and print</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>bar</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>del</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#000;font-weight:700>[:]</span>       <span style=color:#8f5902;font-style:italic># Clears list</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># add() also forwards keyword arguments to the concrete class.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># For example, you can do:</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>12</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>j</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Initializers forward keyword arguments to a concrete class too.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># For example:</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Foo</span><span style=color:#000;font-weight:700>(</span>             <span style=color:#8f5902;font-style:italic># Creates Foo</span>
</span></span><span style=display:flex><span>  <span style=color:#000>bars</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>[</span>               <span style=color:#8f5902;font-style:italic># with its field bars set to a list</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Bar</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>15</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>j</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>17</span><span style=color:#000;font-weight:700>),</span>   <span style=color:#8f5902;font-style:italic># where each list member is also initialized during creation.</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Bar</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Bar</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>47</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>j</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>77</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>3</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>15</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>j</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>17</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>32</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>47</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bars</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>j</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>77</span>
</span></span></code></pre></div><p>繰り返しスカラーフィールドとは異なり、繰り返しメッセージフィールドはアイテムの割り当てをサポートしません。</p><h3 id=groups-proto2>グループ (proto2)</h3><p><strong>新しいメッセージタイプを作成する際には、グループは非推奨であり、代わりにネストされたメッセージタイプを使用してください。</strong></p><p>グループは、ネストされたメッセージタイプとフィールドを1つの宣言に組み合わせ、メッセージに対して異なる<a href=/programming-guides/encoding>ワイヤーフォーマット</a>を使用します。生成されたメッセージはグループと同じ名前になります。生成されたフィールドの名前はグループの<strong>小文字化</strong>された名前です。</p><p>たとえば、ワイヤーフォーマットを除いて、次の2つのメッセージ定義は同等です:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>//</span> <span style=color:#000>Version</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>Using</span> <span style=color:#000>groups</span>
</span></span><span style=display:flex><span><span style=color:#000>message</span> <span style=color:#000>SearchResponse</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>repeated</span> <span style=color:#000>group</span> <span style=color:#000>SearchResult</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>optional</span> <span style=color:#000>string</span> <span style=color:#000>url</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>//</span> <span style=color:#000>Version</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>Not</span> <span style=color:#000>using</span> <span style=color:#000>groups</span>
</span></span><span style=display:flex><span><span style=color:#000>message</span> <span style=color:#000>SearchResponse</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>message</span> <span style=color:#000>SearchResult</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>optional</span> <span style=color:#000>string</span> <span style=color:#000>url</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000>repeated</span> <span style=color:#000>SearchResult</span> <span style=color:#000>searchresult</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>グループは<code>required</code>、<code>optional</code>、または<code>repeated</code>のいずれかです。<code>required</code>または<code>optional</code>のグループは、通常の単数メッセージフィールドと同じAPIを使用して操作されます。<code>repeated</code>グループは、通常の繰り返しメッセージフィールドと同じAPIを使用して操作されます。</p><p>たとえば、上記の<code>SearchResponse</code>定義がある場合、次のようにできます:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>resp</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>SearchResponse</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000>resp</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>searchresult</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>url</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;https://blog.google&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>resp</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>searchresult</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>url</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;https://blog.google&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>resp</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>searchresult</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>SearchResponse</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>SearchResult</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>url</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;https://blog.google&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h3 id=map-fields>マップフィールド</h3><p>次のメッセージ定義が与えられた場合:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>MyMessage</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>map</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>int32</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>int32</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000>mapfield</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>マップフィールドの生成されたPython APIは、Pythonの<code>dict</code>と同様です:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Assign value to map</span>
</span></span><span style=display:flex><span><span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>mapfield</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>10</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Read value from map</span>
</span></span><span style=display:flex><span><span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>mapfield</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Iterate over map keys</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>key</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>mapfield</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>key</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>mapfield</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>key</span><span style=color:#000;font-weight:700>])</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Test whether key is in map:</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#0000cf;font-weight:700>5</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>mapfield</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#a40000>“</span><span style=color:#000>Found</span><span style=color:#a40000>!”</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Delete key from map.</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>del</span> <span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>mapfield</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>key</span><span style=color:#000;font-weight:700>]</span>
</span></span></code></pre></div><p><a href=#embedded_message>埋め込みメッセージフィールド</a>と同様に、メッセージは直接マップ値に割り当てることはできません。代わりに、メッセージをマップ値として追加するには、<a href=#undefined>未定義のキー</a>を参照し、新しいサブメッセージを構築して返します:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>message_map</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>key</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>submessage_field</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>10</span>
</span></span></code></pre></div><p>次のセクションで未定義のキーについて詳しく説明します。</p><h4 id=undefined>未定義のキーの参照</h4><p>Protocol Bufferマップのセマンティクスは、未定義のキーに関してPythonの<code>dict</code>とわずかに異なる動作をします。通常のPythonの<code>dict</code>では、未定義のキーを参照するとKeyError例外が発生します:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>x</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>Traceback</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>most</span> <span style=color:#000>recent</span> <span style=color:#000>call</span> <span style=color:#000>last</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>  <span style=color:#000>File</span> <span style=color:#4e9a06>&#34;&lt;stdin&gt;&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>line</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>module</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#c00;font-weight:700>KeyError</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>5</span>
</span></span></code></pre></div><p>ただし、Protocol Buffersマップでは、未定義のキーを参照すると、マップ内にキーが作成され、ゼロ/偽/空の値が設定されます。この動作は、Python標準ライブラリの<code>defaultdict</code>に似ています。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#204a87>dict</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>mapfield</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>mapfield</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#204a87>dict</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>mapfield</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>この動作は、メッセージ型の値を持つマップに特に便利です。なぜなら、返されたメッセージのフィールドを直接更新できるからです。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>message_map</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span>
</span></span></code></pre></div><p>メッセージフィールドに値を割り当てなくても、サブメッセージはマップ内に作成されます：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>message_map</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>test_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>M2</span> <span style=color:#204a87>object</span> <span style=color:#000>at</span> <span style=color:#0000cf;font-weight:700>0x7fb022af28c0</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#204a87>dict</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>message_map</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>test_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>M2</span> <span style=color:#204a87>object</span> <span style=color:#000>at</span> <span style=color:#0000cf;font-weight:700>0x7fb022af28c0</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>これは通常の<a href=#embedded_message>埋め込みメッセージフィールド</a>とは<strong>異なり</strong>、メッセージ自体はフィールドのいずれかに値を割り当てるときにのみ作成されます。</p><p>コードを読む人にとって、たとえば<code>m.message_map[10]</code>だけでサブメッセージが作成される可能性が明らかでない場合、同じことを行う<code>get_or_create()</code>メソッドも提供していますが、その名前が可能なメッセージ作成をより明示的にします：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Equivalent to:</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   m.message_map[10]</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># but more explicit that the statement might be creating a new</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># empty message in the map.</span>
</span></span><span style=display:flex><span><span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>message_map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_or_create</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h2 id=enum>列挙型</h2><p>Pythonでは、列挙型は単なる整数です。列挙型の定義値に対応する整数定数のセットが定義されます。たとえば、次のように与えられた場合：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>SomeEnum</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>VALUE_A</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>VALUE_B</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>VALUE_C</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1234</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>SomeEnum</span> <span style=color:#000>bar</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>定数<code>VALUE_A</code>、<code>VALUE_B</code>、<code>VALUE_C</code>はそれぞれ値0、5、1234で定義されています。必要に応じて<code>SomeEnum</code>にアクセスできます。列挙型が外部スコープで定義されている場合、値はモジュール定数になります。メッセージ内で定義されている場合、それらはそのメッセージクラスの静的メンバになります。</p><p>たとえば、proto内の次の列挙型に対して、次の3つの方法で値にアクセスできます：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>SomeEnum</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>VALUE_A</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>VALUE_B</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>VALUE_C</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1234</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>value_a</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>myproto_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>SomeEnum</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>VALUE_A</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># or</span>
</span></span><span style=display:flex><span><span style=color:#000>myproto_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>VALUE_A</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># or</span>
</span></span><span style=display:flex><span><span style=color:#000>myproto_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>SomeEnum</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;VALUE_A&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>列挙型フィールドはスカラーフィールドと同様に機能します。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Foo</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bar</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>VALUE_A</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bar</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bar</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>Foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>VALUE_A</span>
</span></span></code></pre></div><p>列挙型の名前（または列挙値）がPythonのキーワードである場合、そのオブジェクト（または列挙値のプロパティ）は、<a href=#keyword-conflicts><em>Pythonのキーワードと競合する名前</em></a>セクションで説明されているように、<code>getattr()</code>を介してのみアクセスできます。</p><p>列挙型で設定できる値は、Protocol Buffersのバージョンによって異なります：</p><ul><li><strong>proto2</strong>では、列挙型には、列挙型のタイプで定義されていない数値を含めることはできません。列挙型に含まれていない値を割り当てると、生成されたコードは例外をスローします。</li><li><strong>proto3</strong>はオープンな列挙型セマンティクスを使用します：列挙型フィールドには任意の<code>int32</code>値を含めることができます。</li></ul><p>列挙型には、値からフィールド名を取得したり、その逆を行ったりするためのユーティリティメソッドがいくつかあります。これらは<a href=https://github.com/protocolbuffers/protobuf/blob/master/python/google/protobuf/internal/enum_type_wrapper.py><code>enum_type_wrapper.EnumTypeWrapper</code></a> で定義されています（生成された列挙型クラスの基本クラス）。たとえば、<code>myproto.proto</code> に次の独立した列挙型がある場合：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>SomeEnum</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>VALUE_A</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>VALUE_B</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>VALUE_C</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1234</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>&mldr;次のようにすることができます：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>assertEqual</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;VALUE_A&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>myproto_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>SomeEnum</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Name</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>myproto_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>VALUE_A</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>assertEqual</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>myproto_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>SomeEnum</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;VALUE_B&#39;</span><span style=color:#000;font-weight:700>))</span>
</span></span></code></pre></div><p>Foo内で宣言された列挙型の場合、構文は似ています：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>assertEqual</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;VALUE_A&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>myproto_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>SomeEnum</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Name</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>myproto_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>VALUE_A</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span><span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>assertEqual</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>myproto_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>SomeEnum</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Value</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;VALUE_B&#39;</span><span style=color:#000;font-weight:700>))</span>
</span></span></code></pre></div><p>複数の列挙定数が同じ値を持つ場合（エイリアス）、最初に定義された定数が返されます。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>SomeEnum</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>allow_alias</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>VALUE_A</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>VALUE_B</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>VALUE_C</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1234</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>VALUE_B_ALIAS</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>上記の例では、<code>myproto_pb2.SomeEnum.Name(5)</code> は <code>"VALUE_B"</code> を返します。</p><h2 id=oneof>Oneof</h2><p>oneofを持つメッセージがあるとします：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>oneof</span> <span style=color:#000>test_oneof</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>     <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>     <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>serial_number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p><code>Foo</code> に対応するPythonクラスには、通常の<a href=#fields>field</a>と同様に <code>name</code> と <code>serial_number</code> という名前のプロパティがあります。ただし、通常のフィールドとは異なり、oneof内のフィールドは1つだけ設定されることがあります。これはランタイムによって保証されています。たとえば：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>message</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Foo</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Bender&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>HasField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>serial_number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2716057</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>HasField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;serial_number&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#204a87;font-weight:700>not</span> <span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>HasField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>メッセージクラスには、<code>WhichOneof</code> メソッドもあり、oneof内で設定されたフィールド（あれば）を見つけることができます。このメソッドは、設定されているフィールドの名前を返し、何も設定されていない場合は <code>None</code> を返します：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>WhichOneof</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;test_oneof&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>is</span> <span style=color:#204a87;font-weight:700>None</span>
</span></span><span style=display:flex><span><span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Bender&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>WhichOneof</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;test_oneof&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;name&#34;</span>
</span></span></code></pre></div><p><code>HasField</code> と <code>ClearField</code> は、フィールド名に加えてoneof名も受け入れます：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#204a87;font-weight:700>not</span> <span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>HasField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;test_oneof&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Bender&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>HasField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;test_oneof&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>serial_number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2716057</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>HasField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;test_oneof&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ClearField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;test_oneof&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#204a87;font-weight:700>not</span> <span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>HasField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;test_oneof&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#204a87;font-weight:700>not</span> <span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>HasField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;serial_number&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>oneofに対して <code>ClearField</code> を呼び出すと、現在設定されているフィールドがクリアされることに注意してください。</p><h2 id=keyword-conflicts>Pythonのキーワードと競合する名前</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>Pythonのキーワードであるメッセージ、フィールド、列挙型、または列挙値の名前の場合、対応するクラスやプロパティの名前は同じになりますが、Pythonの通常の属性参照構文（つまり、ドット演算子）ではアクセスできず、Pythonの`getattr()`および`setattr()`組み込み関数を使用してのみアクセスできます。
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>たとえば、次の`.proto`定義がある場合：
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>```proto
</span></span><span style=display:flex><span>message Baz {
</span></span><span style=display:flex><span>  optional int32 from = 1
</span></span><span style=display:flex><span>  repeated int32 in = 2;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>これらのフィールドにアクセスするには、次のようにします：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>baz</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Baz</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#204a87>setattr</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>baz</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;from&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>99</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#204a87>getattr</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>baz</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;from&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>99</span>
</span></span><span style=display:flex><span><span style=color:#204a87>getattr</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>baz</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;in&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>append</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#204a87>getattr</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>baz</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;in&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>42</span><span style=color:#000;font-weight:700>]</span>
</span></span></code></pre></div><p>一方、これらのフィールドにアクセスするために<code>obj.attr</code>構文を使用しようとすると、Pythonはコードを解析する際に構文エラーを発生させます：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 間違い！</span>
</span></span><span style=display:flex><span><span style=color:#000>baz</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#204a87;font-weight:700>in</span>  <span style=color:#8f5902;font-style:italic># 構文エラー: 無効な構文</span>
</span></span><span style=display:flex><span><span style=color:#000>baz</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#204a87;font-weight:700>from</span>  <span style=color:#8f5902;font-style:italic># 構文エラー: 無効な構文</span>
</span></span></code></pre></div><h2 id=extension>拡張機能（proto2のみ）</h2><p>拡張範囲を持つメッセージがある場合：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>extensions</span> <span style=color:#0000cf;font-weight:700>100</span> <span style=color:#204a87;font-weight:700>to</span> <span style=color:#0000cf;font-weight:700>199</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p><code>Foo</code>に対応するPythonクラスには、<code>Extensions</code>というメンバーがあり、これは拡張識別子をその現在の値にマッピングする辞書です。</p><p>拡張定義がある場合：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>extend</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>bar</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>123</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>プロトコルバッファコンパイラは<code>bar</code>という「拡張識別子」を生成します。この識別子は<code>Extensions</code>辞書のキーとして機能します。この辞書で値を検索する結果は、同じ型の通常のフィールドにアクセスした場合とまったく同じです。したがって、上記の例では、次のようにできます：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Foo</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Extensions</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>proto_file_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bar</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>foo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Extensions</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>proto_file_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>bar</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>2</span>
</span></span></code></pre></div><p>拡張識別子定数を指定する必要があることに注意してください。これは、異なるスコープで同じ名前の複数の拡張機能が指定される可能性があるためです。</p><p>通常のフィールドと同様に、<code>Extensions[...]</code>は、単数メッセージの場合はメッセージオブジェクトを、繰り返しフィールドの場合はシーケンスを返します。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>[</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000>Message</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000;font-weight:700>](</span><span style=color:#000>https</span><span style=color:#000;font-weight:700>:</span><span style=color:#ce5c00;font-weight:700>//</span><span style=color:#000>googleapis</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>dev</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>python</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>latest</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>html</span><span style=color:#8f5902;font-style:italic>#google.protobuf.message.Message) インターフェースの `HasField()` および `ClearField()` メソッドは拡張機能とは動作しません。代わりに `HasExtension()` および `ClearExtension()` を使用する必要があります。`HasExtension()` および `ClearExtension()` メソッドを使用するには、存在を確認する拡張機能の `field_descriptor` を渡します。
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>## サービス {#service}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>proto</span><span style=color:#ce5c00;font-weight:700>`</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#a40000>ファイルに次の行が含まれている場合</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#ce5c00;font-weight:700>```</span><span style=color:#000>proto</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>option</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>py_generic_services</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>true</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>その場合、プロトコルバッファコンパイラは、このセクションで説明されているファイル内のサービス定義に基づいてコードを生成します。ただし、生成されるコードは特定の RPC システムに結びついていないため、1 つのシステムに適合したコードよりもさらに多くの間接レベルが必要となります。このコードを生成したくない場合は、次の行をファイルに追加してください:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>py_generic_services</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>上記のいずれの行も指定されていない場合、オプションは <code>false</code> にデフォルトで設定されます。汎用サービスは非推奨です。 (2.4.0 より前では、オプションは <code>true</code> にデフォルトで設定されていました)</p><p><code>.proto</code> 言語のサービス定義に基づく RPC システムは、システムに適したコードを生成するための<a href=/reference/cpp/api-docs/google.protobuf.compiler.plugin.pb>プラグイン</a>を提供する必要があります。これらのプラグインは、おそらく抽象サービスが無効になっていることを要求する可能性があります。これにより、同じ名前のクラスを生成できます。プラグインは 2.3.0 版 (2010 年 1 月) で新しくなりました。</p><p>このセクションの残りの部分では、抽象サービスが有効になっている場合にプロトコルバッファコンパイラが生成する内容について説明します。</p><h3 id=interface>インターフェース</h3><p>次のサービス定義が与えられた場合:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>service</span> <span style=color:#000>Foo</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>rpc</span> <span style=color:#000>Bar</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>FooRequest</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>returns</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>FooResponse</span><span style=color:#000;font-weight:700>);</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>プロトコルバッファコンパイラは、このサービスを表すクラス <code>Foo</code> を生成します。<code>Foo</code> には、サービス定義で定義された各メソッドに対応するメソッドがあります。この場合、メソッド <code>Bar</code> は次のように定義されています:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>Bar</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>rpc_controller</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>request</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>done</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>パラメータは、<a href=https://googleapis.dev/python/protobuf/latest/google/protobuf/service.html#google.protobuf.service.Service.CallMethod><code>Service.CallMethod()</code></a> のパラメータと同等ですが、<code>method_descriptor</code> 引数は暗黙的に含まれています。</p><p>これらの生成されたメソッドは、サブクラスでオーバーライドすることを意図しています。デフォルトの実装は単に、未実装であることを示すエラーメッセージを含む<a href=https://googleapis.dev/python/protobuf/latest/google/protobuf/service.html#google.protobuf.service.RpcController.SetFailed><code>controller.SetFailed()</code></a>を呼び出し、その後<code>done</code>コールバックを実行します。独自のサービスを実装する際には、この生成されたサービスをサブクラス化し、適切にメソッドを実装する必要があります。</p><p><code>Foo</code>は<code>Service</code>インターフェースをサブクラス化します。プロトコルバッファコンパイラは、<code>Service</code>のメソッドの実装を自動的に生成します。</p><ul><li><code>GetDescriptor</code>: サービスの<a href=https://googleapis.dev/python/protobuf/latest/google/protobuf/descriptor.html#google.protobuf.descriptor.ServiceDescriptor><code>ServiceDescriptor</code></a>を返します。</li><li><code>CallMethod</code>: 提供されたメソッド記述子に基づいて呼び出されているメソッドを決定し、直接呼び出します。</li><li><code>GetRequestClass</code>および<code>GetResponseClass</code>: 指定されたメソッドの正しいタイプのリクエストまたはレスポンスのクラスを返します。</li></ul><h3 id=stub>Stub</h3><p>プロトコルバッファコンパイラは、サービスインターフェースごとに「スタブ」実装も生成します。これは、サービスを実装するサーバーにリクエストを送信したいクライアントによって使用されます。<code>Foo</code>サービス（上記）の場合、スタブ実装<code>Foo_Stub</code>が定義されます。</p><p><code>Foo_Stub</code>は<code>Foo</code>のサブクラスです。そのコンストラクタは<a href=https://googleapis.dev/python/protobuf/latest/google/protobuf/service.html#google.protobuf.service.RpcChannel><code>RpcChannel</code></a>をパラメータとして受け取ります。その後、スタブは、各サービスのメソッドを、チャンネルの<code>CallMethod()</code>メソッドを呼び出すことで実装します。</p><p>Protocol BufferライブラリにはRPCの実装は含まれていません。ただし、任意のRPC実装に生成されたサービスクラスを接続するために必要なツールはすべて含まれています。<code>RpcChannel</code>および<a href=https://googleapis.dev/python/protobuf/latest/google/protobuf/service.html#google.protobuf.service.RpcController><code>RpcController</code></a>の実装を提供するだけです。</p><h2 id=plugins>プラグイン挿入ポイント</h2><p><a href=/reference/cpp/api-docs/google.protobuf.compiler.plugin>コードジェネレータプラグイン</a>
は、Pythonコードジェネレータの出力を拡張したい場合、次の種類のコードを挿入ポイント名を使用して挿入できます。</p><ul><li><code>imports</code>: インポート文。</li><li><code>module_scope</code>: トップレベルの宣言。</li></ul><div class="alert alert-warning" role=alert><h4 class=alert-heading>警告</h4>次のようなプライベートクラスメンバに依存するコードを生成しないでください。これらの実装の詳細は、Protocol Buffersの将来のバージョンで変更される可能性があります。</div><h2 id=sharing-messages>PythonとC++間でメッセージを共有する</h2><p>Protobuf Python APIの4.21.0バージョンより前では、Pythonアプリケーションはネイティブ拡張を使用してC++とメッセージを共有できました。4.21.0 APIバージョンからは、PythonとC++間でメッセージを共有することはデフォルトのインストールではサポートされていません。Protobuf Python APIの4.x以降のバージョンで作業する際に、環境変数<code>PROTOCOL_BUFFERS_PYTHON_IMPLEMENTATION=cpp</code>を定義し、Python/C++拡張がインストールされていることを確認して、この機能を有効にしてください。</p></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank rel=noopener href=https://stackoverflow.com/questions/tagged/protocol-buffers aria-label="Stack Overflow"><i class="fab fa-stack-overflow"></i></a></li></ul><script type=text/javascript id=cookiebanner src=https://cdn.jsdelivr.net/gh/dobarkod/cookie-banner@1.2.2/dist/cookiebanner.min.js data-height=50px data-message="Protobuf.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic." data-bg=#ffb data-fg=#000 data-position=bottom data-padding="10px 16px" data-close-text="OK, got it" data-font-size=18px data-moreinfo=https://policies.google.com/technologies/cookies></script></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/protocolbuffers/protobuf aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/g/protobuf aria-label="Developer mailing list"><i class="fa fa-envelope"></i></a></li></ul><script type=text/javascript id=cookiebanner src=https://cdn.jsdelivr.net/gh/dobarkod/cookie-banner@1.2.2/dist/cookiebanner.min.js data-height=50px data-message="Protobuf.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic." data-bg=#ffb data-fg=#000 data-position=bottom data-padding="10px 16px" data-close-text="OK, got it" data-font-size=18px data-moreinfo=https://policies.google.com/technologies/cookies></script></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2024 Google LLC All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank rel=noopener>プライバシーポリシー</a></small>
<span class=text-white>Hosted by GitHub Pages.</span> <a href=https://docs.github.com/en/site-policy/privacy-policies/github-privacy-statement target=_blank>GitHub Privacy Statement</a></div></div></div></footer></div><script src=/js/main.min.ba08a6b7f24e657f0a1b9b55be3a3162585168cd862ace0957f5b44e6cb6dc61.js integrity="sha256-ugimt/JOZX8KG5tVvjoxYlhRaM2GKs4JV/W0Tmy23GE=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>