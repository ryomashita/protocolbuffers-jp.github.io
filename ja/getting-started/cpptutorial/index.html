<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=ja class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.121.2"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>プロトコルバッファの基礎: C++ | Protocol Buffers Documentation</title>
<meta name=description content="プロトコルバッファを使用するための基本的なC++プログラマー向けの紹介。"><meta property="og:title" content="プロトコルバッファの基礎: C++"><meta property="og:description" content="プロトコルバッファを使用するための基本的なC++プログラマー向けの紹介。"><meta property="og:type" content="article"><meta property="og:url" content="https://protobuf.dev/ja/getting-started/cpptutorial/"><meta property="article:section" content="getting-started"><meta itemprop=name content="プロトコルバッファの基礎: C++"><meta itemprop=description content="プロトコルバッファを使用するための基本的なC++プログラマー向けの紹介。"><meta itemprop=wordCount content="1076"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="プロトコルバッファの基礎: C++"><meta name=twitter:description content="プロトコルバッファを使用するための基本的なC++プログラマー向けの紹介。"><link rel=preload href=/scss/main.min.6a57e8f3f347dea5d31cb48e3b4ea9fdae32d499473089bdef9b45457b5debb8.css as=style><link href=/scss/main.min.6a57e8f3f347dea5d31cb48e3b4ea9fdae32d499473089bdef9b45457b5debb8.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-5L8P8GRN4Y"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5L8P8GRN4Y")}</script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/ja/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Protocol Buffers Documentation</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>日本語</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/getting-started/cpptutorial/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder=サイトを検索... aria-label=サイトを検索... autocomplete=off></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder=サイトを検索... aria-label=サイトを検索... autocomplete=off></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>日本語</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/getting-started/cpptutorial/>English</a></div></div><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-ja-li><a href=/ja/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-ja><span>Protocol Buffers</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jaoverview-li><a href=/ja/overview/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jaoverview><span>概要</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-janews-li><a href=/ja/news/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-janews><span>ニュース</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janews2022-05-06-li><a href=/ja/news/2022-05-06/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janews2022-05-06><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janews2023-07-06-li><a href=/ja/news/2023-07-06/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janews2023-07-06><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janews2023-08-09-li><a href=/ja/news/2023-08-09/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janews2023-08-09><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janews2023-08-15-li><a href=/ja/news/2023-08-15/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janews2023-08-15><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janews2023-09-15-li><a href=/ja/news/2023-09-15/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janews2023-09-15><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janews2023-12-27-li><a href=/ja/news/2023-12-27/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janews2023-12-27><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janews2024-06-26-li><a href=/ja/news/2024-06-26/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janews2024-06-26><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-japrogramming-guides-li><a href=/ja/programming-guides/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-japrogramming-guides><span>プログラミングガイド</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesproto2-li><a href=/ja/programming-guides/proto2/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesproto2><span>言語ガイド（proto 2）</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesproto3-li><a href=/ja/programming-guides/proto3/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesproto3><span>言語ガイド（proto 3）</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesstyle-li><a href=/ja/programming-guides/style/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesstyle><span>スタイルガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesaddons-li><a href=/ja/programming-guides/addons/ title=サードパーティーアドオン class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesaddons><span>アドオン</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesapi-li><a href=/ja/programming-guides/api/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesapi><span>API ベストプラクティス</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesdos-donts-li><a href=/ja/programming-guides/dos-donts/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesdos-donts><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesencoding-li><a href=/ja/programming-guides/encoding/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesencoding><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesenum-li><a href=/ja/programming-guides/enum/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesenum><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesextension_declarations-li><a href=/ja/programming-guides/extension_declarations/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesextension_declarations><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesfield_presence-li><a href=/ja/programming-guides/field_presence/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesfield_presence><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidesserialization-not-canonical-li><a href=/ja/programming-guides/serialization-not-canonical/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidesserialization-not-canonical><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japrogramming-guidestechniques-li><a href=/ja/programming-guides/techniques/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-japrogramming-guidestechniques><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jaeditions-li><a href=/ja/editions/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jaeditions><span>Protobuf Editions</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jaeditionsoverview-li><a href=/ja/editions/overview/ title="Protobuf Editions の概要" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jaeditionsoverview><span>概要</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jaeditionsfeatures-li><a href=/ja/editions/features/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jaeditionsfeatures><span>エディション向けの機能設定</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jaeditionsimplementation-li><a href=/ja/editions/implementation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jaeditionsimplementation><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-jagetting-started-li><a href=/ja/getting-started/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jagetting-started><span>チュートリアル</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-jagetting-startedcpptutorial-li><a href=/ja/getting-started/cpptutorial/ title="プロトコルバッファの基礎: C++" class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-jagetting-startedcpptutorial><span class=td-sidebar-nav-active-item>C++</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jagetting-startedcsharptutorial-li><a href=/ja/getting-started/csharptutorial/ title="Protocol Buffer Basics: C#" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jagetting-startedcsharptutorial><span>C#</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jagetting-starteddarttutorial-li><a href=/ja/getting-started/darttutorial/ title="Protocol Buffer Basics: Dart" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jagetting-starteddarttutorial><span>Dart</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jagetting-startedgotutorial-li><a href=/ja/getting-started/gotutorial/ title="プロトコルバッファの基本: Go" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jagetting-startedgotutorial><span>Go</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jagetting-startedjavatutorial-li><a href=/ja/getting-started/javatutorial/ title="プロトコルバッファの基礎: Java" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jagetting-startedjavatutorial><span>Java</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jagetting-startedkotlintutorial-li><a href=/ja/getting-started/kotlintutorial/ title="Protocol Buffer Basics: Kotlin" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jagetting-startedkotlintutorial><span>Kotlin</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jagetting-startedpythontutorial-li><a href=/ja/getting-started/pythontutorial/ title="プロトコルバッファの基礎: Python" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jagetting-startedpythontutorial><span>Python</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareference-li><a href=/ja/reference/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareference><span>リファレンスガイド</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferencecpp-li><a href=/ja/reference/cpp/ title="C++ リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencecpp><span>C++</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppcpp-generated-li><a href=/ja/reference/cpp/cpp-generated/ title="C++ 生成コードガイド" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppcpp-generated><span>生成コードガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecpparenas-li><a href=/ja/reference/cpp/arenas/ title="C++ アリーナ割り当てガイド" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecpparenas><span>アリーナ割り当てガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docs-link-li><a href=/reference/cpp/api-docs/ target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docs-link><span>C++ API</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilercpp_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.cpp_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilercpp_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilercsharp_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.csharp_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilercsharp_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilercsharp_names-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.csharp_names/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilercsharp_names><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerjava_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.java_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerjava_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerjava_names-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.java_names/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerjava_names><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerjavanano_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.javanano_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerjavanano_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerjs_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.js_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerjs_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerobjectivec_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.objectivec_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerobjectivec_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerparser-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.parser/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerparser><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerplugin-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.plugin/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerplugin><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerpluginpb-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.plugin.pb/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerpluginpb><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerpython_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.python_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerpython_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufcompilerruby_generator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.compiler.ruby_generator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufcompilerruby_generator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufdescriptorpb-li><a href=/ja/reference/cpp/api-docs/google.protobuf.descriptor.pb/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufdescriptorpb><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufdynamic_message-li><a href=/ja/reference/cpp/api-docs/google.protobuf.dynamic_message/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufdynamic_message><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufutilfield_comparator-li><a href=/ja/reference/cpp/api-docs/google.protobuf.util.field_comparator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufutilfield_comparator><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufutiljson_util-li><a href=/ja/reference/cpp/api-docs/google.protobuf.util.json_util/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufutiljson_util><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufutiltype_resolver-li><a href=/ja/reference/cpp/api-docs/google.protobuf.util.type_resolver/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufutiltype_resolver><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecppapi-docsgoogleprotobufutiltype_resolver_util-li><a href=/ja/reference/cpp/api-docs/google.protobuf.util.type_resolver_util/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecppapi-docsgoogleprotobufutiltype_resolver_util><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferencecsharp-li><a href=/ja/reference/csharp/ title="C# リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencecsharp><span>C#</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecsharpcsharp-generated-li><a href=/ja/reference/csharp/csharp-generated/ title="C# 生成コードガイド" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecsharpcsharp-generated><span>生成コードガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencecsharpapi-docs-link-li><a href=/reference/csharp/api-docs target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencecsharpapi-docs-link><span>C# API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferencedart-li><a href=/ja/reference/dart/ title="Dart リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencedart><span>Dart</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencedartdart-generated-li><a href=/ja/reference/dart/dart-generated/ title="Dart Generated Code" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencedartdart-generated><span>生成されたコード</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencedartapi-docs-link-li><a href=https://pub.dartlang.org/documentation/protobuf target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencedartapi-docs-link><span>Dart API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferencego-li><a href=/ja/reference/go/ title=Goリファレンス class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencego><span>Go</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencegogo-generated-li><a href=/ja/reference/go/go-generated/ title="Go Generated Code Guide" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencegogo-generated><span>生成されたコードガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencegoapi-docs-link-li><a href=https://pkg.go.dev/google.golang.org/protobuf/proto target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencegoapi-docs-link><span>Go API</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencegofaq-li><a href=/ja/reference/go/faq/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencegofaq><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencegosize-li><a href=/ja/reference/go/size/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencegosize><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferencejava-li><a href=/ja/reference/java/ title="Java リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencejava><span>Java</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencejavajava-generated-li><a href=/ja/reference/java/java-generated/ title=Java生成コードガイド class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencejavajava-generated><span>生成コードガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencejavajava-proto-names-li><a href=/ja/reference/java/java-proto-names/ title="Java Proto Names" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencejavajava-proto-names><span>生成されたProto名</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencejavaapi-docs-link-li><a href=/reference/java/api-docs/overview-summary.html target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencejavaapi-docs-link><span>Java API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferencekotlin-li><a href=/ja/reference/kotlin/ title="Kotlin リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencekotlin><span>Kotlin</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencekotlinapi-docs-li><a href=/ja/reference/kotlin/api-docs/ title="Kotlin リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencekotlinapi-docs><span>Kotlin</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencekotlinkotlin-generated-li><a href=/ja/reference/kotlin/kotlin-generated/ title="Kotlin 生成コードガイド" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencekotlinkotlin-generated><span>生成コードガイド</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferenceobjective-c-li><a href=/ja/reference/objective-c/ title="Objective-C リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferenceobjective-c><span>Objective-C</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferenceobjective-cobjective-c-generated-li><a href=/ja/reference/objective-c/objective-c-generated/ title="Objective-C 生成コードガイド" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferenceobjective-cobjective-c-generated><span>生成コードガイド</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferencephp-li><a href=/ja/reference/php/ title="PHP リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencephp><span>PHP</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencephpphp-generated-li><a href=/ja/reference/php/php-generated/ title="PHP 生成コードガイド" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencephpphp-generated><span>生成コードガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencephpapi-docs-link-li><a href=/reference/php/api-docs/ target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencephpapi-docs-link><span>PHP API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferencepython-li><a href=/ja/reference/python/ title="Python リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferencepython><span>Python</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencepythonpython-generated-li><a href=/ja/reference/python/python-generated/ title="Python 生成コードガイド" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencepythonpython-generated><span>生成コードガイド</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencepythonapi-docs-link-li><a href=https://googleapis.dev/python/protobuf/latest/ target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencepythonapi-docs-link><span>Python API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferenceruby-li><a href=/ja/reference/ruby/ title="Ruby リファレンス" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferenceruby><span>Ruby</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferencerubyruby-generated-li><a href=/ja/reference/ruby/ruby-generated/ title="Ruby Generated Code Guide" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferencerubyruby-generated><span>生成されたコードガイド</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jareferenceprotobuf-li><a href=/ja/reference/protobuf/ title=プロトコルバッファリファレンス class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jareferenceprotobuf><span>プロトコルバッファ</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferenceprotobufedition-2023-spec-li><a href=/ja/reference/protobuf/edition-2023-spec/ title="Protocol Buffers Edition 2023 言語仕様" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferenceprotobufedition-2023-spec><span>2023 言語仕様</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferenceprotobufproto2-spec-li><a href=/ja/reference/protobuf/proto2-spec/ title="Protocol Buffers Version 2 言語仕様" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferenceprotobufproto2-spec><span>Version 2 言語仕様</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferenceprotobufproto3-spec-li><a href=/ja/reference/protobuf/proto3-spec/ title="Protocol Buffers Version 3 言語仕様" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferenceprotobufproto3-spec><span>Version 3 言語仕様</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferenceprotobuftextformat-spec-li><a href=/ja/reference/protobuf/textformat-spec/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferenceprotobuftextformat-spec><span>テキスト形式言語仕様</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferenceprotobufgoogleprotobuf-li><a href=/ja/reference/protobuf/google.protobuf/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferenceprotobufgoogleprotobuf><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jareferenceother-li><a href=/ja/reference/other/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jareferenceother><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-jasupport-li><a href=/ja/support/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-jasupport><span>サポート</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jasupportversion-support-li><a href=/ja/support/version-support/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jasupportversion-support><span>バージョンサポート</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jasupportcross-version-runtime-guarantee-li><a href=/ja/support/cross-version-runtime-guarantee/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jasupportcross-version-runtime-guarantee><span>クロスバージョンランタイム保証</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jasupportmigration-li><a href=/ja/support/migration/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jasupportmigration><span></span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jaforum-link-li><a href=https://groups.google.com/g/protobuf target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jaforum-link><span>フォーラム</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jadownloads-li><a href=/ja/downloads/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jadownloads><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jahistory-li><a href=/ja/history/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jahistory><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-janavbar-li><a href=/ja/navbar/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-janavbar><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-jasearch-li><a href=/ja/search/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-jasearch><span>検索結果</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/protocolbuffers/protocolbuffers.github.io/tree/main/content/getting-started/cpptutorial.ja.md class=td-page-meta--view target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/protocolbuffers/protocolbuffers.github.io/edit/main/content/getting-started/cpptutorial.ja.md class=td-page-meta--edit target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> ページの編集</a>
<a href="https://github.com/protocolbuffers/protocolbuffers.github.io/new/main/content/getting-started/cpptutorial.ja.md?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class=td-page-meta--child target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> 子ページを作成</a>
<a href="https://github.com/protocolbuffers/protocolbuffers.github.io/issues/new?title=%e3%83%97%e3%83%ad%e3%83%88%e3%82%b3%e3%83%ab%e3%83%90%e3%83%83%e3%83%95%e3%82%a1%e3%81%ae%e5%9f%ba%e7%a4%8e:%20C++" class=td-page-meta--issue target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> ドキュメントのissueを作成</a>
<a href=https://github.com/protocolbuffers/protobuf/issues/new class=td-page-meta--project-issue target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> プロジェクトのissueを作成</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#problem-domain>問題領域</a></li><li><a href=#example-code>例コードの場所</a></li><li><a href=#protocol-format>プロトコル形式の定義</a></li><li><a href=#compiling-protocol-buffers>Protocol Buffers のコンパイル</a></li><li><a href=#protobuf-api>Protocol Buffer API</a><ul><li><a href=#enums-nested-classes>列挙型とネストクラス</a></li><li><a href=#standard-message-methods>標準メッセージメソッド</a></li><li><a href=#parsing-serialization>パースとシリアライゼーション</a></li></ul></li><li><a href=#writing-a-message>メッセージの書き込み</a></li><li><a href=#reading-a-message>メッセージの読み取り</a></li><li><a href=#extending-a-protobuf>プロトコルバッファの拡張</a></li><li><a href=#optimization>最適化のヒント</a></li><li><a href=#advanced-usage>高度な使用法</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=https://protobuf.dev/ja/getting-started/>チュートリアル</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://protobuf.dev/ja/getting-started/cpptutorial/ aria-disabled=true class="btn-link disabled">C++</a></li></ol></nav><div class=td-content><h1>プロトコルバッファの基礎: C++</h1><div class=lead>プロトコルバッファを使用するための基本的なC++プログラマー向けの紹介。</div><header class=article-meta></header><p>このチュートリアルでは、プロトコルバッファを使用するための基本的なC++プログラマー向けの紹介を提供します。単純な例のアプリケーションを作成することで、次の方法を示します。</p><ul><li><code>.proto</code>ファイルでメッセージ形式を定義する。</li><li>プロトコルバッファコンパイラを使用する。</li><li>C++プロトコルバッファAPIを使用してメッセージを書き込み、読み取る。</li></ul><p>これはC++でプロトコルバッファを使用する包括的なガイドではありません。詳細な参照情報については、<a href=/programming-guides/proto2>Protocol Buffer Language Guide (proto2)</a>、<a href=/programming-guides/proto3>Protocol Buffer Language Guide (proto3)</a>、<a href=/reference/cpp/api-docs>C++ API Reference</a>、<a href=/reference/cpp/cpp-generated>C++ Generated Code Guide</a>、および<a href=/programming-guides/encoding>Encoding Reference</a>を参照してください。</p><h2 id=problem-domain>問題領域</h2><p>使用する例は非常にシンプルな「アドレス帳」アプリケーションです。このアプリケーションは、人々の連絡先詳細をファイルから読み取り、書き込むことができます。アドレス帳の各人物には、名前、ID、メールアドレス、連絡先電話番号があります。</p><p>このような構造化データをシリアライズおよび取得する方法はどうすればよいでしょうか？この問題を解決するためのいくつかの方法があります。</p><ul><li>生のインメモリデータ構造をバイナリ形式で送信/保存できます。時間の経過とともに、これは受信/読み取りコードがまったく同じメモリレイアウト、エンディアンなどでコンパイルされている必要があるため、脆弱なアプローチです。また、生の形式でファイルがデータを蓄積し、その形式に適したソフトウェアのコピーが広まると、形式を拡張するのが非常に難しくなります。</li><li>データ項目を単一の文字列にエンコードするための特別な方法を考案することができます。たとえば、4つの整数を「12:3:-23:67」としてエンコードするなどです。これはシンプルで柔軟なアプローチですが、ワンオフのエンコーディングおよびパーシングコードの記述が必要であり、パーシングにはわずかなランタイムコストがかかります。これは非常に単純なデータをエンコードする場合に最適です。</li><li>データをXMLにシリアライズします。このアプローチは非常に魅力的かもしれません。XMLは（ある程度）人間が読める形式であり、多くの言語にバインディングライブラリが存在します。これは他のアプリケーション/プロジェクトとデータを共有したい場合に適しています。ただし、XMLはスペースを多く必要とし、エンコード/デコードにはアプリケーションに大きなパフォーマンスペナルティを課す可能性があります。また、XML DOMツリーをナビゲートすることは、通常のクラスの単純なフィールドをナビゲートするよりもかなり複雑です。</li></ul><p>代わりにこれらのオプションを使用する代わりに、プロトコルバッファを使用できます。プロトコルバッファは、この問題を正確に解決する柔軟で効率的な自動化されたソリューションです。プロトコルバッファを使用すると、保存したいデータ構造の<code>.proto</code>記述を作成します。その後、プロトコルバッファコンパイラが、プロトコルバッファデータの自動エンコーディングとパーシングを効率的なバイナリ形式で実装するクラスを作成します。生成されたクラスは、プロトコルバッファを構成するフィールドのためのゲッターとセッターを提供し、プロトコルバッファを単位として読み書きの詳細を処理します。重要なのは、プロトコルバッファ形式が、コードが古い形式でエンコードされたデータをまだ読み取れるように、時間の経過とともに形式を拡張する考え方をサポートしていることです。</p><h2 id=example-code>例コードの場所</h2><p>例コードは、ソースコードパッケージに含まれており、<a href=https://github.com/protocolbuffers/protobuf/tree/main/examples>&ldquo;examples"ディレクトリ</a>の下にあります。</p><h2 id=protocol-format>プロトコル形式の定義</h2><p>アドレス帳アプリケーションを作成するには、<code>.proto</code>ファイルから始める必要があります。<code>.proto</code>ファイルの定義は簡単です。シリアライズしたいデータ構造ごとに<em>メッセージ</em>を追加し、メッセージ内の各フィールドに名前とタイプを指定します。以下は、メッセージ<code>addressbook.proto</code>を定義する<code>.proto</code>ファイルです。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#000>syntax</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;proto2&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>tutorial</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Person</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>id</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>email</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>PhoneType</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>PHONE_TYPE_UNSPECIFIED</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>PHONE_TYPE_MOBILE</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>PHONE_TYPE_HOME</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>PHONE_TYPE_WORK</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>PhoneNumber</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>PhoneType</span> <span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>default</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>PHONE_TYPE_HOME</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>PhoneNumber</span> <span style=color:#000>phones</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>AddressBook</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>Person</span> <span style=color:#000>people</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>C++やJavaに似た構文が見られます。ファイルの各部分を見て、それぞれが何をするか見ていきましょう。</p><p><code>.proto</code>ファイルはパッケージ宣言で始まり、異なるプロジェクト間での名前の競合を防ぐのに役立ちます。C++では、生成されたクラスはパッケージ名に一致する名前空間に配置されます。</p><p>次に、メッセージの定義があります。メッセージは、型付きフィールドのセットを含む集約です。<code>bool</code>、<code>int32</code>、<code>float</code>、<code>double</code>、<code>string</code>など、多くの標準的な単純データ型がフィールドタイプとして利用可能です。他のメッセージタイプをフィールドタイプとして使用することで、メッセージにさらなる構造を追加することもできます。上記の例では、<code>Person</code>メッセージに<code>PhoneNumber</code>メッセージが含まれ、<code>AddressBook</code>メッセージに<code>Person</code>メッセージが含まれています。他のメッセージ内にネストされたメッセージタイプを定義することもできます。<code>PhoneNumber</code>タイプが<code>Person</code>内で定義されていることがわかります。また、フィールドの一つに事前定義された値リストの中から1つを持つようにしたい場合は、<code>enum</code>タイプを定義できます。ここでは、電話番号が次の電話タイプのいずれかであることを指定したいとします：<code>PHONE_TYPE_MOBILE</code>、<code>PHONE_TYPE_HOME</code>、または<code>PHONE_TYPE_WORK</code>。</p><p>各要素の " = 1&rdquo;、" = 2" マーカーは、バイナリエンコーディングで使用されるフィールドの一意の番号を識別します。フィールド番号 1-15 は、より高い番号よりも1バイト少なくエンコードする必要があるため、よく使用されるまたは繰り返される要素にこれらの番号を使用することを最適化として選択できます。それに対し、フィールド番号 16 以上は、あまり一般的に使用されないオプションの要素に残します。繰り返しフィールド内の各要素は、フィールド番号を再エンコードする必要があるため、繰り返しフィールドはこの最適化の特に適した候補です。</p><p>各フィールドは、次の修飾子のいずれかで注釈付けする必要があります:</p><ul><li><code>optional</code>: フィールドは設定されていてもされていなくてもかまいません。オプションのフィールド値が設定されていない場合、デフォルト値が使用されます。単純な型の場合、例として電話番号の <code>type</code> で行ったように、独自のデフォルト値を指定できます。それ以外の場合、システムのデフォルト値が使用されます: 数値型の場合はゼロ、文字列の場合は空の文字列、bool 型の場合は false です。埋め込みメッセージの場合、デフォルト値は常にメッセージの &ldquo;デフォルトインスタンス&rdquo; または &ldquo;プロトタイプ&rdquo; であり、そのフィールドは設定されていません。明示的に設定されていないオプション (または必須) フィールドの値を取得するためにアクセサを呼び出すと、常にそのフィールドのデフォルト値が返されます。</li><li><code>repeated</code>: フィールドは任意の回数 (0 を含む) 繰り返すことができます。繰り返し値の順序はプロトコルバッファ内で保持されます。繰り返しフィールドは動的サイズの配列と考えてください。</li><li><code>required</code>: フィールドに値を指定する必要があります。そうでない場合、メッセージは &ldquo;未初期化&rdquo; と見なされます。<code>libprotobuf</code> がデバッグモードでコンパイルされている場合、未初期化のメッセージをシリアライズすると、アサーションの失敗が発生します。最適化されたビルドでは、チェックがスキップされ、メッセージは書き込まれます。ただし、未初期化のメッセージを解析すると常に失敗します (パースメソッドから <code>false</code> が返されます)。それ以外の点では、必須フィールドはオプションフィールドとまったく同じように動作します。</li></ul><div class="alert alert-warning" role=alert><h4 class=alert-heading>重要</h4><strong>Required Is Forever</strong>
<code>required</code> フィールドをマークする際には非常に注意する必要があります。ある時点で必須フィールドの書き込みや送信を停止したい場合、そのフィールドをオプションフィールドに変更することは問題が発生する可能性があります &ndash; 古いリーダーは、このフィールドがないメッセージを不完全と見なし、それらを誤って拒否または破棄するかもしれません。代わりに、バッファに対してアプリケーション固有のカスタムバリデーションルーチンを記述することを検討すべきです。Google内では、<code>required</code> フィールドは強く非推奨です。proto2 構文で定義されたほとんどのメッセージは、<code>optional</code> と <code>repeated</code> のみを使用します。(Proto3 では <code>required</code> フィールドはサポートされていません。)</div><p><code>.proto</code> ファイルを書くための完全なガイドがここにあります &ndash; すべての可能なフィールドタイプを含む &ndash;
<a href=/programming-guides/proto2>Protocol Buffer Language Guide</a> で確認できます。
ただし、クラスの継承に類似した機能を探す必要はありません &ndash; プロトコルバッファはそのような機能を提供していません。</p><h2 id=compiling-protocol-buffers>Protocol Buffers のコンパイル</h2><p><code>.proto</code> ファイルを持っているのであれば、次に行うべきことは、<code>AddressBook</code> (そして <code>Person</code> および <code>PhoneNumber</code> メッセージを読み書きするために必要なクラスを生成することです。これを行うには、<code>.proto</code> ファイルに対してプロトコルバッファコンパイラ <code>protoc</code> を実行する必要があります:</p><ol><li><p>コンパイラをインストールしていない場合は、
<a href=/downloads>パッケージをダウンロード</a> して、
README の手順に従ってください。</p></li><li><p>今、コンパイラを実行し、ソースディレクトリ (アプリケーションのソースコードが存在する場所 &ndash; 値を指定しない場合は現在のディレクトリが使用されます)、生成されたコードを配置する宛先ディレクトリ (<code>$SRC_DIR</code> と同じ場所がよく使用されます)、および <code>.proto</code> ファイルへのパスを指定します。この場合、以下のように&mldr;:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>protoc -I<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$SRC_DIR</span> --cpp_out<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$DST_DIR</span> <span style=color:#000>$SRC_DIR</span>/addressbook.proto
</span></span></code></pre></div><p>C++ クラスを生成したい場合は、<code>--cpp_out</code> オプションを使用します &ndash; 他のサポートされている言語に対しても同様のオプションが提供されています。</p></li></ol><p>これにより、指定した宛先ディレクトリに次のファイルが生成されます:</p><ul><li><code>addressbook.pb.h</code>、生成されたクラスを宣言するヘッダー。</li><li><code>addressbook.pb.cc</code>、クラスの実装を含むファイル。</li></ul><h2 id=protobuf-api>Protocol Buffer API</h2><p>生成されたコードの一部を見て、コンパイラが作成したクラスや関数を確認しましょう。<code>addressbook.pb.h</code> を見ると、<code>addressbook.proto</code> で指定した各メッセージに対してクラスが生成されていることがわかります。<code>Person</code> クラスを詳しく見ると、コンパイラが各フィールドに対してアクセサを生成していることがわかります。たとえば、<code>name</code>、<code>id</code>、<code>email</code>、<code>phones</code> フィールドについて、次のようなメソッドがあります:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// name
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>bool</span> <span style=color:#000>has_name</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>const</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>clear_name</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>const</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>string</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>name</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>const</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>set_name</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>string</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>value</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>set_name</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>char</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>value</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>string</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>mutable_name</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// id
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>bool</span> <span style=color:#000>has_id</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>const</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>clear_id</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>int32_t</span> <span style=color:#000>id</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>const</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>set_id</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int32_t</span> <span style=color:#000>value</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// email
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>bool</span> <span style=color:#000>has_email</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>const</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>clear_email</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>const</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>string</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>email</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>const</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>set_email</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>string</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>value</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>set_email</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>char</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>value</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>string</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>mutable_email</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// phones
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>phones_size</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>const</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>clear_phones</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>const</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>RepeatedPtrField</span><span style=color:#ce5c00;font-weight:700>&lt;</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person_PhoneNumber</span> <span style=color:#ce5c00;font-weight:700>&gt;&amp;</span> <span style=color:#000>phones</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>const</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>RepeatedPtrField</span><span style=color:#ce5c00;font-weight:700>&lt;</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person_PhoneNumber</span> <span style=color:#ce5c00;font-weight:700>&gt;*</span> <span style=color:#000>mutable_phones</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>const</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person_PhoneNumber</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>phones</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>index</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>const</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person_PhoneNumber</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>mutable_phones</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>index</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person_PhoneNumber</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>add_phones</span><span style=color:#000;font-weight:700>();</span>
</span></span></code></pre></div><p>ゲッターはフィールド名とまったく同じ名前で、小文字で表記されており、セッターメソッドは <code>set_</code> で始まります。また、各単数形 (必須またはオプション) フィールドに対して <code>has_</code> メソッドがあり、そのフィールドが設定されている場合に true を返します。最後に、各フィールドには <code>clear_</code> メソッドがあり、フィールドを空の状態に戻します。</p><p>数値の <code>id</code> フィールドは、上記で説明した基本アクセサ設定のみを持っていますが、
<code>name</code> と <code>email</code> フィールドは文字列なので、いくつかの追加メソッドがあります &ndash; 直接文字列へのポインタを取得できる <code>mutable_</code> ゲッターと追加のセッターがあります。<code>email</code> がすでに設定されていなくても <code>mutable_email()</code> を呼び出すことができることに注意してください。自動的に空の文字列に初期化されます。この例で繰り返しメッセージフィールドがある場合、<code>mutable_</code> メソッドはあるが <code>set_</code> メソッドはないことにも注意してください。</p><p>繰り返しフィールドにはいくつかの特別なメソッドもあります &ndash; 繰り返しの <code>phones</code> フィールドのメソッドを見ると、次のようなことができます。</p><ul><li>繰り返しフィールドの <code>_size</code>（つまり、この <code>Person</code> に関連付けられている電話番号の数）を確認できます。</li><li>インデックスを使用して指定された電話番号を取得できます。</li><li>指定されたインデックスの既存の電話番号を更新できます。</li><li>メッセージに別の電話番号を追加し、その後編集できます（繰り返しスカラータイプには新しい値を渡すだけの <code>add_</code> があります）。</li></ul><p>特定のフィールド定義に対してプロトコルコンパイラが生成するメンバについての詳細情報については、
<a href=/reference/cpp/cpp-generated>C++ 生成コードリファレンス</a> を参照してください。</p><h3 id=enums-nested-classes>列挙型とネストクラス</h3><p>生成されたコードには、<code>.proto</code> 列挙型に対応する <code>PhoneType</code> 列挙型が含まれています。この型は <code>Person::PhoneType</code> として参照し、その値は <code>Person::PHONE_TYPE_MOBILE</code>、<code>Person::PHONE_TYPE_HOME</code>、<code>Person::PHONE_TYPE_WORK</code> として参照できます（実装の詳細は少し複雑ですが、列挙型を使用するためにそれらを理解する必要はありません）。</p><p>コンパイラは、<code>Person::PhoneNumber</code> というネストクラスも生成しました。コードを見ると、「実際の」クラスは実際には <code>Person_PhoneNumber</code> と呼ばれていますが、<code>Person</code> 内で定義された typedef により、ネストされたクラスのように扱うことができます。これが違いを生じる唯一のケースは、別のファイルでクラスを前方宣言したい場合です &ndash; C++ ではネスト型を前方宣言することはできませんが、<code>Person_PhoneNumber</code> を前方宣言することはできます。</p><h3 id=standard-message-methods>標準メッセージメソッド</h3><p>各メッセージクラスには、次のような他のメソッドも含まれています。これらのメソッドを使用すると、メッセージ全体をチェックしたり操作したりできます。</p><ul><li><code>bool IsInitialized() const;</code>: 必要なすべてのフィールドが設定されているかどうかをチェックします。</li><li><code>string DebugString() const;</code>: メッセージの人間が読める表現を返します。デバッグに特に役立ちます。</li><li><code>void CopyFrom(const Person& from);</code>: 指定されたメッセージの値でメッセージを上書きします。</li><li><code>void Clear();</code>: すべての要素を空の状態にクリアします。</li></ul><p>これらと次のセクションで説明されているI/Oメソッドは、すべてのC++プロトコルバッファクラスで共有される<code>Message</code>インターフェースを実装しています。詳細については、<a href=/reference/cpp/api-docs/google.protobuf.message#Message> <code>Message</code>の完全なAPIドキュメント</a>を参照してください。</p><h3 id=parsing-serialization>パースとシリアライゼーション</h3><p>最後に、各プロトコルバッファクラスには、プロトコルバッファの<a href=/programming-guides/encoding>バイナリ形式</a>を使用して、選択したタイプのメッセージを書き込み、読み取るためのメソッドがあります。これには次のものが含まれます。</p><ul><li><code>bool SerializeToString(string* output) const;</code>: メッセージをシリアライズして、バイトを指定された文字列に格納します。バイトはバイナリであり、テキストではありません。<code>string</code>クラスは便利なコンテナとしてのみ使用されます。</li><li><code>bool ParseFromString(const string& data);</code>: 指定された文字列からメッセージをパースします。</li><li><code>bool SerializeToOstream(ostream* output) const;</code>: メッセージを指定されたC++ <code>ostream</code>に書き込みます。</li><li><code>bool ParseFromIstream(istream* input);</code>: 指定されたC++ <code>istream</code>からメッセージをパースします。</li></ul><p>これらは、パースとシリアライゼーションのために提供されているオプションの一部です。詳細については、<a href=/reference/cpp/api-docs/google.protobuf.message#Message> <code>Message</code> APIリファレンス</a>を参照してください。</p><div class="alert alert-warning" role=alert><h4 class=alert-heading>重要</h4><strong>プロトコルバッファとオブジェクト指向設計</strong>
プロトコルバッファクラスは基本的にデータホルダー（C言語の構造体のようなもの）であり、追加の機能を提供しません。オブジェクトモデルでは一級市民として適していません。生成されたクラスにより豊かな動作を追加したい場合、最良の方法は、生成されたプロトコルバッファクラスをアプリケーション固有のクラスでラップすることです。プロトコルバッファをラップすることは、<code>.proto</code>ファイルの設計を制御できない場合（別のプロジェクトから再利用している場合など）にも良いアイデアです。その場合、ラッパークラスを使用して、アプリケーションの環境に適したインターフェースを作成できます。データやメソッドを非表示にし、便利な機能を公開するなどです。<strong>生成されたクラスに動作を追加してはいけません</strong>。これは内部メカニズムを壊し、オブジェクト指向の実践としてもよくありません。</div><h2 id=writing-a-message>メッセージの書き込み</h2><p>さて、プロトコルバッファクラスを使用してみましょう。アドレス帳アプリケーションができるようにしたい最初のことは、個人の詳細をアドレス帳ファイルに書き込むことです。これを行うには、プロトコルバッファクラスのインスタンスを作成し、値を設定してから、それらを出力ストリームに書き込む必要があります。</p><p>以下は、ファイルから<code>AddressBook</code>を読み取り、ユーザーの入力に基づいて新しい<code>Person</code>を1つ追加し、新しい<code>AddressBook</code>を再度ファイルに書き込むプログラムです。プロトコルコンパイラによって生成されたコードを直接呼び出す部分が強調表示されています。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;iostream&gt;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;fstream&gt;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;string&gt;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&#34;addressbook.pb.h&#34;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#204a87;font-weight:700>namespace</span> <span style=color:#000>std</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// This function fills in a Person message based on user input.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>PromptForAddress</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>person</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Enter person ID number: &#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>id</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>cin</span> <span style=color:#ce5c00;font-weight:700>&gt;&gt;</span> <span style=color:#000>id</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>set_id</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#000>cin</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ignore</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>256</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;\n&#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Enter name: &#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>getline</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cin</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>mutable_name</span><span style=color:#000;font-weight:700>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Enter email address (blank for none): &#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>string</span> <span style=color:#000>email</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>getline</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cin</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>email</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>email</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>empty</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>set_email</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>email</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>while</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87>true</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Enter a phone number (or leave blank to finish): &#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>string</span> <span style=color:#000>number</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>getline</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cin</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>number</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>number</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>empty</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>break</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>PhoneNumber</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>phone_number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>add_phones</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#000>phone_number</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>set_number</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>number</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Is this a mobile, home, or work phone? &#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>string</span> <span style=color:#000>type</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>getline</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cin</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>type</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;mobile&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>phone_number</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>set_type</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>PHONE_TYPE_MOBILE</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;home&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>phone_number</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>set_type</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>PHONE_TYPE_HOME</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;work&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>phone_number</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>set_type</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>PHONE_TYPE_WORK</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Unknown phone type.  Using default.&#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>endl</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Main function:  Reads the entire address book from a file,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//   adds one person based on user input, then writes it back out to the same
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//   file.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>argc</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>char</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>argv</span><span style=color:#000;font-weight:700>[])</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Verify that the version of the library that we linked against is
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// compatible with the version of the headers we compiled against.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>GOOGLE_PROTOBUF_VERIFY_VERSION</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>argc</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>cerr</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Usage:  &#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>argv</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34; ADDRESS_BOOK_FILE&#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>endl</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>AddressBook</span> <span style=color:#000>address_book</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Read the existing address book.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>fstream</span> <span style=color:#000>input</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>argv</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>ios</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>in</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>ios</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>binary</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>input</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>argv</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;: File not found.  Creating a new file.&#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>endl</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>address_book</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ParseFromIstream</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>input</span><span style=color:#000;font-weight:700>))</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>cerr</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Failed to parse address book.&#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>endl</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Add an address.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>PromptForAddress</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>address_book</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>add_people</span><span style=color:#000;font-weight:700>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Write the new address book back to disk.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>fstream</span> <span style=color:#000>output</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>argv</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>ios</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>out</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>ios</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>trunc</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>ios</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>binary</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>address_book</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SerializeToOstream</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>output</span><span style=color:#000;font-weight:700>))</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>cerr</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Failed to write address book.&#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>endl</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Optional:  Delete all global objects allocated by libprotobuf.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>ShutdownProtobufLibrary</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p><code>GOOGLE_PROTOBUF_VERIFY_VERSION</code> マクロに注意してください。C++ Protocol Buffer ライブラリを使用する前にこのマクロを実行するのは良い習慣ですが、厳密に必要というわけではありません。これにより、コンパイル時に使用したヘッダのバージョンと互換性のないライブラリに誤ってリンクしていないかを確認します。バージョンの不一致が検出されると、プログラムは中止します。<code>.pb.cc</code> ファイルは起動時にこのマクロを自動的に呼び出すことに注意してください。</p><p>また、プログラムの最後に <code>ShutdownProtobufLibrary()</code> を呼び出すことにも注意してください。これは、Protocol Buffer ライブラリによって割り当てられたグローバルオブジェクトを削除するだけです。これはほとんどのプログラムには不要です。プロセスは終了するだけであり、OSがメモリの回収をすべて処理します。ただし、すべてのオブジェクトを解放する必要があるメモリリークチェッカーを使用する場合や、単一プロセスで複数回ロードおよびアンロードされる可能性があるライブラリを書いている場合は、Protocol Buffers にすべてをクリーンアップさせたい場合があります。</p><h2 id=reading-a-message>メッセージの読み取り</h2><p>もちろん、アドレス帳から情報を取得できない場合、アドレス帳はあまり役に立ちません！この例は、上記の例で作成されたファイルを読み取り、その中のすべての情報を出力します。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;iostream&gt;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;fstream&gt;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;string&gt;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&#34;addressbook.pb.h&#34;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#204a87;font-weight:700>namespace</span> <span style=color:#000>std</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Iterates though all people in the AddressBook and prints info about them.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>ListPeople</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>AddressBook</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>address_book</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>&lt;</span> <span style=color:#000>address_book</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>people_size</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>person</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>address_book</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>people</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Person ID: &#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>endl</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;  Name: &#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>endl</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>has_email</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;  E-mail address: &#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>email</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>endl</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>j</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>j</span> <span style=color:#ce5c00;font-weight:700>&lt;</span> <span style=color:#000>person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>phones_size</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>j</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>PhoneNumber</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>phone_number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>phones</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>j</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>switch</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>phone_number</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>type</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#f57900>PHONE_TYPE_MOBILE</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>          <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;  Mobile phone #: &#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>break</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#f57900>PHONE_TYPE_HOME</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>          <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;  Home phone #: &#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>break</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#f57900>PHONE_TYPE_WORK</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>          <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;  Work phone #: &#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>break</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>phone_number</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>number</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>endl</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Main function:  Reads the entire address book from a file and prints all
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//   the information inside.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>argc</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>char</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>argv</span><span style=color:#000;font-weight:700>[])</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Verify that the version of the library that we linked against is
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// compatible with the version of the headers we compiled against.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>GOOGLE_PROTOBUF_VERIFY_VERSION</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>argc</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>cerr</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Usage:  &#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>argv</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34; ADDRESS_BOOK_FILE&#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>endl</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>AddressBook</span> <span style=color:#000>address_book</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Read the existing address book.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>fstream</span> <span style=color:#000>input</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>argv</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>ios</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>in</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>ios</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>binary</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>address_book</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ParseFromIstream</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>input</span><span style=color:#000;font-weight:700>))</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>cerr</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Failed to parse address book.&#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>endl</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>ListPeople</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>address_book</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Optional:  Delete all global objects allocated by libprotobuf.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>ShutdownProtobufLibrary</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=extending-a-protobuf>プロトコルバッファの拡張</h2><p>プロトコルバッファを使用するコードをリリースした後、プロトコルバッファの定義を「改善」したくなることが遅かれ早かれあるでしょう。新しいバッファが後方互換性を持ち、古いバッファが前方互換性を持つようにしたい場合 &ndash; そしておそらくほとんどの場合そうしたいでしょう &ndash; そのためにはいくつかのルールに従う必要があります。新しいバージョンのプロトコルバッファでは、</p><ul><li>既存のフィールドのフィールド番号を変更してはいけません。</li><li>必須フィールドを追加したり削除してはいけません。</li><li>オプションまたは繰り返しフィールドを削除しても構いません。</li><li>新しいオプションまたは繰り返しフィールドを追加しても構いませんが、新しいフィールド番号を使用する必要があります（つまり、このプロトコルバッファで使用されたことのないフィールド番号を使用します）。</li></ul><p>（<a href=/programming-guides/proto2#updating>いくつかの例外</a>がありますが、それらはほとんど使用されません。）</p><p>これらのルールに従うと、古いコードは新しいメッセージを問題なく読み取り、新しいフィールドを単に無視します。古いコードにとって、削除されたオプションフィールドは単にデフォルト値を持ち、削除された繰り返しフィールドは空になります。新しいコードも古いメッセージを透過的に読み取ります。ただし、新しいオプションフィールドは古いメッセージに存在しないため、<code>has_</code>で明示的に設定されているかどうかを確認するか、<code>.proto</code>ファイルで適切なデフォルト値を提供する必要があります（フィールド番号の後に <code>[default = value]</code> を使用します）。オプション要素のデフォルト値が指定されていない場合、タイプ固有のデフォルト値が代わりに使用されます：文字列の場合、デフォルト値は空の文字列です。ブール値の場合、デフォルト値は false です。数値型の場合、デフォルト値はゼロです。また、新しい繰り返しフィールドを追加した場合、新しいコードはそれが空になっている（新しいコードによって）か、まったく設定されていない（古いコードによって）かを判断できません。それに <code>has_</code> フラグは存在しないためです。</p><h2 id=optimization>最適化のヒント</h2><p>C++ Protocol Buffers ライブラリは非常に高度に最適化されています。ただし、適切な使用方法によりさらなるパフォーマンス向上が可能です。以下はライブラリから最大限の速度を引き出すためのいくつかのヒントです：</p><ul><li>可能な限りメッセージオブジェクトを再利用してください。メッセージは、クリアされていても再利用のために割り当てたメモリを保持しようとします。したがって、同じタイプで似た構造を持つ多くのメッセージを連続して処理する場合は、毎回同じメッセージオブジェクトを再利用してメモリアロケーターの負荷を軽減するのが良いアイデアです。ただし、オブジェクトは時間の経過とともに肥大化する可能性があります、特にメッセージの「形状」が異なる場合や通常よりもはるかに大きなメッセージを時折構築する場合です。メッセージオブジェクトのサイズを <code>SpaceUsed</code> メソッドを呼び出して監視し、あまりに大きくなったら削除してください。</li><li>システムのメモリアロケーターは、複数のスレッドから多くの小さなオブジェクトを割り当てるために最適化されていない場合があります。代わりに <a href=https://github.com/google/tcmalloc>Google&rsquo;s TCMalloc</a> を使用してみてください。</li></ul><h2 id=advanced-usage>高度な使用法</h2><p>プロトコルバッファには、アクセサやシリアライゼーションを超える用途があります。
<a href=/reference/cpp><strong>C++ API リファレンス</strong></a>を探索して、それらを使用する方法を確認してください。</p><p>プロトコルメッセージクラスによって提供される主要な機能の1つは<em>リフレクション</em>です。
メッセージのフィールドを反復処理し、特定のメッセージタイプに対してコードを記述せずに値を操作できます。
リフレクションを使用する非常に便利な方法の1つは、プロトコルメッセージを他のエンコーディング（例：XMLやJSON）に変換することです。
リフレクションのより高度な使用法としては、同じタイプの2つのメッセージ間の差異を見つけたり、
特定のメッセージ内容に一致する式を記述できる「プロトコルメッセージ用の正規表現」を開発したりすることが考えられます。
想像力を働かせれば、プロトコルバッファを最初に期待していたよりも広範囲の問題に適用することが可能です！</p><p>リフレクションは
<a href=/reference/cpp/api-docs/google.protobuf.message#Reflection><code>Message::Reflection</code> インターフェース</a>
によって提供されています。</p></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank rel=noopener href=https://stackoverflow.com/questions/tagged/protocol-buffers aria-label="Stack Overflow"><i class="fab fa-stack-overflow"></i></a></li></ul><script type=text/javascript id=cookiebanner src=https://cdn.jsdelivr.net/gh/dobarkod/cookie-banner@1.2.2/dist/cookiebanner.min.js data-height=50px data-message="Protobuf.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic." data-bg=#ffb data-fg=#000 data-position=bottom data-padding="10px 16px" data-close-text="OK, got it" data-font-size=18px data-moreinfo=https://policies.google.com/technologies/cookies></script></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/protocolbuffers/protobuf aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/g/protobuf aria-label="Developer mailing list"><i class="fa fa-envelope"></i></a></li></ul><script type=text/javascript id=cookiebanner src=https://cdn.jsdelivr.net/gh/dobarkod/cookie-banner@1.2.2/dist/cookiebanner.min.js data-height=50px data-message="Protobuf.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic." data-bg=#ffb data-fg=#000 data-position=bottom data-padding="10px 16px" data-close-text="OK, got it" data-font-size=18px data-moreinfo=https://policies.google.com/technologies/cookies></script></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2024 Google LLC All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank rel=noopener>プライバシーポリシー</a></small>
<span class=text-white>Hosted by GitHub Pages.</span> <a href=https://docs.github.com/en/site-policy/privacy-policies/github-privacy-statement target=_blank>GitHub Privacy Statement</a></div></div></div></footer></div><script src=/js/main.min.ba08a6b7f24e657f0a1b9b55be3a3162585168cd862ace0957f5b44e6cb6dc61.js integrity="sha256-ugimt/JOZX8KG5tVvjoxYlhRaM2GKs4JV/W0Tmy23GE=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>