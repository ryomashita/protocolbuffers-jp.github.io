

+++
title = "field_comparator.h"
toc_hide = "true"
linkTitle = "C++"
description = "This section contains reference documentation for working with protocol buffer classes in C++."
type = "docs"
+++

<p><code>#include &lt;google/protobuf/util/field_comparator.h&gt;<br>namespace <a href="#google.protobuf.util">google::protobuf::util</a></code></p><p>Defines classes for field comparison. </p><table width="100%"><tr><th colspan="2"><h3 style="margin-top: 4px">Classes in this file</h3></th></tr><tr><td><div><code><a href="#FieldComparator">FieldComparator</a></code></div><div style="font-style: italic; margin-top: 4px; margin-left: 16px;">Base class specifying the interface for comparing protocol buffer fields. </div></td></tr><tr><td><div><code><a href="#SimpleFieldComparator">SimpleFieldComparator</a></code></div><div style="font-style: italic; margin-top: 4px; margin-left: 16px;">Basic implementation of <a href='#FieldComparator'>FieldComparator</a>. </div></td></tr><tr><td><div><code><a href="#DefaultFieldComparator">DefaultFieldComparator</a></code></div><div style="font-style: italic; margin-top: 4px; margin-left: 16px;"></div></td></tr></table><h2 id="FieldComparator">class FieldComparator</h2><p><code>#include &lt;<a href="#">google/protobuf/util/field_comparator.h</a>&gt;<br>namespace <a href="#google.protobuf.util">google::protobuf::util</a></code></p><p>Base class specifying the interface for comparing protocol buffer fields. </p><p>Regular users should consider using or subclassing <a href='#DefaultFieldComparator'>DefaultFieldComparator</a> rather than this interface. Currently, this does not support comparing unknown fields. </p>

<p>Known subclasses:</p><ul><li><code><a href="#SimpleFieldComparator">SimpleFieldComparator</a></code></li></ul><table><tr><th colspan="2"><h3 style="margin-top: 4px">Members</h3></th></tr><tr><td style="border-right-width: 0px; text-align: right;"><code>enum</code></td><td style="border-left-width: 0px"id="FieldComparator.ComparisonResult"><div style="padding-left: 16px; text-indent: -16px"><code><b>ComparisonResult</b></code></div><div style="font-style: italic; margin-top: 4px; margin-left: 16px;"> <a href="#FieldComparator.ComparisonResult.details">more...</a></div></td></tr><tr><td style="border-right-width: 0px; text-align: right;"><code></code></td><td style="border-left-width: 0px"id="FieldComparator.FieldComparator"><div style="padding-left: 16px; text-indent: -16px"><code><b>FieldComparator</b>()</code></div></td></tr><tr><td style="border-right-width: 0px; text-align: right;"><code>virtual </code></td><td style="border-left-width: 0px"id="FieldComparator.~FieldComparator"><div style="padding-left: 16px; text-indent: -16px"><code><b>~FieldComparator</b>()</code></div></td></tr><tr><td style="border-right-width: 0px; text-align: right;"><code>virtual <a href='#FieldComparator.ComparisonResult'>ComparisonResult</a></code></td><td style="border-left-width: 0px"id="FieldComparator.Compare"><div style="padding-left: 16px; text-indent: -16px"><code><b>Compare</b>(const <a href='google.protobuf.message#Message'>Message</a> &amp; message_1, const <a href='google.protobuf.message#Message'>Message</a> &amp; message_2, const <a href='google.protobuf.descriptor#FieldDescriptor'>FieldDescriptor</a> * field, int index_1, int index_2, const <a href='google.protobuf.util.message_differencer#FieldContext'>util::FieldContext</a> * field_context)  = 0</code></div><div style="font-style: italic; margin-top: 4px; margin-left: 16px;">Compares the values of a field in two protocol buffer messages.  <a href="#FieldComparator.Compare.details">more...</a></div></td></tr></table> <hr><h3 id="FieldComparator.ComparisonResult.details"><code>enum FieldComparator::ComparisonResult {<br>&nbsp;&nbsp;SAME,<br>&nbsp;&nbsp;DIFFERENT,<br>&nbsp;&nbsp;RECURSE<br>}</code></h3><div style="margin-left: 16px"><p></p><table><tr><td>SAME</td><td><p>Compared fields are equal. </p><p>In case of comparing submessages, user should not recursively compare their contents. </p>
</td></tr><tr><td>DIFFERENT</td><td><p>Compared fields are different. </p><p>In case of comparing submessages, user should not recursively compare their contents. </p>
</td></tr><tr><td>RECURSE</td><td><p>Compared submessages need to be compared recursively. </p><p><a href='#FieldComparator'>FieldComparator</a> does not specify the semantics of recursive comparison. This value should not be returned for simple values. </p>
</td></tr></table></div> <hr><h3 id="FieldComparator.Compare.details"><code>virtual <a href='#FieldComparator.ComparisonResult'>ComparisonResult</a> FieldComparator::Compare(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const <a href='google.protobuf.message#Message'>Message</a> &amp; message_1,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const <a href='google.protobuf.message#Message'>Message</a> &amp; message_2,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const <a href='google.protobuf.descriptor#FieldDescriptor'>FieldDescriptor</a> * field,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int index_1,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int index_2,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const <a href='google.protobuf.util.message_differencer#FieldContext'>util::FieldContext</a> * field_context)  = 0</code></h3><div style="margin-left: 16px"><p>Compares the values of a field in two protocol buffer messages. </p><p>Returns SAME or DIFFERENT for simple values, and SAME, DIFFERENT or RECURSE for submessages. Returning RECURSE for fields not being submessages is illegal. In case the given <a href='google.protobuf.descriptor#FieldDescriptor'>FieldDescriptor</a> points to a repeated field, the indices need to be valid. Otherwise they should be ignored.</p>

<p><a href='google.protobuf.util.message_differencer#FieldContext'>FieldContext</a> contains information about the specific instances of the fields being compared, versus <a href='google.protobuf.descriptor#FieldDescriptor'>FieldDescriptor</a> which only contains general type information about the fields. </p>
</div><h2 id="SimpleFieldComparator">class SimpleFieldComparator: public <a href="#FieldComparator">FieldComparator</a></h2><p><code>#include &lt;<a href="#">google/protobuf/util/field_comparator.h</a>&gt;<br>namespace <a href="#google.protobuf.util">google::protobuf::util</a></code></p><p>Basic implementation of <a href='#FieldComparator'>FieldComparator</a>. </p><p>Supports three modes of floating point value comparison: exact, approximate using MathUtil::AlmostEqual method, and arbitrarily precise using MathUtil::WithinFractionOrMargin. </p>

<p>Known subclasses:</p><ul><li><code><a href="#DefaultFieldComparator">DefaultFieldComparator</a></code></li></ul><table><tr><th colspan="2"><h3 style="margin-top: 4px">Members</h3></th></tr><tr><td style="border-right-width: 0px; text-align: right;"><code>enum</code></td><td style="border-left-width: 0px"id="SimpleFieldComparator.FloatComparison"><div style="padding-left: 16px; text-indent: -16px"><code><b>FloatComparison</b></code></div><div style="font-style: italic; margin-top: 4px; margin-left: 16px;"> <a href="#SimpleFieldComparator.FloatComparison.details">more...</a></div></td></tr><tr><td style="border-right-width: 0px; text-align: right;"><code></code></td><td style="border-left-width: 0px"id="SimpleFieldComparator.SimpleFieldComparator"><div style="padding-left: 16px; text-indent: -16px"><code><b>SimpleFieldComparator</b>()</code></div><div style="font-style: italic; margin-top: 4px; margin-left: 16px;">Creates new comparator with float comparison set to EXACT. </div></td></tr><tr><td style="border-right-width: 0px; text-align: right;"><code></code></td><td style="border-left-width: 0px"id="SimpleFieldComparator.~SimpleFieldComparator"><div style="padding-left: 16px; text-indent: -16px"><code><b>~SimpleFieldComparator</b>()</code></div></td></tr><tr><td style="border-right-width: 0px; text-align: right;"><code>void</code></td><td style="border-left-width: 0px"id="SimpleFieldComparator.set_float_comparison"><div style="padding-left: 16px; text-indent: -16px"><code><b>set_float_comparison</b>(<a href='#SimpleFieldComparator.FloatComparison'>FloatComparison</a> float_comparison)</code></div></td></tr><tr><td style="border-right-width: 0px; text-align: right;"><code><a href='#SimpleFieldComparator.FloatComparison'>FloatComparison</a></code></td><td style="border-left-width: 0px"id="SimpleFieldComparator.float_comparison"><div style="padding-left: 16px; text-indent: -16px"><code><b>float_comparison</b>() const</code></div></td></tr><tr><td style="border-right-width: 0px; text-align: right;"><code>void</code></td><td style="border-left-width: 0px"id="SimpleFieldComparator.set_treat_nan_as_equal"><div style="padding-left: 16px; text-indent: -16px"><code><b>set_treat_nan_as_equal</b>(bool treat_nan_as_equal)</code></div><div style="font-style: italic; margin-top: 4px; margin-left: 16px;">Set whether the <a href='#FieldComparator'>FieldComparator</a> shall treat floats or doubles that are both NaN as equal (treat_nan_as_equal = true) or as different (treat_nan_as_equal = false).  <a href="#SimpleFieldComparator.set_treat_nan_as_equal.details">more...</a></div></td></tr><tr><td style="border-right-width: 0px; text-align: right;"><code>bool</code></td><td style="border-left-width: 0px"id="SimpleFieldComparator.treat_nan_as_equal"><div style="padding-left: 16px; text-indent: -16px"><code><b>treat_nan_as_equal</b>() const</code></div></td></tr><tr><td style="border-right-width: 0px; text-align: right;"><code>void</code></td><td style="border-left-width: 0px"id="SimpleFieldComparator.SetFractionAndMargin"><div style="padding-left: 16px; text-indent: -16px"><code><b>SetFractionAndMargin</b>(const <a href='google.protobuf.descriptor#FieldDescriptor'>FieldDescriptor</a> * field, double fraction, double margin)</code></div><div style="font-style: italic; margin-top: 4px; margin-left: 16px;">Sets the fraction and margin for the float comparison of a given field.  <a href="#SimpleFieldComparator.SetFractionAndMargin.details">more...</a></div></td></tr><tr><td style="border-right-width: 0px; text-align: right;"><code>void</code></td><td style="border-left-width: 0px"id="SimpleFieldComparator.SetDefaultFractionAndMargin"><div style="padding-left: 16px; text-indent: -16px"><code><b>SetDefaultFractionAndMargin</b>(double fraction, double margin)</code></div><div style="font-style: italic; margin-top: 4px; margin-left: 16px;">Sets the fraction and margin for the float comparison of all float and double fields, unless a field has been given a specific setting via <a href='#SimpleFieldComparator.SetFractionAndMargin'>SetFractionAndMargin()</a> above.  <a href="#SimpleFieldComparator.SetDefaultFractionAndMargin.details">more...</a></div></td></tr><tr><td style="border-right-width: 0px; text-align: right;"><code>protected <a href='#FieldComparator.ComparisonResult'>ComparisonResult</a></code></td><td style="border-left-width: 0px"id="SimpleFieldComparator.SimpleCompare"><div style="padding-left: 16px; text-indent: -16px"><code><b>SimpleCompare</b>(const <a href='google.protobuf.message#Message'>Message</a> &amp; message_1, const <a href='google.protobuf.message#Message'>Message</a> &amp; message_2, const <a href='google.protobuf.descriptor#FieldDescriptor'>FieldDescriptor</a> * field, int index_1, int index_2, const <a href='google.protobuf.util.message_differencer#FieldContext'>util::FieldContext</a> * field_context)</code></div><div style="font-style: italic; margin-top: 4px; margin-left: 16px;">Returns the comparison result for the given field in two messages.  <a href="#SimpleFieldComparator.SimpleCompare.details">more...</a></div></td></tr><tr><td style="border-right-width: 0px; text-align: right;"><code>protected bool</code></td><td style="border-left-width: 0px"id="SimpleFieldComparator.CompareWithDifferencer"><div style="padding-left: 16px; text-indent: -16px"><code><b>CompareWithDifferencer</b>(<a href='google.protobuf.util.message_differencer#MessageDifferencer'>MessageDifferencer</a> * differencer, const <a href='google.protobuf.message#Message'>Message</a> &amp; message1, const <a href='google.protobuf.message#Message'>Message</a> &amp; message2, const <a href='google.protobuf.util.message_differencer#FieldContext'>util::FieldContext</a> * field_context)</code></div><div style="font-style: italic; margin-top: 4px; margin-left: 16px;">Compare using the provided message_differencer.  <a href="#SimpleFieldComparator.CompareWithDifferencer.details">more...</a></div></td></tr><tr><td style="border-right-width: 0px; text-align: right;"><code>protected <a href='#FieldComparator.ComparisonResult'>ComparisonResult</a></code></td><td style="border-left-width: 0px"id="SimpleFieldComparator.ResultFromBoolean"><div style="padding-left: 16px; text-indent: -16px"><code><b>ResultFromBoolean</b>(bool boolean_result) const</code></div><div style="font-style: italic; margin-top: 4px; margin-left: 16px;">Returns <a href='#FieldComparator.ComparisonResult'>FieldComparator::SAME</a> if boolean_result is true and <a href='#FieldComparator.ComparisonResult'>FieldComparator::DIFFERENT</a> otherwise. </div></td></tr></table> <hr><h3 id="SimpleFieldComparator.FloatComparison.details"><code>enum SimpleFieldComparator::FloatComparison {<br>&nbsp;&nbsp;EXACT,<br>&nbsp;&nbsp;APPROXIMATE<br>}</code></h3><div style="margin-left: 16px"><p></p><table><tr><td>EXACT</td><td>Floats and doubles are compared exactly. </td></tr><tr><td>APPROXIMATE</td><td>Floats and doubles are compared using the MathUtil::AlmostEqual method or MathUtil::WithinFractionOrMargin method. </td></tr></table></div> <hr><h3 id="SimpleFieldComparator.set_treat_nan_as_equal.details"><code>void SimpleFieldComparator::set_treat_nan_as_equal(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bool treat_nan_as_equal)</code></h3><div style="margin-left: 16px"><p>Set whether the <a href='#FieldComparator'>FieldComparator</a> shall treat floats or doubles that are both NaN as equal (treat_nan_as_equal = true) or as different (treat_nan_as_equal = false). </p><p>Default is treating NaNs always as different. </p>
</div> <hr><h3 id="SimpleFieldComparator.SetFractionAndMargin.details"><code>void SimpleFieldComparator::SetFractionAndMargin(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const <a href='google.protobuf.descriptor#FieldDescriptor'>FieldDescriptor</a> * field,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;double fraction,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;double margin)</code></h3><div style="margin-left: 16px"><p>Sets the fraction and margin for the float comparison of a given field. </p><p>Uses MathUtil::WithinFractionOrMargin to compare the values.</p>

<p>REQUIRES: field-&gt;cpp_type == <a href='google.protobuf.descriptor#FieldDescriptor.CppType'>FieldDescriptor::CPPTYPE_DOUBLE</a> or </p>

<pre>field-&gt;cpp_type == FieldDescriptor::CPPTYPE_FLOAT</pre>

<p> REQUIRES: float_comparison_ == APPROXIMATE </p>
</div> <hr><h3 id="SimpleFieldComparator.SetDefaultFractionAndMargin.details"><code>void SimpleFieldComparator::SetDefaultFractionAndMargin(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;double fraction,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;double margin)</code></h3><div style="margin-left: 16px"><p>Sets the fraction and margin for the float comparison of all float and double fields, unless a field has been given a specific setting via <a href='#SimpleFieldComparator.SetFractionAndMargin'>SetFractionAndMargin()</a> above. </p><p>Uses MathUtil::WithinFractionOrMargin to compare the values.</p>

<p>REQUIRES: float_comparison_ == APPROXIMATE </p>
</div> <hr><h3 id="SimpleFieldComparator.SimpleCompare.details"><code>protected <a href='#FieldComparator.ComparisonResult'>ComparisonResult</a> SimpleFieldComparator::SimpleCompare(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const <a href='google.protobuf.message#Message'>Message</a> &amp; message_1,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const <a href='google.protobuf.message#Message'>Message</a> &amp; message_2,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const <a href='google.protobuf.descriptor#FieldDescriptor'>FieldDescriptor</a> * field,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int index_1,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int index_2,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const <a href='google.protobuf.util.message_differencer#FieldContext'>util::FieldContext</a> * field_context)</code></h3><div style="margin-left: 16px"><p>Returns the comparison result for the given field in two messages. </p><p>This function is called directly by <a href='#DefaultFieldComparator.Compare'>DefaultFieldComparator::Compare</a>. Subclasses can call this function to compare fields they do not need to handle specially. </p>
</div> <hr><h3 id="SimpleFieldComparator.CompareWithDifferencer.details"><code>protected bool SimpleFieldComparator::CompareWithDifferencer(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='google.protobuf.util.message_differencer#MessageDifferencer'>MessageDifferencer</a> * differencer,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const <a href='google.protobuf.message#Message'>Message</a> &amp; message1,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const <a href='google.protobuf.message#Message'>Message</a> &amp; message2,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const <a href='google.protobuf.util.message_differencer#FieldContext'>util::FieldContext</a> * field_context)</code></h3><div style="margin-left: 16px"><p>Compare using the provided message_differencer. </p><p>For example, a subclass can use this method to compare some field in a certain way using the same message_differencer instance and the field context. </p>
</div><h2 id="DefaultFieldComparator">class DefaultFieldComparator: public <a href="#SimpleFieldComparator">SimpleFieldComparator</a></h2><p><code>#include &lt;<a href="#">google/protobuf/util/field_comparator.h</a>&gt;<br>namespace <a href="#google.protobuf.util">google::protobuf::util</a></code></p><p></p><table><tr><th colspan="2"><h3 style="margin-top: 4px">Members</h3></th></tr><tr><td style="border-right-width: 0px; text-align: right;"><code>virtual <a href='#FieldComparator.ComparisonResult'>ComparisonResult</a></code></td><td style="border-left-width: 0px"id="DefaultFieldComparator.Compare"><div style="padding-left: 16px; text-indent: -16px"><code><b>Compare</b>(const <a href='google.protobuf.message#Message'>Message</a> &amp; message_1, const <a href='google.protobuf.message#Message'>Message</a> &amp; message_2, const <a href='google.protobuf.descriptor#FieldDescriptor'>FieldDescriptor</a> * field, int index_1, int index_2, const <a href='google.protobuf.util.message_differencer#FieldContext'>util::FieldContext</a> * field_context)</code></div><div style="font-style: italic; margin-top: 4px; margin-left: 16px;">Compares the values of a field in two protocol buffer messages.  <a href="#DefaultFieldComparator.Compare.details">more...</a></div></td></tr></table> <hr><h3 id="DefaultFieldComparator.Compare.details"><code>virtual <a href='#FieldComparator.ComparisonResult'>ComparisonResult</a> DefaultFieldComparator::Compare(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const <a href='google.protobuf.message#Message'>Message</a> &amp; message_1,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const <a href='google.protobuf.message#Message'>Message</a> &amp; message_2,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const <a href='google.protobuf.descriptor#FieldDescriptor'>FieldDescriptor</a> * field,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int index_1,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int index_2,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const <a href='google.protobuf.util.message_differencer#FieldContext'>util::FieldContext</a> * field_context)</code></h3><div style="margin-left: 16px"><p>Compares the values of a field in two protocol buffer messages. </p><p>Returns SAME or DIFFERENT for simple values, and SAME, DIFFERENT or RECURSE for submessages. Returning RECURSE for fields not being submessages is illegal. In case the given <a href='google.protobuf.descriptor#FieldDescriptor'>FieldDescriptor</a> points to a repeated field, the indices need to be valid. Otherwise they should be ignored.</p>

<p><a href='google.protobuf.util.message_differencer#FieldContext'>FieldContext</a> contains information about the specific instances of the fields being compared, versus <a href='google.protobuf.descriptor#FieldDescriptor'>FieldDescriptor</a> which only contains general type information about the fields. </p>

</div>
