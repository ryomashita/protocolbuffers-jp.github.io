+++
title = "2023年6月29日に発表された変更"
linkTitle = "2023年6月29日"
toc_hide = "true"
description = "2023年6月29日にProtocol Buffersで発表された変更。"
type = "docs"
+++

**TL;DR:** 私たちは2023年後半にProtobuf Editionsをオープンソースプロジェクトにリリースする予定です。初回リリース時にproto2/proto3構文からEditions構文に移行する必要はありませんが、ソフトウェアプロジェクトの将来のタイムラインで移行を計画することをお勧めします。

## Protobuf Editions {#editions}

Protobuf Editionsは、Protocol Buffersで使用してきたproto2およびproto3の指定を置き換えます。proto定義ファイルの先頭に `syntax = "proto2"` または `syntax = "proto3"` を追加する代わりに、`edition = "2024"` のようなエディション番号を使用して、ファイルが持つデフォルトの動作を指定します。Editionsは言語を段階的に進化させることを可能にします。

古いバージョンのハードコードされた動作の代わりに、Editionsはデフォルト値（動作）を持つ “features” のコレクションを表し、これらの動作はオーバーライドできます。Featuresは、ファイル、メッセージ、フィールド、列挙型などのオプションであり、protoc、コードジェネレータ、およびprotobufランタイムの動作を指定します。選択したエディションのデフォルト動作と一致しない場合は、ファイル、メッセージ、フィールドなどの異なるレベルで望ましい動作を明示的にオーバーライドできます。

Editionsは既存のバイナリを壊すことはなく、最初のエディションは最小限の中断をもたらします。これはベースラインを確立し、proto2およびproto3の定義を新しい単一の定義形式に組み合わせます。コードの変更は必要ありません。私たちは、.protoファイルを移行するためのツールであるPrototillerを提供します。以下の例は、proto2定義ファイルとproto3ファイルを示し、それらをPrototillerを使用してProtobuf Editions形式に変換した後の見た目を示しています：

<section class="tabs">

#### Proto2構文 {.new-tab}

```proto
// proto2 file
syntax = "proto2";

message Player {
  // in proto2, optional fields have explicit presence
  optional string name = 1;
  // proto2 still supports the problematic "required" field rule
  required int32 id = 2;
  // in proto2 this is not packed by default
  repeated int32 scores = 3;

  enum Handed {
    HANDED_UNSPECIFIED = 0,
    HANDED_LEFT = 1,
    HANDED_RIGHT = 2,
    HANDED_AMBIDEXTROUS = 3,
  }

  // in proto2 enums are closed
  optional Handed handed = 4;
}
```

#### Editions構文 {.new-tab}

```proto
// Editions version of proto2 file
edition = "2023";

message Player {
  string name = 1;
  int32 id = 2 [features.field_presence = LEGACY_REQUIRED];
  repeated int32 scores = 3 [features.repeated_field_encoding = EXPANDED];

  enum Handed {
    // this overrides the default Edition 2023 behavior, which is OPEN
    option features.enum = CLOSED;
    HANDED_UNSPECIFIED = 0,
    HANDED_LEFT = 1,
    HANDED_RIGHT = 2,
    HANDED_AMBIDEXTROUS = 3,
  }

  Handed handed = 4;
}
```

```markdown
</section>

そして、似たような proto3 定義ファイルは次のようになります：

<section class="tabs">

#### Proto3 構文 {.new-tab}

```proto
(((((f6d2eeec1381619f)))))
```

#### Editions 構文 {.new-tab}

```proto
// Editions version of proto3 file
edition = "2023";

message Player {
  string name = 1;
  int32 id = 2 [features.field_presence = IMPLICIT];
  repeated int32 scores = 3;

  enum Handed {
    HANDED_UNSPECIFIED = 0,
    HANDED_LEFT = 1,
    HANDED_RIGHT = 2,
    HANDED_AMBIDEXTROUS = 3,
  }

  Handed handed = 4;
}
```

</section>

このトピックで提供されている例は、Proto2 と Proto3 を Protobuf Editions を使用して等価な表現に直接変換したものですが、プロジェクトのニーズに合わせて設定を組み合わせることができます。

機能は、エディションのリリースによって管理されるライフサイクルを持っています。たとえば、`features.awesome_new_feature` はエディション 2031 で追加され、新しい動作は新しい動作を明示的にオーバーライドしないすべての定義に適用されます。エディション 2033 では、新機能は非推奨となります。オーバーライドは引き続き機能しますが、開発者にはすぐに新しい動作に適応する必要があることが通知されます。エディション 2036 では、機能が削除され、新しい動作がすべての proto に適用されます。この時点で新しい動作をオーバーライドする方法はありません。

![Editions lifecycle](/images/protobuf-editions-lifecycle-short.png "Editions lifecycle")
\
**Figure 1: Editions lifecycle flowchart**

エディションはおおよそ1年に1度リリースされる予定です。Protobuf Editions に関する詳細は、https://protobuf.dev/editions/overview で概要をご覧ください。
```
